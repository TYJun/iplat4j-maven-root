<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap  PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="FABF01">
    <select id="queryFaInfoDOInfo" parameterClass="java.util.HashMap" resultClass="com.baosight.wilp.fa.da.domain.FaInfoDO">
        SELECT
            id,
            id AS "faInfoId",
            goods_num	AS "goodsNum",
            goods_name	AS "goodsName",
            goods_classify_code	AS "goodsClassifyCode",
            goods_classify_name	AS "goodsClassifyName",
            goods_type_code	AS "goodsTypeCode",
            goods_type_name	AS "goodsTypeName",
            model	AS "model",
            spec	AS "spec",
            amount	AS "amount",
            price	AS "price",
            buy_cost	AS "buyCost",
            manufacturer	AS "manufacturer",
            surp_name	AS "surpName",
            DATE_FORMAT( buy_date, '%Y-%m-%d' ) AS "buyDate",
            DATE_FORMAT( use_date, '%Y-%m-%d' ) AS "useDate",
            build	AS "build",
            floor	AS "floor",
            room	AS "room",
            install_location	AS "installLocation",
            install_location_num AS "installLocationNum",
            dept_num	AS "deptNum",
            dept_name	AS "deptName",
            CASE status_code
            WHEN '010' THEN '待用'
            WHEN '020' THEN '在用'
            WHEN '030' THEN '现场停用'
            WHEN '031' THEN '调拨中'
            WHEN '035' THEN '报废中'
            WHEN '039' THEN '退货中'
            WHEN '040' THEN '报废提交'
            WHEN '050' THEN '预报废'
            WHEN '060' THEN '报废'
            END AS "statusCode",
            unit_num	AS "unitNum",
            unit_name	AS "unitName",
            residual_rate	AS "residualRate",
            estimated_residual_value	AS "estimatedResidualValue",
            use_years	AS "useYears",
            fundingSource_num AS "fundingSourceNum",
            finace_class_num	AS "finaceClassNum",
            DATE_FORMAT( in_account_date, '%Y-%m-%d' ) AS "inAccountDate",
            invoice_no	AS "invoiceNo",
            DATE_FORMAT( invoice_date, '%Y-%m-%d' ) AS "invoiceDate",
            device_id	AS "deviceId",
            device_name	AS "deviceName",
            device_type_name	AS "deviceTypeName",
            rfid_code	AS "rfidCode",
            net_asset_value	AS "netAssetValue",
            estimate_cost	AS "estimateCost",
            remark	AS "remark",
            depreciation_way	AS "depreciationWay",
            total_depreciation	AS "totalDepreciation",
            month_depreciation	AS "monthDepreciation",
            in_account_status AS "inAccountStatus",
            card_status AS "cardStatus",
            rec_creator	AS "recCreator",
            rec_create_name	AS "recCreateName",
            DATE_FORMAT( rec_create_time, '%Y-%m-%d %H:%i:%S' ) AS "recCreateTime",
            rec_revisor	AS "recRevisor",
            rec_revise_name	AS "recReviseName",
            DATE_FORMAT( rec_revise_time, '%Y-%m-%d %H:%i:%S' ) AS "recReviseTime",
            data_group_code	AS "dataGroupCode",
            lock_flag AS "lockFlag",
            archive_flag	AS "archiveFlag",
            split_reason AS "splitReason"
        FROM fa_info
        WHERE lock_flag NOT IN ("4")
        AND status_code IN ('020','035')
        <isEqual prepend="AND" property="role" compareValue="user">
            dept_name in (
            <iterate conjunction="," property="lookDeptName">
                #lookDeptName[]#
            </iterate>
            )
        </isEqual>
        <isNotEmpty prepend=" AND " property="faInfoId">
            id = #faInfoId#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="goodsNum">
            goods_num like concat ('%',trim(#goodsNum#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="goodsName">
            goods_name like concat ('%',trim(#goodsName#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="surpName">
            surp_name like concat ('%',trim(#surpName#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="remark">
            remark like concat ('%',trim(#remark#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="useYear">
            use_years = #useYear#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="buyCostS">
            buy_cost >= #buyCostS#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="buyCostE">
            #buyCostE# >= buy_cost
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="netAssetValueS">
            net_asset_value >= #netAssetValueS#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="netAssetValueE">
            #netAssetValueE# >= net_asset_value
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="buyDateS">
            DATE_FORMAT( buy_date, '%Y-%m-%d' )  >= #buyDateS#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="buyDateE">
            #buyDateE# >= DATE_FORMAT( buy_date, '%Y-%m-%d' )
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="useDateS">
            DATE_FORMAT( use_date, '%Y-%m-%d' )  >= #useDateS#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="useDateE">
            #useDateE# >= DATE_FORMAT( use_date, '%Y-%m-%d' )
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="goodsClassifyCode">
            goods_classify_name like concat ('%',trim(#goodsClassifyCode#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="goodsTypeCode">
            goods_type_name like concat ('%',trim(#goodsTypeCode#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="fundingSourceNum">
            fundingSource_num = #fundingSourceNum#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="deptName">
            $deptName$
        </isNotEmpty>
        order by dept_name,rec_revise_time DESC,rec_create_time DESC,LENGTH(goods_num),goods_num
    </select>

    <select id="countFaInfoDOInfo" parameterClass="java.util.HashMap" resultClass="int">
        SELECT COUNT(*) FROM  fa_info
        WHERE lock_flag NOT IN ("4")
        AND status_code IN ('020','035')
        <isEqual prepend="AND" property="role" compareValue="user">
            dept_name in (
            <iterate conjunction="," property="lookDeptName">
                #lookDeptName[]#
            </iterate>
            )
        </isEqual>
        <isNotEmpty prepend=" AND " property="faInfoId">
            id = #faInfoId#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="goodsNum">
            goods_num like concat ('%',trim(#goodsNum#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="goodsName">
            goods_name like concat ('%',trim(#goodsName#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="surpName">
            surp_name like concat ('%',trim(#surpName#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="remark">
            remark like concat ('%',trim(#remark#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="useYear">
            use_years = #useYear#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="buyCostS">
            buy_cost >= #buyCostS#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="buyCostE">
            #buyCostE# >= buy_cost
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="netAssetValueS">
            net_asset_value >= #netAssetValueS#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="netAssetValueE">
            #netAssetValueE# >= net_asset_value
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="buyDateS">
            DATE_FORMAT( buy_date, '%Y-%m-%d' )  >= #buyDateS#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="buyDateE">
            #buyDateE# >= DATE_FORMAT( buy_date, '%Y-%m-%d' )
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="useDateS">
            DATE_FORMAT( use_date, '%Y-%m-%d' )  >= #useDateS#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="useDateE">
            #useDateE# >= DATE_FORMAT( use_date, '%Y-%m-%d' )
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="goodsClassifyCode">
            goods_classify_name like concat ('%',trim(#goodsClassifyCode#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="goodsTypeCode">
            goods_type_name like concat ('%',trim(#goodsTypeCode#),'%')
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="fundingSourceNum">
            fundingSource_num = #fundingSourceNum#
        </isNotEmpty>
        <isNotEmpty prepend=" AND " property="deptName">
            dept_name like concat ('%',trim(#deptName#),'%')
        </isNotEmpty>
    </select>

    <select id="queryFaScrapInfo" parameterClass="java.util.HashMap" resultClass="com.baosight.wilp.fa.bf.domian.FaScrapVO">
        SELECT
            fs.id,
            fsd.id AS "detailId",
            fsd.faInfo_id AS "faInfoId",
            fsd.goods_num AS "goodsNum",
            fsd.goods_name AS "goodsName",
            fi.spec,
            fsd.goods_classify_code AS "goodsClassifyCode",
            fsd.goods_classify_name AS "goodsClassifyName",
            fs.scrapped_no AS "scrappedNo",
            fs.apply_dept_name AS "applyDeptName",
            fs.apply_person AS "applyPerson",
            fs.apply_time AS "applyTime",
            fs.apply_reason AS "applyReason",
            fsd.identify_dept_name AS "identifyDeptName",
            fsd.identify_person AS "identifyPerson",
            fsd.identify_time AS "identifyTime",
            fsd.identify_reason AS "identifyReason",
            fsd.function_dept_name AS "functionDeptName",
            fsd.function_person AS "functionPerson",
            fsd.function_time AS "functionTime",
            fsd.function_reason AS "functionReason",
            fsd.asset_dept_name AS "assetDeptName",
            fsd.asset_person AS "assetPerson",
            fsd.asset_time AS "assetTime",
            fsd.asset_reason AS "assetReason",
            CASE fsd.scrap_detail_status
            WHEN '00' THEN '申请中'
            WHEN '10' THEN '鉴定中'
            WHEN '20' THEN '归口中'
            WHEN '30' THEN '审批中'
            WHEN '70' THEN '审批驳回'
            WHEN '80' THEN '归口驳回'
            WHEN '90' THEN '鉴定驳回'
            WHEN '100' THEN '审批通过'
            END AS "scrapStatus"
        FROM
            fa_scrap fs
        LEFT JOIN fa_scrap_detail fsd ON fs.scrapped_no = fsd.scrapped_no
        LEFT JOIN fa_info fi ON fi.id = fsd.faInfo_id
        WHERE
            1 = 1
            <isEqual prepend="and" property="scrapStatus" compareValue="apply">
                fsd.scrap_detail_status IN ('00')
                <isEqual prepend="and" property="role" compareValue="user">
                    fs.apply_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                </isEqual>
            </isEqual>
            <isEqual prepend="and" property="scrapStatus" compareValue="identify">
                fsd.scrap_detail_status IN ('10')
                <isEqual prepend="and" property="role" compareValue="user" open="(" close=")">
                    fsd.identify_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                    OR
                    fs.apply_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                </isEqual>
            </isEqual>
            <isEqual prepend="and" property="scrapStatus" compareValue="function">
                fsd.scrap_detail_status IN ('20')
                <isEqual prepend="and" property="role" compareValue="user" open="(" close=")">
                    fsd.function_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                    OR
                    fsd.identify_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                    OR
                    fs.apply_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                </isEqual>
            </isEqual>
            <isEqual prepend="and" property="scrapStatus" compareValue="asset">
                fsd.scrap_detail_status IN ('30')
                <isEqual prepend="and" property="role" compareValue="user" open="(" close=")">
                    fsd.function_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                    OR
                    fsd.identify_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                    OR
                    fs.apply_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                </isEqual>
            </isEqual>
            <isEqual prepend="and" property="scrapStatus" compareValue="all">
                2 = 2
                <isEqual prepend="and" property="role" compareValue="user" open="(" close=")">
                    fsd.function_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                    OR
                    fsd.identify_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                    OR
                    fs.apply_dept_name in (
                    <iterate property="lookDeptName" conjunction=",">
                        #lookDeptName[]#
                    </iterate>
                    )
                </isEqual>
            </isEqual>
            <isNotEmpty prepend="and" property="scrappedNo">
                fs.scrapped_no like concat ('%',trim(#scrappedNo#),'%')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="applyDeptName">
                fs.apply_dept_name like concat ('%',trim(#applyDeptName#),'%')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="applyReason">
                fs.apply_reason like concat ('%',trim(#applyReason#),'%')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="identifyDeptName">
                fsd.identify_dept_name like concat ('%',trim(#identifyDeptName#),'%')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="identifyReason">
                fsd.identify_reason like concat ('%',trim(#identifyReason#),'%')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="functionDeptName">
                fsd.function_dept_name like concat ('%',trim(#functionDeptName#),'%')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="functionReason">
                fsd.function_reason like concat ('%',trim(#functionReason#),'%')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="assetDeptName">
                fsd.asset_dept_name like concat ('%',trim(#assetDeptName#),'%')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="assetReason">
                fsd.asset_reason like concat ('%',trim(#assetReason#),'%')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="goodsNum">
                fsd.goods_num like concat ('%',trim(#goodsNum#),'%')
            </isNotEmpty>
            <isNotEmpty prepend="and" property="goodsName">
                fsd.goods_name like concat ('%',trim(#goodsName#),'%')
            </isNotEmpty>
        ORDER BY fs.apply_dept_name,fs.scrapped_no,fsd.goods_num,fsd.asset_time DESC
    </select>

    <select id="countFaScrapInfo" parameterClass="java.util.HashMap" resultClass="int">
        SELECT COUNT(*) FROM
            fa_scrap fs
        LEFT JOIN fa_scrap_detail fsd ON fs.scrapped_no = fsd.scrapped_no
        WHERE
        1 = 1
        <isEqual prepend="and" property="scrapStatus" compareValue="apply">
            fsd.scrap_detail_status IN ('00')
            <isEqual prepend="and" property="role" compareValue="user">
                fs.apply_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
            </isEqual>
        </isEqual>
        <isEqual prepend="and" property="scrapStatus" compareValue="identify">
            fsd.scrap_detail_status IN ('10')
            <isEqual prepend="and" property="role" compareValue="user" open="(" close=")">
                fsd.identify_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
                OR
                fs.apply_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
            </isEqual>
        </isEqual>
        <isEqual prepend="and" property="scrapStatus" compareValue="function">
            fsd.scrap_detail_status IN ('20')
            <isEqual prepend="and" property="role" compareValue="user" open="(" close=")">
                fsd.function_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
                OR
                fsd.identify_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
                OR
                fs.apply_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
            </isEqual>
        </isEqual>
        <isEqual prepend="and" property="scrapStatus" compareValue="asset">
            fsd.scrap_detail_status IN ('30')
            <isEqual prepend="and" property="role" compareValue="user" open="(" close=")">
                fsd.function_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
                OR
                fsd.identify_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
                OR
                fs.apply_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
            </isEqual>
        </isEqual>
        <isEqual prepend="and" property="scrapStatus" compareValue="all">
            2 = 2
            <isEqual prepend="and" property="role" compareValue="user" open="(" close=")">
                fsd.function_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
                OR
                fsd.identify_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
                OR
                fs.apply_dept_name in (
                <iterate property="lookDeptName" conjunction=",">
                    #lookDeptName[]#
                </iterate>
                )
            </isEqual>
        </isEqual>
        <isNotEmpty prepend="and" property="scrappedNo">
            fs.scrapped_no like concat ('%',trim(#scrappedNo#),'%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="applyDeptName">
            fs.apply_dept_name like concat ('%',trim(#applyDeptName#),'%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="applyReason">
            fs.apply_reason like concat ('%',trim(#applyReason#),'%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="identifyDeptName">
            fsd.identify_dept_name like concat ('%',trim(#identifyDeptName#),'%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="identifyReason">
            fsd.identify_reason like concat ('%',trim(#identifyReason#),'%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="functionDeptName">
            fsd.function_dept_name like concat ('%',trim(#functionDeptName#),'%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="functionReason">
            fsd.function_reason like concat ('%',trim(#functionReason#),'%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="assetDeptName">
            fsd.asset_dept_name like concat ('%',trim(#assetDeptName#),'%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="assetReason">
            fsd.asset_reason like concat ('%',trim(#assetReason#),'%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="goodsNum">
            fsd.goods_num like concat ('%',trim(#goodsNum#),'%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="goodsName">
            fsd.goods_name like concat ('%',trim(#goodsName#),'%')
        </isNotEmpty>
    </select>

    <select id="queryFaScarpVOByScrapNo" parameterClass="java.lang.String" resultClass="com.baosight.wilp.fa.bf.domian.FaScrapVO">
        SELECT
            apply_reason AS "applyReason",
            identify_reason AS "identifyReason",
            function_reason AS "functionReason",
            asset_reason AS "assetReason"
        FROM
            fa_scrap
        WHERE
            scrapped_no = #value#
    </select>

    <select id="queryFaScarpVOByGoodsNum" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
        SELECT
            fs.apply_dept_name AS "applyDeptName",
            fs.apply_person AS "applyPerson",
            fs.apply_reason AS "applyReason",
            fs.apply_time AS "applyTime",
            fsd.identify_dept_name AS "identifyDeptName",
            fsd.identify_person AS "identifyPerson",
            fsd.identify_reason AS "identifyReason",
            fsd.identify_time AS "identifyTime",
            fsd.identify_fileCode AS "identifyFileCode",
            fsd.function_dept_name AS "functionDeptName",
            fsd.function_person AS "functionPerson",
            fsd.function_reason AS "functionReason",
            fsd.function_time AS "functionTime",
            fsd.function_fileCode AS "functionFileCode",
            fsd.asset_dept_name AS "assetDeptName",
            fsd.asset_person AS "assetPerson",
            fsd.asset_reason AS "assetReason",
            fsd.asset_time AS "assetTime",
            fsd.asset_fileCode AS "assetFileCode"
        FROM
            `fa_scrap` fs
        LEFT JOIN `fa_scrap_detail` fsd ON fs.scrapped_no = fsd.scrapped_no
        WHERE 1 = 1
        <isNotEmpty prepend="AND" property="scrappedNo">
            fsd.scrapped_no = #scrappedNo#
        </isNotEmpty>
        <isNotEmpty prepend="AND" property="goodsNum">
            fsd.goods_num = #goodsNum#
        </isNotEmpty>
    </select>

    <select id="queryFaScarpDetailsVOByGoodsNum" parameterClass="java.lang.String" resultClass="com.baosight.wilp.fa.da.domain.FaInfoDO">
        SELECT
            id,
            id AS "faInfoId",
            goods_num	AS "goodsNum",
            goods_name	AS "goodsName",
            goods_classify_code	AS "goodsClassifyCode",
            goods_classify_name	AS "goodsClassifyName",
            goods_type_code	AS "goodsTypeCode",
            goods_type_name	AS "goodsTypeName",
            model	AS "model",
            amount	AS "amount",
            price	AS "price",
            buy_cost	AS "buyCost",
            manufacturer	AS "manufacturer",
            surp_name	AS "surpName",
            DATE_FORMAT( buy_date, '%Y-%m-%d %H:%i:%S' ) AS "buyDate",
            DATE_FORMAT( use_date, '%Y-%m-%d %H:%i:%S' ) AS "useDate",
            build	AS "build",
            floor	AS "floor",
            install_location	AS "installLocation",
            install_location_num AS "installLocationNum",
            dept_num	AS "deptNum",
            dept_name	AS "deptName",
            CASE status_code
                WHEN '010' THEN '待用'
                WHEN '020' THEN '在用'
                WHEN '030' THEN '现场停用'
                WHEN '031' THEN '调拨中'
                WHEN '035' THEN '报废中'
                WHEN '039' THEN '退货中'
                WHEN '040' THEN '报废提交'
                WHEN '050' THEN '预报废'
                WHEN '060' THEN '报废'
                END AS "statusCode",
            unit_num	AS "unitNum",
            unit_name	AS "unitName",
            residual_rate	AS "residualRate",
            estimated_residual_value	AS "estimatedResidualValue",
            use_years	AS "useYears",
            fundingSource_num AS "fundingSourceNum",
            finace_class_num	AS "finaceClassNum",
            DATE_FORMAT( in_account_date, '%Y-%m-%d %H:%i:%S' ) AS "inAccountDate",
            invoice_no	AS "invoiceNo",
            DATE_FORMAT( invoice_date, '%Y-%m-%d %H:%i:%S' ) AS "invoiceDate",
            device_id	AS "deviceId",
            device_name	AS "deviceName",
            device_type_name	AS "deviceTypeName",
            rfid_code	AS "rfidCode",
            net_asset_value	AS "netAssetValue",
            estimate_cost	AS "estimateCost",
            remark	AS "remark",
            depreciation_way	AS "depreciationWay",
            total_depreciation	AS "totalDepreciation",
            month_depreciation	AS "monthDepreciation",
            CASE in_account_status
                WHEN '1' THEN '已启用'
                WHEN '0' THEN '未启用'
                END AS "inAccountStatus",
            CASE card_status
                WHEN '1' THEN '已发卡'
                WHEN '0' THEN '未发卡'
                END AS "cardStatus",
            rec_creator	AS "recCreator",
            rec_create_name	AS "recCreateName",
            DATE_FORMAT( rec_create_time, '%Y-%m-%d %H:%i:%S' ) AS "recCreateTime",
            rec_revisor	AS "recRevisor",
            rec_revise_name	AS "recReviseName",
            DATE_FORMAT( rec_revise_time, '%Y-%m-%d %H:%i:%S' ) AS "recReviseTime",
            data_group_code	AS "dataGroupCode",
            CASE lock_flag
                WHEN '2' THEN '变更中'
                WHEN '3' THEN '拆分中'
                ELSE '无' END AS "lockFlag",
            archive_flag	AS "archiveFlag",
            split_reason AS "splitReason"
        FROM fa_info
        WHERE goods_num = #value#
    </select>

    <select id="queryFaScarpDetailsVOByScrapNo" parameterClass="java.lang.String" resultClass="com.baosight.wilp.fa.da.domain.FaInfoDO">
        SELECT
            id,
            id AS "faInfoId",
            goods_num	AS "goodsNum",
            goods_name	AS "goodsName",
            goods_classify_code	AS "goodsClassifyCode",
            goods_classify_name	AS "goodsClassifyName",
            goods_type_code	AS "goodsTypeCode",
            goods_type_name	AS "goodsTypeName",
            model	AS "model",
            amount	AS "amount",
            price	AS "price",
            buy_cost	AS "buyCost",
            manufacturer	AS "manufacturer",
            surp_name	AS "surpName",
            DATE_FORMAT( buy_date, '%Y-%m-%d %H:%i:%S' ) AS "buyDate",
            DATE_FORMAT( use_date, '%Y-%m-%d %H:%i:%S' ) AS "useDate",
            build	AS "build",
            floor	AS "floor",
            install_location	AS "installLocation",
            install_location_num AS "installLocationNum",
            dept_num	AS "deptNum",
            dept_name	AS "deptName",
            CASE status_code
            WHEN '010' THEN '待用'
            WHEN '020' THEN '在用'
            WHEN '030' THEN '现场停用'
            WHEN '031' THEN '调拨中'
            WHEN '035' THEN '报废中'
            WHEN '039' THEN '退货中'
            WHEN '040' THEN '报废提交'
            WHEN '050' THEN '预报废'
            WHEN '060' THEN '报废'
            END AS "statusCode",
            unit_num	AS "unitNum",
            unit_name	AS "unitName",
            residual_rate	AS "residualRate",
            estimated_residual_value	AS "estimatedResidualValue",
            use_years	AS "useYears",
            fundingSource_num AS "fundingSourceNum",
            finace_class_num	AS "finaceClassNum",
            DATE_FORMAT( in_account_date, '%Y-%m-%d %H:%i:%S' ) AS "inAccountDate",
            invoice_no	AS "invoiceNo",
            DATE_FORMAT( invoice_date, '%Y-%m-%d %H:%i:%S' ) AS "invoiceDate",
            device_id	AS "deviceId",
            device_name	AS "deviceName",
            device_type_name	AS "deviceTypeName",
            rfid_code	AS "rfidCode",
            net_asset_value	AS "netAssetValue",
            estimate_cost	AS "estimateCost",
            remark	AS "remark",
            depreciation_way	AS "depreciationWay",
            total_depreciation	AS "totalDepreciation",
            month_depreciation	AS "monthDepreciation",
            CASE in_account_status
            WHEN '1' THEN '已启用'
            WHEN '0' THEN '未启用'
            END AS "inAccountStatus",
            CASE card_status
            WHEN '1' THEN '已发卡'
            WHEN '0' THEN '未发卡'
            END AS "cardStatus",
            rec_creator	AS "recCreator",
            rec_create_name	AS "recCreateName",
            DATE_FORMAT( rec_create_time, '%Y-%m-%d %H:%i:%S' ) AS "recCreateTime",
            rec_revisor	AS "recRevisor",
            rec_revise_name	AS "recReviseName",
            DATE_FORMAT( rec_revise_time, '%Y-%m-%d %H:%i:%S' ) AS "recReviseTime",
            data_group_code	AS "dataGroupCode",
            CASE lock_flag
            WHEN '2' THEN '变更中'
            WHEN '3' THEN '拆分中'
            ELSE '无' END AS "lockFlag",
            archive_flag	AS "archiveFlag",
            split_reason AS "splitReason"
        FROM fa_info
        WHERE id IN
        (SELECT
          `faInfo_id` AS "faInfoId"
        FROM
            fa_scrap_detail
        WHERE
            scrapped_no = #value#)
    </select>

    <select id="queryFaInfoIdByScrappedNo" parameterClass="java.util.List" resultClass="java.lang.String">
        select
            DISTINCT faInfo_id AS "faInfoId"
        from
            fa_scrap_detail
        <dynamic prepend="where">
            scrapped_no IN
            <iterate open="(" close=")" conjunction=",">
                #scrappedNoList[]#
            </iterate>
        </dynamic>
    </select>

    <delete id="removeFaScrapInfo" parameterClass="java.util.HashMap">
        DELETE
        FROM fa_scrap
        WHERE id = #faScrapId# and confirm_flag = "0"
    </delete>



    <update id="confirmFaScrapInfo" parameterClass="java.util.HashMap">
        UPDATE fa_scrap
        SET confirm_flag = "1",
            archive_flag = CONVERT(#archiveFlag#, SIGNED) + 1
        WHERE id = #faScrapId#
          and archive_flag = #archiveFlag#
    </update>

    <insert id="savePicInfo" parameterClass="java.util.ArrayList">
        insert into fa_pic(`id`,`type`,`relate_id`,`file_id`,`file_name`,`file_size`,`file_path`,`sort_no`)
        values
        <iterate conjunction=",">
            (#list[].uid#, #list[].type#, #list[].relateId#, #list[].docId#,
            #list[].fileName#, #list[].fileSize#, #list[].docUrl#, @x:=ifnull(@x,0)+1)
        </iterate>
    </insert>

    <update id="updateFaInfoUnlock" parameterClass="java.util.HashMap">
        update fa_info set lock_flag = "0",status_code = "50" where id = #faInfoId#
    </update>

    <!-- 查询今日类别号 -->
    <select id="queryMaxCode" parameterClass="java.lang.String" resultClass="java.util.HashMap">
        select
            scrapped_no typeCode
        from
            fa_scrap
        where
            scrapped_no like concat('%', #value#, '%')
        order by
            scrapped_no desc
    </select>

    <!--  资产报废  -->
    <insert id="insertFaScrapVo" parameterClass="com.baosight.wilp.fa.bf.domian.FaScrapVO">
        INSERT INTO fa_scrap(
            id,scrapped_no,apply_dept_name,apply_person,apply_time,apply_reason,apply_fileCode,scrap_status,`source`
        ) VALUES
        (
            #id#,#scrappedNo#,#applyDeptName#,#applyPerson#,#applyTime#,#applyReason#,#applyFileCode#,#scrapStatus#,#source#
        )
    </insert>

    <insert id="insertFaScrapDetailVO" parameterClass="java.util.ArrayList">
        INSERT INTO fa_scrap_detail(
            id,scrapped_no,faInfo_id,goods_num,goods_name,
            goods_classify_code,goods_classify_name,
            dept_num,dept_name,model,use_date,
            buy_cost,net_asset_value,used_years,scrap_detail_status
        ) VALUES
        <iterate conjunction=",">
        (
            #faScrapDetailVOList[].id#,#faScrapDetailVOList[].scrappedNo#,#faScrapDetailVOList[].faInfoId#,
            #faScrapDetailVOList[].goodsNum#,#faScrapDetailVOList[].goodsName#,#faScrapDetailVOList[].goodsClassifyCode#,
            #faScrapDetailVOList[].goodsClassifyName#,#faScrapDetailVOList[].deptNum#,
            #faScrapDetailVOList[].deptName#,#faScrapDetailVOList[].model#,#faScrapDetailVOList[].useDate#,
            #faScrapDetailVOList[].buyCost#,#faScrapDetailVOList[].netAssetValue#,#faScrapDetailVOList[].usedYears#,
            #faScrapDetailVOList[].scrapDetailStatus#
        )
        </iterate>
    </insert>

    <update id="updateFaInfoStatus" parameterClass="java.util.ArrayList">
        UPDATE fa_info SET status_code = '035'
        WHERE status_code = '020' AND id IN
        <iterate conjunction="," open="(" close=")">
            #faScrapDetailVOList[].faInfoId#
        </iterate>
    </update>
    <!--    -->

    <!-- 批量撤销报废申请：修改资产主表状态，删除明细表信息，删除主表信息 -->
    <update id="revocationFaInfoStatus" parameterClass="java.util.HashMap">
        UPDATE fa_info SET status_code = #statusCode#
        WHERE status_code = '035' AND id IN
        (SELECT
            faInfo_id
        FROM fa_scrap_detail
        WHERE
            scrapped_no IN
            <iterate open="(" close=")" conjunction="," property="scrappedNosList">
                #scrappedNosList[]#
            </iterate>
        )
    </update>

    <delete id="deleteFaScrapDetailsByNo" parameterClass="java.util.ArrayList">
        DELETE FROM fa_scrap_detail WHERE scrapped_no IN
        <iterate open="(" close=")" conjunction=",">
            #scrappedNosList[]#
        </iterate>
    </delete>

    <delete id="deleteFaScrapsByNo" parameterClass="java.util.ArrayList">
        DELETE FROM fa_scrap WHERE scrap_status = '00' AND scrapped_no IN
        <iterate open="(" close=")" conjunction=",">
            #scrappedNosList[]#
        </iterate>
    </delete>
    <!--  -->

    <!-- 批量撤销通过资产报废明细表的id -->
    <update id="revocationFaInfoStatusById" parameterClass="java.util.HashMap">
        UPDATE fa_info SET status_code = #statusCode#
        WHERE status_code = '035' AND id IN
        (SELECT
        faInfo_id
        FROM fa_scrap_detail
        WHERE
        id IN
        <iterate open="(" close=")" conjunction="," property="detailIdList">
            #detailIdList[]#
        </iterate>
        )
    </update>

    <delete id="deleteFaScrapDetailsById" parameterClass="java.util.ArrayList">
        DELETE FROM fa_scrap_detail WHERE id IN
        <iterate open="(" close=")" conjunction=",">
            #detailIdList[]#
        </iterate>
    </delete>
    <!--    -->

    <!--  提交报废信息  -->
    <update id="sumbitFaScrapInfo" parameterClass="java.util.HashMap">
        UPDATE fa_scrap_detail SET
        identify_dept_name = #identifyDeptName#,
        function_dept_name = #functionDeptName#,
        scrap_detail_status = '10'
        WHERE scrap_detail_status = '00'
        AND id IN
        <iterate open="(" close=")" conjunction="," property="detailIdList">
            #detailIdList[]#
        </iterate>
    </update>
    <!--    -->

    <!--  提交鉴定信息  -->
    <update id="sumbitIdentifyReason" parameterClass="java.util.HashMap">
        UPDATE fa_scrap SET scrap_status = #scrapStatus#,identify_dept_name = #identifyDeptName#,
        identify_person = #identifyPerson#,identify_time = #identifyTime#,identify_reason = #identifyReason#
        WHERE scrap_status = '10' AND scrapped_no = #scrappedNo#
    </update>
    <!--    -->

    <!--  提交职能信息  -->
    <update id="sumbitFunctionReason" parameterClass="java.util.HashMap">
        UPDATE fa_scrap SET scrap_status = #scrapStatus#,function_dept_name = #functionDeptName#,
        function_person = #functionPerson#,function_time = #functionTime#,function_reason = #functionReason#
        WHERE scrap_status = '20' AND scrapped_no = #scrappedNo#
    </update>
    <!--    -->

    <!--  提交审批信息  -->
    <update id="sumbitAssetReason" parameterClass="java.util.HashMap">
        UPDATE fa_scrap SET scrap_status = #scrapStatus#,asset_dept_name = #assetDeptName#,
        asset_person = #assetPerson#,asset_time = #assetTime#,asset_reason = #assetReason#
        WHERE scrap_status = '30' AND scrapped_no = #scrappedNo#
    </update>
    <!--    -->

    <!-- 资产科批量审批/驳回 -->
    <update id="batchApproval" parameterClass="java.util.HashMap">
        UPDATE fa_scrap SET scrap_status = #scrapStatus#,asset_dept_name = #assetDeptName#,
        asset_person = #assetPerson#,asset_time = #assetTime#,asset_reason = #assetReason#,
        asset_fileCode = #assetFileCode#
        WHERE scrap_status = '30' AND scrapped_no IN
        <iterate open="(" close=")" conjunction="," property="scrappedNosList">
            #scrappedNosList[]#
        </iterate>
    </update>
    <!---->

    <!-- 资产科批量审批/驳回通过id -->
    <update id="batchApprovalById" parameterClass="java.util.HashMap">
        UPDATE fa_scrap_detail SET scrap_detail_status = #scrapDetailStatus#,
        asset_dept_name = #assetDeptName#, asset_person = #assetPerson#,asset_time = #assetTime#,
        asset_reason = #assetReason#, asset_fileCode = #assetFileCode#
        WHERE scrap_detail_status = '30' AND id IN
        <iterate open="(" close=")" conjunction="," property="detailIdList">
            #detailIdList[]#
        </iterate>
    </update>
    <!---->

    <!-- 批量鉴定 -->
    <update id="batchIdentify" parameterClass="java.util.HashMap">
        UPDATE fa_scrap_detail SET scrap_detail_status = #scrapDetailStatus#,
        identify_person = #identifyPerson#,identify_time = #identifyTime#,
        identify_reason = #identifyReason#,identify_fileCode = #identifyFileCode#
        WHERE scrap_detail_status = '10' AND id IN
        <iterate open="(" close=")" conjunction="," property="detailIdList">
            #detailIdList[]#
        </iterate>
    </update>
    <!---->

    <!-- 批量归口 -->
    <update id="batchFunction" parameterClass="java.util.HashMap">
        UPDATE fa_scrap_detail SET scrap_detail_status = #scrapDetailStatus#,
        function_person = #functionPerson#,function_time = #functionTime#,
        function_reason = #functionReason#,function_fileCode = #functionFileCode#
        WHERE scrap_detail_status = '20' AND id IN
        <iterate open="(" close=")" conjunction="," property="detailIdList">
            #detailIdList[]#
        </iterate>
    </update>
    <!---->

    <!-- 归口科室添加资产类别 -->
    <select id="queryOnceRecord" parameterClass="java.lang.String" resultClass="java.util.HashMap">
        SELECT
            goods_classify_code AS "goodsClassifyCode",
            goods_classify_name AS "goodsClassifyName"
        FROM
            fa_function_goods
        WHERE
            function_id = #value#
    </select>

    <insert id="appointExpert" parameterClass="java.util.HashMap">
        INSERT INTO fa_function_goods(id,function_id,goods_classify_code,goods_classify_name,create_time)
        values (#id#,#functionId#,#goodsClassifyCode#,#goodsClassifyName#,now())
    </insert>

    <!-- 选择鉴定科室初始化调用 -->
    <select id="queryDeptNameByCode" parameterClass="java.lang.String" resultClass="java.util.HashMap">
        SELECT
            t1.id,
            t1.dept_num AS "identifyDeptNum",
            t1.dept_name AS "identifyDeptName",
            t2.id AS "parentId"
        FROM
            fa_function_goods ffg
        LEFT JOIN
            fa_function_dept t1 ON t1.id = ffg.function_id
        LEFT JOIN
            fa_function_dept t2 ON t1.parent_id = t2.id
        WHERE
            ffg.goods_classify_code = #value#
        order by ffg.create_time desc
    </select>

    <select id="queryEmptyScrappedNos" parameterClass="java.util.HashMap" resultClass="java.lang.String">
        SELECT
            fs.scrapped_no
        FROM
            fa_scrap fs LEFT JOIN fa_scrap_detail fsd ON fs.scrapped_no = fsd.scrapped_no
        WHERE fsd.scrapped_no IS NULL
        GROUP BY fs.scrapped_no
    </select>

    <delete id="deleteEmptyScrappedNos" parameterClass="java.util.ArrayList">
        DELETE FROM fa_scrap WHERE scrapped_no IN
        (
        <iterate conjunction=",">
            #scrappedNosList[]#
        </iterate>
        )
    </delete>
</sqlMap>