<!doctype html>
<html class="no-js">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="reference/mui/css/mui.css">
    <link rel="stylesheet" href="reference/css/common.css" />
    <link rel="stylesheet" href="reference/mui/css/mui.picker.min.css">
    <link rel="stylesheet" href="reference/css/clothCommon.css" />
    <link rel="stylesheet" href="reference/bootstrap-3.3.5/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../../../css/android-ios.css">
</head>
<STYLE TYPE="text/css">
    body {
        background: #eee;
    }
    
    .task {
        width: 96%;
        background: #fff;
        margin: 0 auto;
        box-shadow: 1px 1px 10px #b9b9b9;
        margin-bottom: 10px;
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
        border-bottom-right-radius: 4px;
        border-bottom-left-radius: 4px;
        margin-top: 5px;
    }
    
    .task-title {
        width: 100%;
        height: 40px;
        line-height: 40px;
        padding-left: 15px;
        padding-right: 15px;
        background: #2589ad;
        color: #fff;
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
    }
    
    .task-info {
        padding-left: 15px;
        padding-right: 15px;
        padding-top: 10px;
        padding-bottom: 10px;
        border-bottom-right-radius: 4px;
        border-bottom-left-radius: 4px;
    }
    
    .first-tr {
        background: #08c1a3;
        height: 40px;
        line-height: 40px;
        color: #ffffff;
        text-align: center;
        /*border-radius: 5px;*/
        box-shadow: 0px 5px #F7F7F7;
    }
    
    .mask {
        height: 70%;
    }
    
    .backColor {
        background: #30c37c;
    }
    
    .dropdown-menu {
        min-width: 150px;
    }
    
    .col-lg-4,
    .col-md-4,
    .col-sm-4,
    .col-xs-4,
    .col-lg-6,
    .col-md-6,
    .col-sm-6,
    .col-xs-6 {
        padding-right: 0px;
        padding-left: 0px;
    }
    
    .dropdown-menu>li>a {
        padding: 6px 20px;
    }
    
    .row {
        margin-right: 0px;
        margin-left: 0px;
    }
    
    .content-table {
        background: #F7F7F7;
        overflow-y: auto;
        margin: 0px 2.2%;
        width: 95.6%;
    }
    
    .first-tr-other {
        height: 40px;
        line-height: 40px;
        color: #333;
        text-align: center;
        border-bottom: 1px solid #a1e4d9;
    }
    
    .first-tr-other:last-child {
        border-bottom: 0;
    }
</STYLE>

<body>
    <header class="mui-bar mui-bar-nav">
        <h1 class="mui-title">月布草各项费用环比表</h1>
        <button class="mui-action-back mui-btn mui-btn-blue mui-btn-link mui-btn-nav mui-pull-left">
        <span class="mui-icon mui-icon-left-nav"></span>
        返回
      </button>
        <!-- <button id="search" class="mui-btn mui-btn-link mui-btn-nav mui-pull-right">
          <span>年月</span>
        </button> -->
    </header>

    <div id="warn" class="warn" hidden>
        <small></small>
    </div>
    <div class="mui-content">
        <div class="dropdown row">
            <div id="selectY1" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <button class="btn btn-default dropdown-toggle btn-block" type="button" style="border-radius:2px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            选择年度
            <span class="caret"></span>
            </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li><a href="#">2011</a></li>
                    <li><a href="#">2012</a></li>
                    <li><a href="#">2013</a></li>
                    <li><a href="#">2014</a></li>
                    <li><a href="#">2015</a></li>
                    <li><a href="#">2016</a></li>
                    <li><a href="#">2017</a></li>
                    <li><a href="#">2018</a></li>
                    <li><a href="#">2019</a></li>
                    <li><a href="#">2020</a></li>
                </ul>
            </div>
            <div id="selectM1" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <button class="btn btn-default dropdown-toggle btn-block" type="button" style="border-radius:2px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            选择月份
            <span class="caret"></span>
            </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li value="1"><a href="#">1</a></li>
                    <li value="2"><a href="#">2</a></li>
                    <li value="3"><a href="#">3</a></li>
                    <li value="4"><a href="#">4</a></li>
                    <li value="5"><a href="#">5</a></li>
                    <li value="6"><a href="#">6</a></li>
                    <li value="7"><a href="#">7</a></li>
                    <li value="8"><a href="#">8</a></li>
                    <li value="9"><a href="#">9</a></li>
                    <li value="10"><a href="#">10</a></li>
                    <li value="11"><a href="#">11</a></li>
                    <li value="12"><a href="#">12</a></li>
                </ul>
            </div>
        </div>
        <div style="padding: 8px;">
            <div class="mui-row first-tr" style="font-size: 17px;">
                <span id="year1">2020</span>年<span id="month1">9</span>月布草指标状况
            </div>
        </div>
        <div class="content-table" style="padding: 8px;">
            <div class="mui-row first-tr-other">
                <div class="mui-col mui-col-xs-3">
                    <span>回收量</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>件</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>环比</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>%</span>
                </div>
            </div>
            <div class="mui-row first-tr-other">
                <div class="mui-col mui-col-xs-3">
                    <span id="num1"></span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>件</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span id="arrow1"></span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span id="ratio1"></span>
                </div>
            </div>
            <div class="mui-row first-tr-other">
                <div class="mui-col mui-col-xs-3">
                    <span>发放量</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>件</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>环比</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>%</span>
                </div>
            </div>
            <div class="mui-row first-tr-other">
                <div class="mui-col mui-col-xs-3">
                    <span id="num2"></span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>件</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span id="arrow2"></span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span id="ratio2"></span>
                </div>
            </div>
            <div class="mui-row first-tr-other">
                <div class="mui-col mui-col-xs-3">
                    <span>洗涤费用</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>元</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>环比</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>%</span>
                </div>
            </div>
            <div class="mui-row first-tr-other">
                <div class="mui-col mui-col-xs-3">
                    <span id="num3"></span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span>元</span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span id="arrow3"></span>
                </div>
                <div class="mui-col mui-col-xs-3">
                    <span id="ratio3"></span>
                </div>
            </div>
        </div>

        <div class="dropdown row" style="margin-top:50px;">
            <div id="selectY2" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <button class="btn btn-default dropdown-toggle btn-block" type="button" style="border-radius:2px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            选择年度
            <span class="caret"></span>
                    </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li><a href="#">2011</a></li>
                    <li><a href="#">2012</a></li>
                    <li><a href="#">2013</a></li>
                    <li><a href="#">2014</a></li>
                    <li><a href="#">2015</a></li>
                    <li><a href="#">2016</a></li>
                    <li><a href="#">2017</a></li>
                    <li><a href="#">2018</a></li>
                    <li><a href="#">2019</a></li>
                    <li><a href="#">2020</a></li>
                </ul>
            </div>
            <div id="selectM2" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <button class="btn btn-default dropdown-toggle btn-block" type="button" style="border-radius:2px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            选择月份
            <span class="caret"></span>
            </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li value="1"><a href="#">1</a></li>
                    <li value="2"><a href="#">2</a></li>
                    <li value="3"><a href="#">3</a></li>
                    <li value="4"><a href="#">4</a></li>
                    <li value="5"><a href="#">5</a></li>
                    <li value="6"><a href="#">6</a></li>
                    <li value="7"><a href="#">7</a></li>
                    <li value="8"><a href="#">8</a></li>
                    <li value="9"><a href="#">9</a></li>
                    <li value="10"><a href="#">10</a></li>
                    <li value="11"><a href="#">11</a></li>
                    <li value="12"><a href="#">12</a></li>
                </ul>
            </div>
        </div>
        <div style="padding: 8px;">
            <div class="mui-row first-tr" style="font-size: 17px;">
                <span id="year2">2020</span>年<span id="month2">9</span>月洗涤费前十名科室占比
            </div>
        </div>


        <div id="container" style="margin: 0 auto;"></div>

    </div>


</body>
<script src="reference/mui/js/mui.js" type="text/javascript"></script>
<script src="reference/js/jquery-2.1.4.js" type="text/javascript"></script>
<script src="reference/bootstrap-3.3.5/js/bootstrap.min.js" type="text/javascript"></script>
<script src="reference/js/common.js" type="text/javascript"></script>
<script src="../js/highcharts.js"></script>
<script src="../js/exporting.js"></script>
<script type="text/javascript" src="reference/mui/js/mui.picker.min.js"></script>
<script type="text/javascript">
    var baseUrl = localStorage.getItem("url");
    var workNo = localStorage.getItem("workNo");
    var dataGroupCode = "BONA";
    var page = 1;
    var html = '';
    var date1 = new Date();
    var year1 = date1.getFullYear();
    var month1 = date1.getMonth() + 1;
    var time1 = year1 + '-' + month1;
    var date2 = new Date();
    var year2 = date2.getFullYear();
    var month2 = date2.getMonth() + 1;
    var time2 = year2 + '-' + month2;
    var titleText = "";
    $("#year1").html(year1);
    $("#year2").html(year2);
    $("#month1").html(month1);
    $("#month2").html(month2);

    var colorStyle = ['#9F88FF', '#00BBFF', '#99FF99', '#FF8800', '#C10066', '#888888',
        '#5500FF', '#CCEEFF', '#FFE4B5', '#32CD32', '#B8860B', '#DCDCDC',
        '#D8BFD8', '#1E90FF ', '#00FF00', '#FFB7DD', '#FFB3FF', '#444444',
        '#4B0082', '#B0C4DE', '#F0FFF0', '#FF44AA', '#CC00FF', '#DDDDDD',
        '#7B68EE', '#6495ED', '#228B22', '#8C0044', '#E8CCFF', '#886600'
    ];


    $(function() {
        var width = screen.width - 20;
        $('#container').width(width);
        $('#container').height(300);

        getReclaimRatio(time1);

        getNeatIssueRatio(time1);

        getWashingFeeRatio(time1);

        getTenProportion(time2);
    });

    // 获取月布草回收量环比率
    function getReclaimRatio(time) {
        $("#num1").html("");
        $("#arrow1").html("");
        $("#ratio1").html("");

        $.ajax({
            url: baseUrl + 'app_fineReport.do?getClothReclaimRatio',
            type: 'get',
            data: {
                dataGroupCode: dataGroupCode,
                time: time
            },
            timeout: 30000,
            success: function(data) {
                var data = JSON.parse(data);
                console.log(data);
                if (data.respCode == "200") {
                    var ratio = data.obj.ratio;
                    var reclaimNum = data.obj.reclaimNum;
                    $("#num1").html(reclaimNum);
                    if (ratio < 0) {
                        $("#arrow1").html("&#8595;");
                        $("#arrow1").css("color", "green");
                        $("#ratio1").html(Math.abs(ratio));
                    } else if (ratio > 0) {
                        $("#arrow1").html("&#8593;");
                        $("#arrow1").css("color", "red");
                        $("#ratio1").html(ratio);
                    } else {
                        $("#arrow1").html("-");
                        $("#ratio1").html(ratio);
                    }
                }
            },
            complete: function(XMLHttpRequest, status) { //请求完成后最终执行参数
                if (status == 'timeout') {
                    $("#loading").hide();
                    $('#warn small').html('请求超时！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　　　　
                } else if (status == 'error') {
                    $("#loading").hide();
                    $('#warn small').html('网络异常！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　
                }　
            }
        });

    }

    // 月布草发放量环比率查询
    function getNeatIssueRatio(time) {
        $("#num2").html("");
        $("#arrow2").html("");
        $("#ratio2").html("");
        $.ajax({
            url: baseUrl + 'app_fineReport.do?getClothNeatIssueRatio',
            type: 'get',
            data: {
                dataGroupCode: dataGroupCode,
                time: time
            },
            timeout: 30000,
            success: function(data) {
                var data = JSON.parse(data);
                console.log(data);
                if (data.respCode == "200" && data.obj != null) {
                    var ratio = data.obj.ratio;
                    var neatIssueNum = data.obj.neatIssueNum;
                    $("#num2").html(neatIssueNum);
                    if (ratio < 0) {
                        $("#arrow2").html("&#8595;");
                        $("#arrow2").css("color", "green");
                        $("#ratio2").html(Math.abs(ratio));
                    } else if (ratio > 0) {
                        $("#arrow2").html("&#8593;");
                        $("#arrow2").css("color", "red");
                        $("#ratio2").html(ratio);
                    } else {
                        $("#arrow2").html("-");
                        $("#ratio2").html(ratio);
                    }
                } else if (data.respCode == "200" && data.obj == null) {
                    mui.toast("暂无数据");
                }
            },
            complete: function(XMLHttpRequest, status) { //请求完成后最终执行参数
                if (status == 'timeout') {
                    $("#loading").hide();
                    $('#warn small').html('请求超时！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　　　　
                } else if (status == 'error') {
                    $("#loading").hide();
                    $('#warn small').html('网络异常！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　
                }　
            }
        });

    }


    // 月洗涤费用环比率查询
    function getWashingFeeRatio(time) {
        $("#num3").html("");
        $("#arrow3").html("");
        $("#ratio3").html("");
        $.ajax({
            url: baseUrl + 'app_fineReport.do?getClothWashingFeeRatio',
            type: 'get',
            data: {
                dataGroupCode: dataGroupCode,
                time: time
            },
            timeout: 30000,
            success: function(data) {
                var data = JSON.parse(data);
                console.log(data);
                if (data.respCode == "200") {
                    var ratio = data.obj.ratio;
                    var washingFee = data.obj.washingFee;
                    $("#num3").html(washingFee);
                    if (ratio < 0) {
                        $("#arrow3").html("&#8595;");
                        $("#arrow3").css("color", "green");
                        $("#ratio3").html(Math.abs(ratio));
                    } else if (ratio > 0) {
                        $("#arrow3").html("&#8593;");
                        $("#arrow3").css("color", "red");
                        $("#ratio3").html(ratio);
                    } else {
                        $("#arrow3").html("-");
                        $("#ratio3").html(ratio);
                    }
                }
            },
            complete: function(XMLHttpRequest, status) { //请求完成后最终执行参数
                if (status == 'timeout') {
                    $("#loading").hide();
                    $('#warn small').html('请求超时！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　　　　
                } else if (status == 'error') {
                    $("#loading").hide();
                    $('#warn small').html('网络异常！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　
                }　
            }
        });

    }

    // 月洗涤费用前十名科室占比查询
    function getTenProportion(time) {
        $("#container").html("");
        $.ajax({
            url: baseUrl + 'app_fineReport.do?getDeptWashingFeeTopTenProportion',
            type: 'get',
            data: {
                dataGroupCode: dataGroupCode,
                time: time
            },
            timeout: 30000,
            success: function(data) {
                var data = JSON.parse(data);
                console.log(data);
                if (data.respCode == "200" && data.obj != null && data.obj != "null") {
                    var list = data.obj;
                    console.log(list);
                    var dataArr = [];
                    for (var i = 0; i < list.length; i++) {
                        var item = {
                            name: list[i].deptName,
                            y: list[i].proport
                        }
                        dataArr.push(item);
                    }
                    titleText = "洗涤费占比饼状图";
                    load(dataArr, titleText);
                } else {
                    mui.toast("暂无数据")
                }

            },
            complete: function(XMLHttpRequest, status) { //请求完成后最终执行参数
                if (status == 'timeout') {
                    $("#loading").hide();
                    $('#warn small').html('请求超时！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　　　　
                } else if (status == 'error') {
                    $("#loading").hide();
                    $('#warn small').html('网络异常！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　
                }　
            }
        });

    }


    // 选择年度
    $('#selectY1 li').click(function() {
        $("#year1").html($(this).text());
        year1 = $(this).text();
        time1 = year1 + "-" + month1;
        getReclaimRatio(time1);
        getNeatIssueRatio(time1);
        getWashingFeeRatio(time1);
    });

    // 选择月份
    $('#selectM1 li').click(function() {
        $("#month1").html($(this).text());
        month1 = $(this).text();
        time1 = year1 + "-" + month1;
        getReclaimRatio(time1);
        getNeatIssueRatio(time1);
        getWashingFeeRatio(time1);
    });

    // 选择年度
    $('#selectY2 li').click(function() {
        $("#year2").html($(this).text());
        year2 = $(this).text();
        time2 = year2 + "-" + month2;
        getTenProportion(time2);
    });

    // 选择月份
    $('#selectM2 li').click(function() {
        $("#month2").html($(this).text());
        month2 = $(this).text();
        time2 = year2 + "-" + month2;
        getTenProportion(time2);
    });


    function load(data, titleText) {
        $(document).ready(function() {
            var chart = {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false
            };
            var title = {
                text: titleText
            };
            var tooltip = {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            };
            var plotOptions = {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true,
                        format: '<b>{point.name}%</b>: {point.percentage:.1f} %',
                        style: {
                            color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                        }
                    }
                }
            };
            var series = [{
                type: 'pie',
                // name: 'Browser share',
                data: data
            }];

            var json = {};
            json.chart = chart;
            json.title = title;
            json.tooltip = tooltip;
            json.series = series;
            json.plotOptions = plotOptions;
            $('#container').highcharts(json);
        });
    }



    mui.init({
        pullRefresh: {
            container: '#pullrefresh',
            down: {
                callback: pulldownRefresh,
                contentrefresh: "正在刷新",
            },
            up: {
                contentrefresh: "加载中，请稍后",
                contentnomore: '暂无更多数据',
                callback: pullupRefresh
            }
        }
    });

    /**
     * 下滑刷新
     * @return {[type]} [description]
     */
    function pulldownRefresh() {
        setTimeout(function() {
            html = '';
            page = 1;
            loadTask();
            mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
        }, 1500);
    }

    /**
     * 上滑加载更多
     * @return {[type]} [description]
     */
    function pullupRefresh() {
        page++;
        loadTask();
        setTimeout(function() {
            //关闭加载框
            mui('#pullrefresh').pullRefresh().endPullupToRefresh();
        }, 1500);
    }

    //调试代码
    // var html = '';
    // html = createTask("1","2","3","4","5","6","7","8","9","0");
    // $(".mui-content").html(html);
    //调试代码

    function createTask(itemID, taskID, taskCode, schemeName, machine_name, errorContent, writeValue) {
        var htmls = '<div id="' + itemID + '" class="task">';
        htmls += '<div class="task-title">所属任务：<span class="task_code">' + taskCode + '</span></div>';
        htmls += '<div class="mui-row task-info">';
        htmls += '<div class="mui-col mui-col-xs-12">任务名称：<span>' + schemeName + '</span></div>';
        htmls += '<div class="mui-col mui-col-xs-12">设备名称：<span class="machine">' + machine_name + '</span></div>';
        htmls += '<div class="mui-col mui-col-xs-12">异常描述：<span class="abnormal">' + errorContent + '</span></div>';
        htmls += '<div class="mui-col mui-col-xs-12">结果记录：<span>' + writeValue + '</span></div>';
        htmls += '</div>';
        htmls += '</div>';
        return htmls;
    }

    /**
     * mui清除按钮事件(ps:自定义的，不加此方法页面会报错，如果不需要，方法体为空就行)
     */
    function clearFunc() {

    }

    /**
     * mui返回方法(ps:自定义的,不加会报错,不需要的话方法体定义为空)
     * [goBack description]
     * @return {[type]} [description]
     */
    function goBack() {
        window.history.back();
    }
</script>

</html>