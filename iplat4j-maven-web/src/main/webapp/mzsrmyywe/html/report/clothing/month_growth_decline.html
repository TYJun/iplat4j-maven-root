<!doctype html>
<html class="no-js">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="reference/mui/css/mui.css">
    <link rel="stylesheet" href="reference/css/common.css" />
    <link rel="stylesheet" href="reference/mui/css/mui.picker.min.css">
    <link rel="stylesheet" href="reference/css/clothCommon.css" />
    <link rel="stylesheet" href="reference/bootstrap-3.3.5/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../../../css/android-ios.css">
</head>
<STYLE TYPE="text/css">
    body {
        background: #eee;
    }
    
    .task {
        width: 96%;
        background: #fff;
        margin: 0 auto;
        box-shadow: 1px 1px 10px #b9b9b9;
        margin-bottom: 10px;
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
        border-bottom-right-radius: 4px;
        border-bottom-left-radius: 4px;
        margin-top: 5px;
    }
    
    .task-title {
        width: 100%;
        height: 40px;
        line-height: 40px;
        padding-left: 15px;
        padding-right: 15px;
        background: #2589ad;
        color: #fff;
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
    }
    
    .task-info {
        padding-left: 15px;
        padding-right: 15px;
        padding-top: 10px;
        padding-bottom: 10px;
        border-bottom-right-radius: 4px;
        border-bottom-left-radius: 4px;
    }
    
    .first-tr {
        background: #08c1a3;
        height: 40px;
        line-height: 40px;
        color: #ffffff;
        text-align: center;
        /*border-radius: 5px;*/
        box-shadow: 0px 5px #F7F7F7;
    }
    
    .mask {
        height: 70%;
    }
    
    .backColor {
        background: #30c37c;
    }
    
    .dropdown-menu {
        min-width: 150px;
    }
    
    .col-lg-4,
    .col-md-4,
    .col-sm-4,
    .col-xs-4,
    .col-lg-6,
    .col-md-6,
    .col-sm-6,
    .col-xs-6 {
        padding-right: 0px;
        padding-left: 0px;
    }
    
    .dropdown-menu>li>a {
        padding: 6px 20px;
    }
    
    .row {
        margin-right: 0px;
        margin-left: 0px;
    }
    
    .content-table {
        background: #F7F7F7;
        overflow-y: auto;
        margin: 0px 2.2%;
        width: 95.6%;
    }
    
    .first-tr-other {
        height: 40px;
        line-height: 40px;
        color: #333;
        text-align: center;
        border-bottom: 1px solid #a1e4d9;
    }
    
    .first-tr-other:last-child {
        border-bottom: 0;
    }
</STYLE>

<body>
    <header class="mui-bar mui-bar-nav">
        <h1 class="mui-title">月布草增长及下降前十表</h1>
        <button class="mui-action-back mui-btn mui-btn-blue mui-btn-link mui-btn-nav mui-pull-left">
        <span class="mui-icon mui-icon-left-nav"></span>
        返回
      </button>
        <!-- <button id="search" class="mui-btn mui-btn-link mui-btn-nav mui-pull-right">
          <span>年月</span>
        </button> -->
    </header>

    <div id="warn" class="warn" hidden>
        <small></small>
    </div>
    <div class="mui-content">
        <div class="dropdown row">
            <div id="selectY1" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <button class="btn btn-default dropdown-toggle btn-block" type="button" style="border-radius:2px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            选择年度
            <span class="caret"></span>
            </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li><a href="#">2011</a></li>
                    <li><a href="#">2012</a></li>
                    <li><a href="#">2013</a></li>
                    <li><a href="#">2014</a></li>
                    <li><a href="#">2015</a></li>
                    <li><a href="#">2016</a></li>
                    <li><a href="#">2017</a></li>
                    <li><a href="#">2018</a></li>
                    <li><a href="#">2019</a></li>
                    <li><a href="#">2020</a></li>
                </ul>
            </div>
            <div id="selectM1" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <button class="btn btn-default dropdown-toggle btn-block" type="button" style="border-radius:2px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            选择月份
            <span class="caret"></span>
            </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li value="1"><a href="#">1</a></li>
                    <li value="2"><a href="#">2</a></li>
                    <li value="3"><a href="#">3</a></li>
                    <li value="4"><a href="#">4</a></li>
                    <li value="5"><a href="#">5</a></li>
                    <li value="6"><a href="#">6</a></li>
                    <li value="7"><a href="#">7</a></li>
                    <li value="8"><a href="#">8</a></li>
                    <li value="9"><a href="#">9</a></li>
                    <li value="10"><a href="#">10</a></li>
                    <li value="11"><a href="#">11</a></li>
                    <li value="12"><a href="#">12</a></li>
                </ul>
            </div>
        </div>
        <div style="padding: 8px;">
            <div class="mui-row first-tr" style="font-size: 17px;">
                <span id="year1">2020</span>年<span id="month1">9</span>月发放量增长前十名的布草表
            </div>
        </div>

        <div id="container1" style="margin: 0 auto;"></div>


        <div class="dropdown row" style="margin-top:50px;">
            <div id="selectY2" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <button class="btn btn-default dropdown-toggle btn-block" type="button" style="border-radius:2px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            选择年度
            <span class="caret"></span>
                    </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li><a href="#">2011</a></li>
                    <li><a href="#">2012</a></li>
                    <li><a href="#">2013</a></li>
                    <li><a href="#">2014</a></li>
                    <li><a href="#">2015</a></li>
                    <li><a href="#">2016</a></li>
                    <li><a href="#">2017</a></li>
                    <li><a href="#">2018</a></li>
                    <li><a href="#">2019</a></li>
                    <li><a href="#">2020</a></li>
                </ul>
            </div>
            <div id="selectM2" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <button class="btn btn-default dropdown-toggle btn-block" type="button" style="border-radius:2px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            选择月份
            <span class="caret"></span>
            </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li value="1"><a href="#">1</a></li>
                    <li value="2"><a href="#">2</a></li>
                    <li value="3"><a href="#">3</a></li>
                    <li value="4"><a href="#">4</a></li>
                    <li value="5"><a href="#">5</a></li>
                    <li value="6"><a href="#">6</a></li>
                    <li value="7"><a href="#">7</a></li>
                    <li value="8"><a href="#">8</a></li>
                    <li value="9"><a href="#">9</a></li>
                    <li value="10"><a href="#">10</a></li>
                    <li value="11"><a href="#">11</a></li>
                    <li value="12"><a href="#">12</a></li>
                </ul>
            </div>
        </div>
        <div style="padding: 8px;">
            <div class="mui-row first-tr" style="font-size: 17px;">
                <span id="year2">2020</span>年<span id="month2">9</span>月发放量下降前十名的布草表
            </div>
        </div>


        <div id="container2" style="margin: 0 auto;"></div>

    </div>


</body>
<script src="reference/mui/js/mui.js" type="text/javascript"></script>
<script src="reference/js/jquery-2.1.4.js" type="text/javascript"></script>
<script src="reference/bootstrap-3.3.5/js/bootstrap.min.js" type="text/javascript"></script>
<script src="reference/js/common.js" type="text/javascript"></script>
<script src="../js/echarts.min.js"></script>
<script type="text/javascript" src="reference/mui/js/mui.picker.min.js"></script>
<script type="text/javascript">
    var baseUrl = localStorage.getItem("url");
    var workNo = localStorage.getItem("workNo");
    var dataGroupCode = "BONA";
    var page = 1;
    var html = '';
    var date1 = new Date();
    var year1 = date1.getFullYear();
    var month1 = date1.getMonth() + 1;
    var time1 = year1 + '-' + month1;
    var date2 = new Date();
    var year2 = date2.getFullYear();
    var month2 = date2.getMonth() + 1;
    var time2 = year2 + '-' + month2;
    $("#year1").html(year1);
    $("#year2").html(year2);
    $("#month1").html(month1);
    $("#month2").html(month2);


    $(function() {
        var width = screen.width - 20;
        $('#container1').width(width);
        $('#container1').height(300);

        $('#container2').width(width);
        $('#container2').height(300);

        getGrowth(time1);

        getDecline(time2);

    });

    // 获取月布草发放量增长前十的布草
    function getGrowth(time) {
        $.ajax({
            url: baseUrl + 'app_fineReport.do?getClothTypeNameByGrowth',
            type: 'get',
            data: {
                dataGroupCode: dataGroupCode,
                time: time
            },
            timeout: 30000,
            success: function(data) {
                var data = JSON.parse(data);
                console.log(data);
                if (data.length != 0) {
                    var clothType = [];
                    var num = [];
                    for (var i = 0; i < data.length; i++) {
                        clothType.push(data[i].clothTypeName);
                        num.push(data[i].growth);
                    }
                    load1(clothType, num);
                } else {
                    mui.toast("暂无数据！");
                    var clothType = [];
                    var num = [];
                    load1(clothType, num);
                }

            },
            complete: function(XMLHttpRequest, status) { //请求完成后最终执行参数
                if (status == 'timeout') {
                    $("#loading").hide();
                    $('#warn small').html('请求超时！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　　　　
                } else if (status == 'error') {
                    $("#loading").hide();
                    $('#warn small').html('网络异常！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　
                }　
            }
        });

    }

    // 月布草发放量下降前十的布草
    function getDecline(time) {
        $.ajax({
            url: baseUrl + 'app_fineReport.do?getClothTypeNameByReduce',
            type: 'get',
            data: {
                dataGroupCode: dataGroupCode,
                time: time
            },
            timeout: 30000,
            success: function(data) {
                var data = JSON.parse(data);
                console.log(data);
                if (data.length != 0) {
                    var clothType = [];
                    var num = [];
                    for (var i = 0; i < data.length; i++) {
                        clothType.push(data[i].clothTypeName);
                        num.push(data[i].growth);
                    }
                    load2(clothType, num);
                } else {
                    mui.toast("暂无数据！");
                    var clothType = [];
                    var num = [];
                    load2(clothType, num);
                }

            },
            complete: function(XMLHttpRequest, status) { //请求完成后最终执行参数
                if (status == 'timeout') {
                    $("#loading").hide();
                    $('#warn small').html('请求超时！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　　　　
                } else if (status == 'error') {
                    $("#loading").hide();
                    $('#warn small').html('网络异常！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);　
                }　
            }
        });

    }


    function load1(clothType, num) {
        var myChart = echarts.init(document.getElementById('container1'));
        var index = 0;
        var colorList = ['#0093ff', '#0093ff', '#0093ff', '#0093ff'];
        var option = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            legend: {
                show: false
            },
            grid: {
                left: 100
            },
            toolbox: {
                show: true,
                feature: {
                    saveAsImage: {}
                }
            },
            xAxis: {
                type: 'value',

                splitLine: {
                    show: false
                },
                axisLabel: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                axisLine: {
                    show: false
                }

            },
            yAxis: {
                type: 'category',
                inverse: true,
                axisLine: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                axisPointer: {
                    label: {
                        show: true,
                        margin: 30
                    }
                },
                data: clothType,
                axisLabel: {
                    margin: 140,
                    fontSize: 14,
                    align: 'left',
                    color: '#333',
                    rich: {
                        a1: {
                            color: '#fff',
                            backgroundColor: colorList[0],
                            width: 30,
                            height: 30,
                            align: 'center',
                            borderRadius: 2
                        },
                        a2: {
                            color: '#fff',
                            backgroundColor: colorList[1],
                            width: 30,
                            height: 30,
                            align: 'center',
                            borderRadius: 2
                        },
                        a3: {
                            color: '#fff',
                            backgroundColor: colorList[2],
                            width: 30,
                            height: 30,
                            align: 'center',
                            borderRadius: 2
                        },
                        b: {
                            color: '#fff',
                            backgroundColor: colorList[3],
                            width: 30,
                            height: 30,
                            align: 'center',
                            borderRadius: 2
                        }
                    },
                    formatter: function(params) {
                        if (index == 11) {
                            index = 0;
                        }
                        index++;
                        if (index - 1 < 3) {
                            return [
                                '{a' + index + '|' + index + '}' + '  ' + params
                            ].join('\n')
                        } else {
                            return [
                                '{b|' + index + '}' + '  ' + params
                            ].join('\n')
                        }
                    }
                }
            },
            series: [{
                    z: 2,
                    name: 'value',
                    type: 'bar',
                    data: num.map((item, i) => {
                        itemStyle = {
                            color: i > 3 ? colorList[3] : colorList[i]
                        }
                        return {
                            value: item,
                            itemStyle: itemStyle
                        };
                    }),
                    label: {
                        show: true,
                        position: 'right',
                        color: '#333333',
                        fontSize: 14,
                        offset: [10, 0]
                    }
                }

            ]
        };
        myChart.setOption(option);
    }

    function load2(clothType, num) {
        var myChart = echarts.init(document.getElementById('container2'));
        var index = 0;
        var colorList = ['#0093ff', '#0093ff', '#0093ff', '#0093ff'];
        var option = {
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            legend: {
                show: false
            },
            grid: {
                left: 100
            },
            toolbox: {
                show: true,
                feature: {
                    saveAsImage: {}
                }
            },
            xAxis: {
                type: 'value',

                splitLine: {
                    show: false
                },
                axisLabel: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                axisLine: {
                    show: false
                }

            },
            yAxis: {
                type: 'category',
                inverse: true,
                axisLine: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                axisPointer: {
                    label: {
                        show: true,
                        margin: 30
                    }
                },
                data: clothType,
                axisLabel: {
                    margin: 140,
                    fontSize: 14,
                    align: 'left',
                    color: '#333',
                    rich: {
                        a1: {
                            color: '#fff',
                            backgroundColor: colorList[0],
                            width: 30,
                            height: 30,
                            align: 'center',
                            borderRadius: 2
                        },
                        a2: {
                            color: '#fff',
                            backgroundColor: colorList[1],
                            width: 30,
                            height: 30,
                            align: 'center',
                            borderRadius: 2
                        },
                        a3: {
                            color: '#fff',
                            backgroundColor: colorList[2],
                            width: 30,
                            height: 30,
                            align: 'center',
                            borderRadius: 2
                        },
                        b: {
                            color: '#fff',
                            backgroundColor: colorList[3],
                            width: 30,
                            height: 30,
                            align: 'center',
                            borderRadius: 2
                        }
                    },
                    formatter: function(params) {
                        if (index == 11) {
                            index = 0;
                        }
                        index++;
                        if (index - 1 < 3) {
                            return [
                                '{a' + index + '|' + index + '}' + '  ' + params
                            ].join('\n')
                        } else {
                            return [
                                '{b|' + index + '}' + '  ' + params
                            ].join('\n')
                        }
                    }
                }
            },
            series: [{
                    z: 2,
                    name: 'value',
                    type: 'bar',
                    data: num.map((item, i) => {
                        itemStyle = {
                            color: i > 3 ? colorList[3] : colorList[i]
                        }
                        return {
                            value: item,
                            itemStyle: itemStyle
                        };
                    }),
                    label: {
                        show: true,
                        position: 'right',
                        color: '#333333',
                        fontSize: 14,
                        offset: [10, 0]
                    }
                }

            ]
        };
        myChart.setOption(option);
    }




    // 选择年度
    $('#selectY1 li').click(function() {
        $("#year1").html($(this).text());
        year1 = $(this).text();
        time1 = year1 + "-" + month1;
        getGrowth(time1);
    });

    // 选择月份
    $('#selectM1 li').click(function() {
        $("#month1").html($(this).text());
        month1 = $(this).text();
        time1 = year1 + "-" + month1;
        getGrowth(time1);
    });

    // 选择年度
    $('#selectY2 li').click(function() {
        $("#year2").html($(this).text());
        year2 = $(this).text();
        time2 = year2 + "-" + month2;
        getDecline(time2);
    });

    // 选择月份
    $('#selectM2 li').click(function() {
        $("#month2").html($(this).text());
        month2 = $(this).text();
        time2 = year2 + "-" + month2;
        getDecline(time2);
    });

    mui.init({
        pullRefresh: {
            container: '#pullrefresh',
            down: {
                callback: pulldownRefresh,
                contentrefresh: "正在刷新",
            },
            up: {
                contentrefresh: "加载中，请稍后",
                contentnomore: '暂无更多数据',
                callback: pullupRefresh
            }
        }
    });

    /**
     * 下滑刷新
     * @return {[type]} [description]
     */
    function pulldownRefresh() {
        setTimeout(function() {
            html = '';
            page = 1;
            loadTask();
            mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
        }, 1500);
    }

    /**
     * 上滑加载更多
     * @return {[type]} [description]
     */
    function pullupRefresh() {
        page++;
        loadTask();
        setTimeout(function() {
            //关闭加载框
            mui('#pullrefresh').pullRefresh().endPullupToRefresh();
        }, 1500);
    }

    //调试代码
    // var html = '';
    // html = createTask("1","2","3","4","5","6","7","8","9","0");
    // $(".mui-content").html(html);
    //调试代码

    function createTask(itemID, taskID, taskCode, schemeName, machine_name, errorContent, writeValue) {
        var htmls = '<div id="' + itemID + '" class="task">';
        htmls += '<div class="task-title">所属任务：<span class="task_code">' + taskCode + '</span></div>';
        htmls += '<div class="mui-row task-info">';
        htmls += '<div class="mui-col mui-col-xs-12">任务名称：<span>' + schemeName + '</span></div>';
        htmls += '<div class="mui-col mui-col-xs-12">设备名称：<span class="machine">' + machine_name + '</span></div>';
        htmls += '<div class="mui-col mui-col-xs-12">异常描述：<span class="abnormal">' + errorContent + '</span></div>';
        htmls += '<div class="mui-col mui-col-xs-12">结果记录：<span>' + writeValue + '</span></div>';
        htmls += '</div>';
        htmls += '</div>';
        return htmls;
    }

    /**
     * mui清除按钮事件(ps:自定义的，不加此方法页面会报错，如果不需要，方法体为空就行)
     */
    function clearFunc() {

    }

    /**
     * mui返回方法(ps:自定义的,不加会报错,不需要的话方法体定义为空)
     * [goBack description]
     * @return {[type]} [description]
     */
    function goBack() {
        window.history.back();
    }
</script>

</html>