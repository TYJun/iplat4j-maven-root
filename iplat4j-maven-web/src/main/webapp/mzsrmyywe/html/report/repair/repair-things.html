<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="reference/mui/css/mui.min.css">
    <link href="css/buttom.css" rel="stylesheet" />
    <link href="css/iconfont.css" rel="stylesheet" />
    <link href="css/mui.picker.min.css" rel="stylesheet" />
    <link href="reference/css/common.css" rel="stylesheet" />
    <link href="reference/css/loading.css" rel="stylesheet" />

    <style>
        .mui-backdrop {
            top: 95px;
        }
        
        .keshi-ymd-span {
            height: 45px;
            line-height: 45px;
            display: block;
            width: 50%;
            margin-left: 25%;
            font-size: 15px;
            /*border-bottom:2px  solid #2aabd2;*/
        }
        
        .keshi-shuidianqi {
            box-shadow: 0px 8px 20px #d1d1d1;
            margin: 20px 0px;
        }
        
        .first-tr {
            height: 35px;
            line-height: 35px;
            font-weight: bolder;
            color: #333;
            text-align: center;
            border-bottom: 1px solid #a1e4d9;
        }
        
        .first-tr-other {
            height: 45px;
            line-height: 45px;
            color: #333;
            text-align: center;
            border-bottom: 1px solid #a1e4d9;
        }
        
        .content-content {
            background: #F7F7F7;
            margin-top: 15px;
        }
        
        .content-titles {
            height: 50px;
            display: flex;
            justify-content: center;
        }
        
        .content-title1 {
            height: 40px;
            width: 3%;
            background: #ff7d7d;
        }
        
        .content-title2 {
            height: 40px;
            width: 63%;
            background: #09c2a3;
            margin-left: 2%;
            color: #fff;
            text-align: center;
            line-height: 40px;
            font-size: 15px;
        }
    </style>
</head>

<body>
    <header class="mui-bar mui-bar-nav">
        <button onclick="goback()" class="mui-btn mui-btn-link mui-btn-nav mui-pull-left">
        <span class="mui-icon mui-icon-left-nav"></span>
        返回
      </button>
        <h1 class="mui-title">维修事项与分类统计</h1>

    </header>
    <div id="warn" class="warn" hidden>
        <small></small>
    </div>

    <div id="loading" class="loading-div" style="z-index: 999;" hidden>
        <div class="loading-center">
            <div class="loading-center-absolute">
                <div class="object" id="object_one"></div>
                <div class="object" id="object_two"></div>
                <div class="object" id="object_three"></div>
                <div class="object" id="object_four"></div>
            </div>
        </div>
    </div>
    <div class="mui-content">
        <div class="keshi">
            <div class="keshi-ymd">
                <div class="mui-row " style="background: #fbf7fc;text-align: center;box-shadow: 0px 5px  #F7F7F7;">
                    <div class="mui-col-sm-4 mui-col-xs-4 year-button" style="">
                        <span class="keshi-ymd-span keshi-year-span">年度</span>
                    </div>
                    <div class="mui-col-sm-4 mui-col-xs-4 jidu-button" style="">

                        <span class="keshi-ymd-span keshi-jidu-span">季度</span>
                    </div>
                    <div class="mui-col-sm-4 mui-col-xs-4 month-button">

                        <span class="keshi-ymd-span keshi-month-span">月份</span>
                    </div>
                </div>
            </div>

        </div>

        <div class="content-main" style="margin-top: 15px;padding: 0px  7px;">
            <div class="content-content ">
                <div class="content-titles">
                    <div class="content-title1"></div>
                    <div class="content-title2">前5项统计报表</div>
                </div>
                <div class="mui-row first-tr">
                    <div class="mui-col mui-col-xs-3">
                        <span>序号</span>
                    </div>
                    <div class="mui-col mui-col-xs-6">
                        <span>维修事项</span>
                    </div>
                    <div class="mui-col mui-col-xs-3">
                        <span>数量</span>
                    </div>
                </div>
                <div class="content-content1"></div>
                <!--<div class="mui-row first-tr-other">
						<div class="mui-col mui-col-xs-3">
							<span>序号</span>
						</div>
						<div class="mui-col mui-col-xs-6">
							<span>维修事项</span>
						</div>
						<div class="mui-col mui-col-xs-3">
							<span>数量</span>
						</div>
					</div>
					<div class="mui-row first-tr-other">
						<div class="mui-col mui-col-xs-3">
							<span>序号</span>
						</div>
						<div class="mui-col mui-col-xs-6">
							<span>维修事项</span>
						</div>
						<div class="mui-col mui-col-xs-3">
							<span>数量</span>
						</div>
					</div>-->

            </div>
            <div class="content-content ">
                <div class="content-titles">
                    <div class="content-title1"></div>
                    <div class="content-title2">维修分类统计报表</div>
                </div>
                <div class="mui-row first-tr">
                    <div class="mui-col mui-col-xs-3">
                        <span>序号</span>
                    </div>
                    <div class="mui-col mui-col-xs-6">
                        <span>维修事项</span>
                    </div>
                    <div class="mui-col mui-col-xs-3">
                        <span>数量</span>
                    </div>
                </div>
                <div class="content-content2"></div>

            </div>
        </div>
    </div>
    <p class="no-views" style="display: none;">———&nbsp;&nbsp;暂无数据&nbsp;&nbsp;———</p>

</body>
<script type="text/javascript" src="js/jquery-2.1.4.js"></script>
<script type="text/javascript" src="js/mui.js"></script>
<script type="text/javascript" src="js/mui.picker.min.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script src="../../../cordova.js" type="text/javascript"></script>
<!-- <script type="text/javascript" src="js/report-self.js"></script> -->

<script>
    var baseUrl = localStorage.getItem("url");
    var workNo = localStorage.getItem("workNo");
    var deptCode = localStorage.getItem("deptCode");
    //		$(".content-table").height($(window).height() - 188 + "px");
    var moveGetYear = [],
        moveGetJidu = [],
        moveGetMonth = [],
        ymdArr = ["", "", ""];
    var chooseYearPicker = null,
        chooseJiduPicker = null,
        chooseMonthPicker = null;
    var yearValue = "",
        jiduValue = "",
        monthValue = "",
        flag = "M",
        canshuYear = "",
        canshuSeason = "",
        canshuMonth = "";
    var yearValueCom = "";
    //getCurrentDate();
    //加载年份、季度、月份选择器
    function getCurrentDate(yearValueSelf) {
        moveGetMonth = [];
        var year = '';
        var month = "";
        /*
         * 1.如果yearValueSelf==undifined表示第一次加载，显示当前年份实际季度和月份
         * 2.否则表示已经选择过年份
         *    如果月份为当前月份则同样显示实际季度和月份
         *     否则月份置位12季度变为4季度
         * */
        console.log(yearValueSelf)
        if (yearValueSelf == "undefined" || yearValueSelf == undefined || yearValueSelf == yearValueCom) {

            var now = new Date();
            year = now.getFullYear(); //年  
            month = now.getMonth() + 1; //月 
            for (var f = year - 9; f <= year; f++) {
                moveGetYear.push(f);
            }
            yearValueCom = year;
            if (yearValueSelf == yearValueCom) {
                flag = "Y";
            } else {
                flag = "M";
                $(".keshi-month-span").css({
                    "color": "#2aabd2",
                    "border-bottom": "2px solid #2aabd2"
                });
            }

        } else {
            flag = "Y";
            year = yearValueSelf; //年  
            month = 12; //月 
        }

        for (var a = 1; a <= month; a++) {
            var monthSelf = a;
            moveGetMonth.push(monthSelf);
        }
        if (month < 4) {
            moveGetJidu = ['一季度'];
        } else if (month < 7) {
            moveGetJidu = ['一季度', '二季度'];
        } else if (month < 10) {
            moveGetJidu = ['一季度', '二季度', '三季度'];
        } else if (month < 13) {
            moveGetJidu = ['一季度', '二季度', '三季度', '四季度'];
        }
        $(".keshi-year-span").text(year + "年");
        $(".keshi-jidu-span").text(moveGetJidu[moveGetJidu.length - 1]);
        $(".keshi-month-span").text(month + "月");

        canshuYear = year;
        canshuSeason = moveGetJidu[moveGetJidu.length - 1];
        canshuMonth = month;
        loadView();
    }
    //年份、季度、月份切换
    mui("body").on('tap', ".keshi-ymd-span", function() {
        $(".keshi-ymd-span").css({
            "color": "#333",
            "border-bottom": "0px"
        })
        $(this).css({
            "color": "#2aabd2",
            "border-bottom": "2px solid #2aabd2"
        })
    });

    //年份选择
    mui("body").on('tap', ".year-button", function() {
        chooseYMD();
        chooseYear();
    });

    function chooseYear() {
        ymdArr = ["year", "", ""]
        chooseYearPicker = new mui.PopPicker();
        chooseYearPicker.setData(moveGetYear);
        chooseYearPicker.show(function(rs) {
            yearValue = rs;
            $(".keshi-year-span").text(yearValue[0] + "年");
            flag = "Y";
            canshuYear = yearValue[0];
            getCurrentDate(yearValue[0]);
        });
    }

    function hideYear() {
        chooseYearPicker.hide();
        chooseYearPicker.dispose();
    }
    //季度选择
    mui("body").on('tap', ".jidu-button", function() {
        chooseYMD();
        chooseJidu();
    });

    function chooseJidu() {
        ymdArr = ["", "jidu", ""];
        chooseJiduPicker = new mui.PopPicker();
        chooseJiduPicker.setData(moveGetJidu);
        chooseJiduPicker.show(function(rs) {
            jiduValue = rs;
            $(".keshi-jidu-span").text(jiduValue[0]);
            console.log(moveGetJidu.indexOf(jiduValue[0]))
            flag = "S";

            canshuSeason = moveGetJidu.indexOf(jiduValue[0]) + 1;
            loadView();
        });
    }

    function hideJidu() {
        chooseJiduPicker.hide();
        chooseJiduPicker.dispose();
    }
    //月份选择
    mui("body").on('tap', ".month-button", function() {
        chooseYMD();
        chooseMonth();
    });

    function chooseMonth() {
        ymdArr = ["", "", "month"];
        chooseMonthPicker = new mui.PopPicker();
        chooseMonthPicker.setData(moveGetMonth);
        chooseMonthPicker.show(function(rs) {
            monthValue = rs;
            $(".keshi-month-span").text(monthValue[0] + "月");
            flag = "M";
            canshuMonth = monthValue[0];
            loadView();
        });
    }

    function hideMonth() {
        chooseMonthPicker.hide();
        chooseMonthPicker.dispose();
    }

    //年份、季度、月份hide
    function chooseYMD() {

        if (ymdArr[0] != "") {
            hideYear();
        } else if (ymdArr[1] != "") {
            hideJidu();
        } else if (ymdArr[2] != "") {
            hideMonth();
        }
    }

    document.addEventListener("deviceready", onDeviceReady, false);

    function onDeviceReady() {
        /**
         * 系统返回键监听
         */
        document.addEventListener("backbutton", onBackKeyDown, false);
    }

    /**
     * 系统返回键方法
     * @return {[type]} [description]
     */
    function onBackKeyDown() {
        history.back(-1);
    }

    function goback() {
        history.back(-1);
    }
    getCurrentDate();

    function loadView() {
        var prame = {
            flag: flag,
            year: canshuYear,
            season: canshuSeason,
            month: canshuMonth,
            workNo: workNo,
            dept: deptCode
        }
        var prames = JSON.stringify(prame)
        console.log(prames)
        $.ajax({
            url: baseUrl + "MobileAgentService",
            type: "post",
            headers: {
                methodName: "getWxsxfl",
                serviceName: "MTYD01"
            },
            data: {
                prames
            },
            success: function(data) {
                // var data = eval("(" + data + ")");
                console.log(data)

                var taskAppend = "",
                    taskAppend2 = "";

                if (data.status == 1) {
                    var list = data.attr.list;
                    var list2 = data.attr.Wxsxlist;
                    if (list.length == 0) {
                        taskAppend += '<div class="mui-row first-tr-other">';
                        taskAppend += '<div class="mui-col mui-col-xs-12">';
                        taskAppend += '	<span>无</span>';
                        taskAppend += '</div>';
                        taskAppend += '</div>';
                    }
                    if (list2.length == 0) {
                        taskAppend2 += '<div class="mui-row first-tr-other">';
                        taskAppend2 += '<div class="mui-col mui-col-xs-12">';
                        taskAppend2 += '	<span>无</span>';
                        taskAppend2 += '</div>';
                        taskAppend2 += '</div>';
                    }
                    for (var i = 0; i < list.length; i++) {
                        taskAppend += createHtml1(i + 1, list[i].itName, list[i].num);
                    }
                    for (var j = 0; j < list2.length; j++) {
                        taskAppend2 += createHtml2(j + 1, list2[j].item_type_name, list2[j].num);
                    }
                    $(".content-content1").html(taskAppend);
                    $(".content-content2").html(taskAppend2);

                } else {
                    showMsg(data.respMsg);

                }
            }

        });
    }

    function createHtml2(no, itemName, num) {
        var html = "";

        html += '<div class="mui-row first-tr-other">';
        html += '<div class="mui-col mui-col-xs-3">';
        html += '	<span>' + no + '</span>';
        html += '</div>';
        html += '<div class="mui-col mui-col-xs-6">';
        html += '<span>' + itemName + '</span>';
        html += '</div>';
        html += '<div class="mui-col mui-col-xs-3">';
        html += '	<span>' + num + '</span>';
        html += '</div>';
        html += '</div>';
        return html;
    }

    function createHtml1(no, itemName, num) {
        var html = "";

        html += '<div class="mui-row first-tr-other">';
        html += '<div class="mui-col mui-col-xs-3">';
        html += '	<span>' + no + '</span>';
        html += '</div>';
        html += '<div class="mui-col mui-col-xs-6">';
        html += '<span>' + itemName + '</span>';
        html += '</div>';
        html += '<div class="mui-col mui-col-xs-3">';
        html += '	<span>' + num + '</span>';
        html += '</div>';
        html += '</div>';
        return html;
    }
</script>

</html>