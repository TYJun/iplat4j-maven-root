<!DOCTYPE html>
<html class="no-js">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="renderer" content="webkit" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="stylesheet" href="../reference/mui/css/mui.min.css" />
    <link rel="stylesheet" href="../reference/css/common.css" />
    <link rel="stylesheet" href="../reference/mui/css/mui.picker.min.css" />
    <link rel="stylesheet" href="css/tcj-font.css" />
</head>
<style type="text/css">
    body,
    html {
        height: 100%;
        background: #f7f7f7;
    }
    
    .row-content {
        height: 35px;
        line-height: 35px;
        padding: 0 15px;
        /*border-bottom: 1px solid #EEEEEE;*/
        font-size: 14px;
        color: #666666;
        background: #ffffff;
    }
    
    .row-right {
        text-align: right;
        color: #333333;
    }
    
    .new-icon-color {
        color: #aaa;
    }
    
    .new-list-content {
        padding: 15px 0;
        background: #fff;
    }
    
    .apply-content1 {
        text-align: left;
        height: 35px;
        line-height: 47px;
        /*font-weight: lighter;*/
    }
    
    .apply-content2 {
        text-align: left;
        height: 35px;
        /*font-weight: lighter;*/
        font-size: 11px;
    }
    
    .apply-bottom {
        border-bottom: 1px solid #eee;
    }
    
    .apply-bottom:last-child {
        border-bottom: 0;
    }
    
    .apply-bottom:last-child {
        border-bottom: 0;
    }
    
    .bottom-list {
        background: #fff;
        padding: 0 15px;
        margin-top: 10px;
        overflow-y: auto;
    }
    
    .new-row-tcj {
        height: 50px;
        line-height: 50px;
        font-size: 19px;
        position: fixed;
        width: 100%;
        bottom: 0;
        text-align: center;
        background: #41bde2;
        color: #fff;
    }
    
    .mui-input-group:before {
        height: 0px;
    }
    
    .mui-input-group:after {
        height: 0;
    }
    
    .mui-input-group .mui-input-row:after {
        height: 0px;
    }
    
    .mui-checkbox input[type="checkbox"]:checked:before,
    .mui-radio input[type="radio"]:checked:before {
        color: #62ccec;
    }
    
    .eval-bottons {
        padding: 20px 0;
        border-bottom: 1px solid #eee;
    }
    
    .say-what-content {
        outline: none;
        border: 0;
        background: #fff;
        height: 120px;
        text-indent: 1em;
        letter-spacing: 2px;
        color: #acacac;
        margin-bottom: 0px;
    }
    
    .showphotos {
        display: flex;
        flex-wrap: wrap;
        /*justify-content: space-between;*/
    }
    
    .add-picture {
        height: 70px;
        width: 70px;
        line-height: 70px;
        border: 1px dashed #ccc;
        text-align: center;
        color: #ccc;
        margin: 10px 0 0 10px;
    }
    /*拍照*/
    
    .pic-show {
        position: fixed;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        z-index: 99;
        background: #000;
    }
    
    .pictures {
        /*border-bottom: 1px solid #E1E1E1;*/
        /*padding-top: 10px;
			padding-left: 2%;
			margin-bottom: 8px;*/
        background-color: #ffffff;
    }
    
    .pictures img {
        height: 70px;
        width: 70px;
        margin: 10px 0 0 10px;
    }
    
    .rangePictues img {
        height: 0px;
        width: 0%;
    }
    
    .flex {
        display: -webkit-box;
        display: -webkit-flex;
        display: -ms-flexbox;
        display: flex;
    }
    
    .flex-align-center {
        -webkit-box-align: center;
        -webkit-align-items: center;
        -ms-flex-align: center;
        align-items: center;
    }
    
    .flex-pack-justify {
        -webkit-box-pack: center;
        -webkit-justify-content: center;
        -ms-flex-pack: center;
        justify-content: center;
    }
    
    #delPic {
        position: fixed;
        width: 100%;
        color: #ffffff;
        background: #2aabd2;
        border: 0;
        bottom: 0;
        height: 50px;
        line-height: 50px;
        font-size: 19px;
        text-align: center;
    }
</style>

<body>
    <header class="mui-bar mui-bar-nav">
        <h1 class="mui-title" id="beforeTitle">配送任务评价</h1>
        <button onclick="history.back(-1)" class="mui-btn mui-btn-blue mui-btn-link mui-btn-nav mui-pull-left">
        <span class="mui-icon mui-icon-left-nav"></span>
        返回
      </button>
    </header>

    <div id="warn" class="warn" hidden>
        <small></small>
    </div>

    <div id="loading" class="loading1" hidden>
        <div class="loading2">
            <span class="mui-spinner" style="width: 80px; height: 80px"></span>
        </div>
    </div>

    <div class="mui-content">
        <div class="new-list-content">
            <div class="mui-row row-content">
                <div class="mui-col-sm-12 mui-col-xs-12">
                    <span class="mui-icon iconfont icon-apply-keshi new-icon-color"></span> 配送科室：
                    <span class="send-dept"></span>
                </div>
            </div>
            <div class="mui-row row-content">
                <div class="mui-col-sm-12 mui-col-xs-12">
                    <span class="mui-icon iconfont icon-jiaohuo-date new-icon-color"></span> 配送日期：
                    <span class="send-time"> </span>
                </div>
            </div>
        </div>

        <div class="bottom-list">
            <!-- 材料显示 -->
            <div class="bottom-list-new">
            </div>
            <div class="eval-bottons">
                <form class="mui-input-group" style="display: flex; flex-wrap: wrap">
                    <div class="mui-input-row mui-radio mui-left">
                        <label>很满意</label>
                        <input name="checkbox" value="5" type="radio" checked />
                    </div>
                    <div class="mui-input-row mui-radio mui-left">
                        <label>满意</label>
                        <input name="checkbox" value="4" type="radio" />
                    </div>
                    <div class="mui-input-row mui-radio mui-left">
                        <label>一般</label>
                        <input name="checkbox" value="3" type="radio" />
                    </div>
                    <div class="mui-input-row mui-radio mui-left">
                        <label>不满意</label>
                        <input name="checkbox" value="2" type="radio" />
                    </div>
                    <div class="mui-input-row mui-radio mui-left">
                        <label>很不满意</label>
                        <input name="checkbox" value="1" type="radio" />
                    </div>
                </form>
            </div>
            <!-- <div class="say-what">
                <textarea class="say-what-content" placeholder="来点评价吧"></textarea>
            </div> -->
        </div>
    </div>

    <div class="new-row-tcj">提交</div>
    </div>
</body>
<script src="../reference/mui/js/mui.min.js" type="text/javascript"></script>
<script src="../reference/js/jquery-2.1.4.js" type="text/javascript"></script>
<script src="../reference/js/common.js" type="text/javascript"></script>
<script src="../reference/mui/js/mui.picker.min.js" type="text/javascript"></script>
<script src="../../cordova.js" type="text/javascript"></script>
<script src="js/$ajax.js" type="text/javascript"></script>
<script type="text/javascript">
    var baseUrl = localStorage.getItem("url");
    var workNo = localStorage.getItem("workNo");
    var deptNum = localStorage.getItem("deptCode");

    var url = location.search;
    var jsonBackString = url.substring(1, url.length);
    var jsonBackObj = JSON.parse(decodeURIComponent(jsonBackString));
    console.log(jsonBackObj);
    $(".bottom-list").css("height", $(window).height() - 229 + "px");
    var id = jsonBackObj.id;
    $(".send-dept").text(jsonBackObj.transportDeptName);
    $(".send-time").text(jsonBackObj.transportTime);
    loadView();

    function loadView() {
        var prames = {
            id: id,
        };
        prames = JSON.stringify(prames);
        $ajax("query", "MDPS0102", prames, (res) => {
            console.log(res.blocks.result.rows);
            var list = res.blocks.result.rows;
            var tasklist = "";
            list.map((item, index) => {
                tasklist += creatView(
                    item.matNum,
                    item.matName,
                    item.matModel,
                    item.deliveryNum,
                    item.unitName,
                    index
                );
            });
            $(".bottom-list-new").html(tasklist);
        });
    }

    function creatView(matNum, matName, matModel, applyNum, unit, i) {
        var html = "";
        html += '<div class="mui-row apply-bottom ">';
        html +=
            '<div class="mui-col-sm-1 mui-col-xs-1" style="line-height: 70px;">' +
            (i + 1) +
            ".</div>";
        html += '<div class="mui-col-sm-6 mui-col-xs-6">';
        html += '<div class="apply-content1">' + matName + "</div>";
        html +=
            '<div class="apply-content2">型号&nbsp;&nbsp;' + matModel + "</div>";
        html += "</div>";
        html += '<div class="mui-col-sm-5 mui-col-xs-5">';
        html +=
            '<div class="apply-content1" style="text-align: right;">' +
            applyNum +
            unit +
            "</div>";
        html += '<div class="apply-content2">';
        html += "</div>";
        html += "</div>";
        html += "</div>";
        return html;
    }
    //提交
    mui("body").on("tap", ".new-row-tcj", function() {
        var score = "";
        $("input[type='radio']:checked").each(function() {
            score = this.value;
        });
        // console.log(score);
        $("#loading").show();
        var prames = {
            deliveryNo: jsonBackObj.transportBillNo,
            statusCode: jsonBackObj.status,
            taskEval: score
        };
        prames = JSON.stringify(prames);
        $ajax("updateStatus", "MDPSAPP", prames, (res) => {
            console.log(res);
            if (res.status == "0") {
                showMsg("评价成功");
                setTimeout('location.href="dept-send-eval.html";', 2000);
            } else {
                $("#loading").hide();
                showMsg(res.respMsg);
            }
        });
        // $("#loading").show();
        // var prames = {
        //     id: id,
        // };
        // data: {
        //         transportBillNo: transportBillNo,
        //         taskEval: score, //评价打分
        //         taskEvalMemo: $(".say-what-content").val(), //评价意见
        //     },
        // prames = JSON.stringify(prames);
        // $ajax("query", "MDPS0102", prames, (res) => {
        //     console.log(res.blocks.result.rows);
        //     if (data.respCode == "200") {

        // } else {
        //             $("#loading").hide();
        //             showMsg(data.respMsg);
        //         }
        // });
    });
    document.addEventListener("deviceready", onDeviceReady, false);

    function onDeviceReady() {
        document.addEventListener("backbutton", onBackKeyDown, false);
    }

    function onBackKeyDown() {
        history.back(-1);
    }
</script>

</html>