(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1fef27f7"],{"17f9":function(e,t,a){"use strict";a.r(t);var s=a("1da1"),r=(a("4662"),a("28a2")),n=(a("e7e5"),a("d399")),i=a("ade3"),u=(a("96cf"),a("d81d"),a("b0c0"),a("a434"),a("b64b"),a("365c")),o={name:"complete-button",props:{},render:function(){var r=this,t=arguments[0];return t("div",{class:"complete-button"},[t("div",[t("div",{class:"complete-button-image"},[this.upload_list.map(function(a,e){return t("div",{class:"data-upload-center-container"},[t("div",{class:"data-upload-center-sign-image"},[t("global-van-uploader",{attrs:{"file-list":r.file_list[a.key],multiple:!0,"max-count":3,"max-size":8388608},on:{delete:function(e,t){return r.uploader_uploader_delete(a.key,e.file_id)},oversize:function(){return r.uploader_oversize()}},scopedSlots:{default:function(e){return t("span")},previewCover:function(e){return t("div",{class:"data-upload-center-sign-image-item-uploader",on:{click:function(){return r.uploading_image_preview(a.key)}}},[t("img",{attrs:{width:"80",height:"80",src:e.url}})])}}})]),t("global-van-field",{attrs:{center:!0,clearable:!0,disabled:!0,required:!0,label:a.text,placeholder:""},class:"data-upload-center-button-field"},[t("template",{slot:"button"},[t("global-tap",{on:{tap:function(){return r.uploader_photograph_local_tap(a.key,"CAMERA",a.resources)}}},[t("global-van-button",{attrs:{icon:"photograph",type:"primary"}},["相机拍摄"])]),t("global-tap",{class:"complete-button-loader",on:{tap:function(){return r.uploader_photograph_local_tap(a.key,"PHOTOLIBRARY",a.resources)}}},[t("global-van-button",{attrs:{icon:"photo-fail",type:"primary"}},["本地上传"])])])])])})])]),t("global-tap",{class:"complete-button-sumbit",on:{tap:function(){r.complete_sumbit_tap()}}},[t("global-van-button",{attrs:{disabled:this.disabled,type:"primary"}},["完工"])])])},data:function(){var e={file_ids:[],projectId:this.$route.query,disabled:!0,capture:["camera"],workNo:localStorage.getItem("workNo"),name:localStorage.getItem("name"),deptCode:localStorage.getItem("deptCode"),deptName:localStorage.getItem("deptName")};return Object(i.a)(e,"projectId",this.$route.query),Object(i.a)(e,"upload_list",[{text:"完工",key:"complete",resources:"06"}]),Object(i.a)(e,"file_list",{complete:[]}),Object(i.a)(e,"files",{complete:[]}),Object(i.a)(e,"photo_preview",{}),e},watch:{file_list:{handler:function(e,t){this.change_button_type()},deep:!0,immediate:!0}},methods:(o={change_button_type:function(){1<=this.file_list.complete.length?this.disabled=!1:this.disabled=!0},complete_sumbit_tap:function(){this.sumbit_tap_message(),this.$router.push("/hazardous-operation"),n.a.success("提交成功")},uploading_image_preview:function(e){Object(r.a)([e])},uploader_after:function(a,r,n,i){var o=this;return Object(s.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.$toast.loading({message:"上传中...",duration:0,forbidClick:!0}),o.files[r].push(n),e.next=4,Object(u.i)({workNo:o.workNo,name:o.name,relateId:o.projectId.id,statusCode:"05",fileResources:i,base64:n,fileName:"".concat((new Date).getTime(),".png")});case 4:t=e.sent,o.$toast.clear(),t.success?(o.file_list[r].push({url:a,base64:n,file_id:t.data}),o.emit_file_ids()):o.$notify({type:"danger",message:"上传失败"});case 7:case"end":return e.stop()}},e)}))()},uploader_uploader_delete:function(a,r){var n=this;this.file_list[a].map(function(e,t){return e.file_id==r&&n.file_list[a].splice(t,1)}),this.emit_file_ids()},uploader_delete:function(a,r){var n=this;this.file_list[a].map(function(e,t){return e.file_id==r&&n.file_list[a].splice(t,1)}),this.emit_file_ids()},emit_file_ids:function(){var t=this,a=[];Object.keys(this.file_list).map(function(e){return t.file_list[e].map(function(e){return a.push(e.file_id)})}),this.file_ids=a,this.$emit("uploader",a)},uploader_photograph_local_tap:function(r,a,n){var i=this;return Object(s.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t={PHOTOLIBRARY:{destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!1,mediaType:Camera.MediaType.PICTURE},CAMERA:{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1}},i.m_native_camera_get_picture(t[a],function(){var t=Object(s.a)(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[function(){return i.$notify({type:"danger",message:"您未拍照或者未选择照片"})},function(){var t=Object(s.a)(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.$utils.getImgToBase64(t);case 2:a=e.sent,i.uploader_after(t,r,a,n);case 4:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()],e.t0=t.success,e.t0)return e.next=5,a[t.data.status](t.data.url);e.next=5;break;case 5:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return e.stop()}},e)}))()}},Object(i.a)(o,"uploading_image_preview",function(e){Object(r.a)(this.file_list[e].map(function(e){return e.url}))}),Object(i.a)(o,"sumbit_tap_message",function(){var t=this;return Object(s.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(u.c)({workNo:t.workNo,name:t.name,projectId:t.projectId.id});case 2:case"end":return e.stop()}},e)}))()}),o)},a=(a("520e"),a("2877")),o=Object(a.a)(o,void 0,void 0,!1,null,"3276cd99",null);t.default=o.exports},5064:function(e,t,a){},"520e":function(e,t,a){"use strict";a("5064")}}]);