(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1266fdc8"],{4103:function(e,t,i){},"86ea":function(e,t,i){"use strict";i.r(t);var s=i("1da1"),r=(i("e7e5"),i("d399")),n=i("ade3"),c=(i("96cf"),i("d81d"),i("b0c0"),i("a15b"),i("a434"),i("b64b"),i("365c")),a={name:"newperiodic-review-form",props:{},render:function(){var r=this,t=arguments[0];return t("div",{class:"newperiodic-review-form"},[t("global-van-cell-group",[t("global-van-field",{class:"global-van-field-xz",attrs:{readonly:!0,clickable:!0,name:"picker",value:this.select_site_office.text||"请选择项目",label:"选择项目:",placeholder:this.select_site_office.text||"请选择项目",required:!0},on:{tap:function(){return r.newperiodic_review__select_site()}}}),t("global-project-selection",{attrs:{title:"选择 项目类型",office:this.select_site_office},on:{cancel:function(){return r.newperiodic_review__cancel()},confirmid:function(e){return r.queck_confirm_id(e)},confirm:function(e){return r.queck_confirm(e)},"click-overlay":function(){return r.newperiodic_review_click_overlay()}},model:{value:r.select_site_value,callback:function(e){r.select_site_value=e}}}),t("global-van-field",{class:"global-van-field-miaoshu",attrs:{value:this.requirement_description||null,type:"textarea",label:"描述: ",placeholder:"请输入描述"},on:{input:function(e){r.requirement_description_input(e)}}}),t("div",{class:"newperiodic-review-form-image"},[this.upload_list.map(function(i,e){return t("div",{class:"newperiodic-review-form-container"},[t("div",{class:"newperiodic-review-form-sign-image"},[t("global-van-uploader",{attrs:{"file-list":r.file_list[i.key],multiple:!0,"max-count":3,"max-size":8388608},on:{delete:function(e,t){return r.uploader_uploader_delete(i.key,e.file_id)},oversize:function(){return r.uploader_oversize()}},scopedSlots:{default:function(e){return t("span")},previewCover:function(e){return t("div",{class:"newperiodic-review-form-sign-image-item-uploader",on:{click:function(){return r.uploading_image_preview(i.key)}}},[t("img",{attrs:{width:"80",height:"80",src:e.url}})])}}})]),t("global-van-field",{attrs:{center:!0,clearable:!0,disabled:!0,required:!0,label:i.text,placeholder:""},class:"newperiodic-review-form-button-field"},[t("template",{slot:"button"},[t("global-tap",{on:{tap:function(){return r.uploader_photograph_local_tap(i.key,"CAMERA",i.resources)}}},[t("global-van-button",{attrs:{icon:"photograph",type:"primary"}},["相机拍摄"])]),t("global-tap",{class:"newperiodic-review-form-loader",on:{tap:function(){return r.uploader_photograph_local_tap(i.key,"PHOTOLIBRARY",i.resources)}}},[t("global-van-button",{attrs:{icon:"photo-fail",type:"primary"}},["本地上传"])])])])])})])]),t("global-tap",{on:{tap:function(){return r.save_tap()}},class:"global-tap"},[t("global-van-button",{class:"global-van-button-save",attrs:{block:!0,type:"info","native-type":"submit",disabled:this.disabled}},["保存"])])])},data:function(){var e={file_ids:[],disabled:!0,select_site_value:!1,select_site_index:"",select_site:"",select_site_id:"",select_site_office:["请选择项目类型"],requirement_description:"",file_list:[],workNo:localStorage.getItem("workNo"),name:localStorage.getItem("name"),deptCode:localStorage.getItem("deptCode"),deptName:localStorage.getItem("deptName"),upload_list:[{text:"巡检文件",key:"review",resources:"05"}]};return Object(n.a)(e,"file_list",{review:[]}),Object(n.a)(e,"files",{review:[]}),e},computed:{},watch:{file_list:{handler:function(e,t){this.change_button_type()},deep:!0,immediate:!0}},methods:{change_button_type:function(){1<=this.file_list.review.length?this.disabled=!1:this.disabled=!0},newperiodic_review__select_site:function(){this.select_site_value=!0},newperiodic_review__cancel:function(){this.select_site_value=!1},newperiodic_review_click_overlay:function(){this.select_site_value=!1},queck_confirm:function(e){this.select_site_value=!1,this.select_site=e,this.select_site_office=e,this.select_site_index=this.select_site.value},queck_confirm_id:function(e){this.select_site_id=e,console.log(this.select_site_id),this.select_site_id=this.select_site_id[this.select_site_index]},save_tap:function(){this.review_save_massage(),this.$router.push("/periodic-review"),r.a.success("保存成功")},requirement_description_input:function(e){this.requirement_description=e},review_save_massage:function(){var t=this;return Object(s.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(c.j)({workNo:t.workNo,name:t.name,projectName:t.select_site_office.text,projectId:t.select_site_id.id,inspectDesc:t.requirement_description,fileIds:t.file_ids.join(",")});case 2:case"end":return e.stop()}},e)}))()},uploader_after:function(i,r,n,a){var o=this;return Object(s.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.$toast.loading({message:"上传中...",duration:0,forbidClick:!0}),o.files[r].push(n),e.next=4,Object(c.i)({workNo:o.workNo,name:o.name,relateId:"",statusCode:"04",fileResources:a,base64:n,fileName:"".concat((new Date).getTime(),".png")});case 4:t=e.sent,o.$toast.clear(),t.success?(o.file_list[r].push({url:i,base64:n,file_id:t.data}),o.emit_file_ids()):o.$notify({type:"danger",message:"上传失败"});case 7:case"end":return e.stop()}},e)}))()},uploader_uploader_delete:function(i,r){var n=this;this.file_list[i].map(function(e,t){return e.file_id==r&&n.file_list[i].splice(t,1)}),this.emit_file_ids()},uploader_delete:function(i,r){var n=this;this.file_list[i].map(function(e,t){return e.file_id==r&&n.file_list[i].splice(t,1)}),this.emit_file_ids()},emit_file_ids:function(){var t=this,i=[];Object.keys(this.file_list).map(function(e){return t.file_list[e].map(function(e){return i.push(e.file_id)})}),this.file_ids=i},uploader_photograph_local_tap:function(r,i,n){var a=this;return Object(s.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t={PHOTOLIBRARY:{destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!1,mediaType:Camera.MediaType.PICTURE},CAMERA:{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!1,encodingType:Camera.EncodingType.JPEG,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1}},a.m_native_camera_get_picture(t[i],function(){var t=Object(s.a)(regeneratorRuntime.mark(function e(t){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[function(){return a.$notify({type:"danger",message:"您未拍照或者未选择照片"})},function(){var t=Object(s.a)(regeneratorRuntime.mark(function e(t){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.$utils.getImgToBase64(t);case 2:i=e.sent,a.uploader_after(t,r,i,n);case 4:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()],e.t0=t.success,e.t0)return e.next=5,i[t.data.status](t.data.url);e.next=5;break;case 5:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return e.stop()}},e)}))()},uploading_image_preview:function(e){ImagePreview(this.file_list[e].map(function(e){return e.url}))}}},i=(i("dfe6"),i("2877")),a=Object(i.a)(a,void 0,void 0,!1,null,"3292b4fc",null);t.default=a.exports},dfe6:function(e,t,i){"use strict";i("4103")}}]);