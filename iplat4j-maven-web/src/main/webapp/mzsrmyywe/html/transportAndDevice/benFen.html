<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="renderer" content="webkit">
  <meta name="HandheldFriendly" content="true"/>
  <meta name="MobileOptimized" content="320"/>
  <meta name="format-detection" content="telephone=no">
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="stylesheet" href="../../reference/bootstrap-3.3.5/css/bootstrap.css"/>
  <link rel="stylesheet" href="../../reference/mui/css/mui.css"/>
  <link rel="stylesheet" href="../../reference/mui/css/mui.min.css"/>
  <link rel="stylesheet" href="../../css/common.css">
  <link rel="stylesheet" href="../../css/detail.css">
  <link rel="stylesheet" href="../../reference/assets/css/common.css" type="text/css" charset="utf-8"/>
</head>
<style>
	.warns{
		width: 100%;
		background: #000000;
		opacity: 0.3;
	}
	.warnss{
		width: 100%;
		font-size: 19px;
	}
	#topHeader{
		background: #0090BB;
	}
</style>
<body>
  <div id="offCanvasWrapper" class="mui-off-canvas-wrap">
  	<!--侧滑菜单部分-->
		<aside id="offCanvasSide" class="mui-off-canvas-left">
				<div id="offCanvasSideScroll" class="mui-scroll-wrapper">
					<div class="mui-scroll" style="height: 100%;">
						<div id="listUl" class="listUl">
								
						</div>
						<div id="title" class="title" style="color:#0090BB;padding: 5px 20px;padding-left:0;padding-top:20px;position:fixed;z-index:3000;top:-16px;background:#333333;width:100%;height:45px;text-align: center;font-size: 22px;">检查项目</div>
						<button id="offCanvasHide" type="button" class="mui-btn mui-btn-danger mui-btn-block content" style="padding: 5px 20px;position:fixed;z-index:3000;bottom:-10px;width:100%;height:45px;text-align: center;">关闭列表</button>
						<div id="warns" class="warns" hidden>
							<small></small>
						</div>
						<div id="warnss" class="warnss" hidden>
							<small></small>
						</div>
					</div>
				</div>
				<p id="pTexts" style="text-align: center;margin-top: 70%;border-top:none;" hidden>加载中，请稍后...</p>
			  <span class="mui-spinner mui-spinners" style="height: 50px;width: 50px;margin-left: 40%;color:#FFFFFF;" hidden></span>
		</aside>
  	<!--主界面部分-->
		<div id="contentMain" class="mui-inner-wrap">
			<header id="topHeader" class="mui-bar mui-bar-nav">
					  <h1 class="mui-title">任务列表</h1>
			      <button id="back" class="mui-btn mui-btn-blue mui-btn-link mui-btn-nav mui-pull-left">
			        <span class="mui-icon mui-icon-left-nav"></span>
			        	返回
			      </button>
			      <div id="peopeleQrcode" style="width: 140px;text-align:right;float:right;color: #FFFFFF;">
				    	<span class="mui-icon mui-icon-contact"><span id="name" style="margin-left: 4px;"></span></span>
				    </div>
			</header>
			<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
				<div id="mui-scroll">
					<!--菜单导航-->
						  <div id="slider" style="position: fixed;z-index:4000;top:44px;width:100%;border-bottom:1px solid #F1F1F1;">
						    <div id="sliderSegmentedControl">
						      <div class="row">
						      	<div id="peijian" name="0" class="col-xs-6 col-sm-6 col-md-6 col-lg-6 center">
						      		陪检
						      	</div>
						      	<div id="yunsongs" name="1" class="col-xs-6 col-sm-6 col-md-6 col-lg-6 center" style="border-bottom: 2px solid #007AFF;color:#007AFF;">
						      		运送
						      	</div>
						      </div>
						    </div>
						 </div>
						<div id="toAll" class="mui-table-view mui-table-view-chevron" style="background: #F0F0F0;">
							      
						</div>
						<div id='loadMore' name="0" class='alert' role='alert' style='background-color:#F5F5F5;height:5rem;line-height:2rem;text-align:center;margin-bottom: 60px;border-bottom: 2px solid #E6E6E6;'>
                	加载更多
            </div>
				</div>
				<p id="pText" style="text-align: center;padding-top: 43%;border-top:none;" hidden>加载中，请稍后...</p>
			  <span class="mui-spinner" style="height: 50px;width: 50px;margin-left: 42%;" hidden></span>
			  
				<div id="warn" class="warn" hidden>
					<small></small>
			  	</div>
			</div>
			<nav class="mui-bar mui-bar-tab" id="navYun" style="background-color:#fff;border-top:1px solid #B6B6B6;">
			      <a class="mui-tab-item mui-tab-items" id="0" href="#">
			        <span class="mui-icon mui-icon-arrowthinleft" style="height:25px;width:25px;margin-top: -7px;"></span>
			        <span class="mui-tab-label" style="font-size: 17px;">回退</span>
			      </a>
			      <a class="mui-tab-item mui-tab-items" id="1" href="#">
			        <span class="mui-icon mui-icon-checkmarkempty" style="height:25px;width:25px;margin-top: -7px;"></span>
			        <span class="mui-tab-label" style="font-size: 17px;">受理</span>
			      </a>
			      <a class="mui-tab-item mui-tab-items" id="2" href="#">
			        <span class="mui-icon mui-icon-refreshempty" style="height:25px;width:25px;margin-top: -7px;"></span>
			        <span class="mui-tab-label" style="font-size: 17px;">完工</span>
			      </a>
			      <a class="mui-tab-item mui-tab-items" id="3" href="#">
			        <span class="mui-icon mui-icon-refresh" style="height:25px;width:25px;margin-top: -7px;"></span>
			        <span class="mui-tab-label" style="font-size: 17px;">刷新</span>
			      </a>
			</nav>
			<div class="mui-off-canvas-backdrop"></div>
		</div>
		
		<div id="myModal" class="child-window" hidden></div>
		
		<div id="qrcodeParent" style="width:250px;height:400px;" hidden>
			<div style="text-align: center;color:black;margin-bottom: 20px;">
				<img src="../../img/img.jpg" style="border-radius: 25px;height:50px;width:50px;vertical-align: middle;">
				<span id="qrcodeName" style="font-size:20px;margin-top: 25px;color:#FFFFFF;"></span>
			</div>
			<div id="qrcode"></div>
			<p style="text-align: center;margin-top: 13px;color:#FFFFFF;">扫描上方二维码，进行人员转派</p>
		</div>
  </div>
</body>
<script src="../../reference/bootstrap-3.3.5/js/jquery-2.1.4.js" type="text/javascript"></script>
<script src="../../reference/mui/js/mui.js" type="text/javascript"></script>
<script src="../../js/jquery.qrcode.min.js"type="text/javascript"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript" src="../../cordova.js"></script>
<script type="text/javascript">
var baseUrl = localStorage.getItem('url');
var workNo = localStorage.getItem('workNo');
var worKname = localStorage.getItem('name');
var page = 1;
var rows = 4;
var taskType = 'YS';
var ids,patient_name,timer= null;	

$('#pText').show();
$('.mui-spinner').show();
ajaxData();
function ajaxData(){
	$.ajax({
	url:baseUrl + 'app_carriageAppController.do?queryCurrentTaskList',
	type:'post',
	data:{
		currentUser:workNo,
		taskType:taskType,
		page:page,
		rows:rows
	},
	success:function(data){
		var list = data.obj;
		var html = '';
		var array = new Array();
		if(list.length < rows){
			$('#loadMore').text('暂无更多数据');
		}else{
			$('#loadMore').text('加载更多');
		}
		
		for(var i=0; i<list.length; i++){
			var status_code = list[i].status_code;
			var billNo = list[i].billNo;
			var createCateView = list[i].createCateView;
			var from_address = list[i].from_address;
			var from_dept_name = list[i].from_dept_name;
			var id = list[i].id;
			var status_code = list[i].status_code;
			var status_name = list[i].status_name;
			var execute_user_name = list[i].execute_user_name;
			var has_doctor = list[i].has_doctor;
			var transport_means_class_name = list[i].transport_means_class_name;
			var urgent = list[i].urgent;
			var viewDeptName = list[i].viewDeptName;
			var patient_name = list[i].patient_name;
			var patient_bed = list[i].patient_bed;
			var index = i+1;
			html += sendTaskList(index,viewDeptName,createCateView,status_code,billNo,from_address,from_dept_name,id,status_code,status_name,patient_name,execute_user_name,transport_means_class_name)
		}
		$('#name').text(localStorage.getItem('name'));
		$('#toAll').html(html);
		$('#pText').hide();
  	$('.mui-spinner').hide();
	},
	complete: function(XMLHttpRequest, status) {　
        if (status == 'timeout') {
        	$('#pText').hide();
        	$('.mui-spinner').hide();
          $("#loading").hide();
          $('#warn small').html('连接超时，请检查您的网络是否通畅！');
          $('#warn').show();
          setTimeout("$('#warn').hide()", 3000);　　　
        } else if (status == 'warn') {
        	$('#pText').hide();
        	$('.mui-spinner').hide();
          $("#loading").hide();
         	$('#warn small').html('连接失败，服务运行异常！');
          $('#warn').show();
          setTimeout("$('#warn').hide()", 3000);　
        }　
    }
})
}

//运送
function sendTaskList(index,viewDeptName,createCateView,status_code,billNo,from_address,from_dept_name,id,status_code,status_name,patient_name,execute_user_name,transport_means_class_name){
	var html = "";
	html += "<div id='div-child' class='panel panel-danger' style='margin-bottom:10px;border:1px solid #DEDEDE;'>";
	html += "<div style='margin-bottom:10px;border:none;'>";
	html += "<div id='panel-heading' class='row' style='background:#FFF;border:none;font-size:21px;padding-top:15px;border-bottom:none;'>";
	html += "<div id='rowss1' taskIds='"+id+"' class='col-xs-6 col-sm-6 col-md-6 col-lg-6' style='padding-top:4px;'>";
	html += "<span class='detail' style='color:#007AFF;'>"+createCateView+"</span></div>";
	html += "<div class='col-xs-6 col-sm-6 col-md-6 col-lg-6 right'>";
	if(status_code == '04'){
	html += "<span style='display:inline-block;padding-top:4px;padding-right:8px;color:#0090BB;'>"+status_name+"</span>";	
	}else{
	html += "<span style='display:inline-block;padding-top:4px;padding-right:8px;color:#F5A224;'>"+status_name+"</span>";	
	}
	html += "<div id='checkedDivs' name='0' status_code='"+status_code+"' class='"+id+"' billNo='"+billNo+"' style='width:125px;height:75px;background:transparent;position:absolute;z-index:3000;top:0;right:0;'></div>";
	html += "<div id='checkedDivsg' style='display:inline-block;border:1px solid #DEDEDE;border-radius:3px;width:25px;height:25px;float:right;'></div>";
	html += "</div></div>";
	html += "<div class='panel-bodys' taskIds='"+id+"' style='border-bottom:none;border-top:none;'>";
	html += "<div class='row' style='margin-top:-4px;padding-top:16px;font-size:21px;padding-bottom:2px;'>";
	html += "<div class='col-xs-12 col-sm-12 col-md-12 col-lg-12' style='font-size:20px;'>"+from_dept_name+"</div>";
	html += "</div>";
	html += "</div></div></div>";
	return html;
}

//加载更多
var loadMores = document.getElementById("loadMore");
loadMores.addEventListener('tap',function(){
	if($('#loadMore').text().trim() == '加载更多'){
		rows += 4;
		ajaxData();
		$('#loadMore').text('正在加载中...');
	}
},false);

//运送
mui('#toAll').on('tap','div.panel-bodys',function(){
	$('#listUl').html('');
	clearTimeout(timer);
	var valuessT = $(this).parent().parent().find('div#checkedDivs').attr('name');
	ids = this.getAttribute('taskIds');
	patient_name = $(this).attr('patient_name');
	$(this).parent().parent().css('background','darkgray').siblings('div#div-child').css('background','');
	$(this).parent().parent().find('div#panel-heading').css('background','darkgray');
	$(this).parent().parent().siblings('div#div-child').find('div#panel-heading').css('background','');
	//打开菜单
	$('#pTexts').show();
	$('.mui-spinners').show();
	offCanvasWrapper.offCanvas('show');
	timer= setTimeout('listPJ()',500);
})

mui('#toAll').on('tap','div#rowss1',function(){
	$('#listUl').html('');
	clearTimeout(timer);
	var valuessT = $(this).siblings('div').find('div#checkedDivs').attr('name');
	ids = this.getAttribute('taskIds');
	patient_name = $(this).attr('patient_name');
	$(this).parent().parent().parent().css('background','darkgray').siblings('div#div-child').css('background','');;
	$(this).parent().parent().parent().find('div#panel-heading').css('background','darkgray');
	$(this).parent().parent().parent().siblings('div').find('div#panel-heading').css('background','');
	//打开菜单
	$('#pTexts').show();
	$('.mui-spinners').show();
	offCanvasWrapper.offCanvas('show');
	timer= setTimeout('listPJ()',500);
})

function listPJ(){
	$('#pTexts').show();
	$('.mui-spinners').show();
	$.ajax({
		url:baseUrl+'app_carriageAppController.do?queryCurrentTaskItemList',
		type:'post',
		data:{
			BillId:ids,
			taskType:taskType
		},
		success:function(data){
			var list = data.obj;
			var html = "";
			if(data.respCode == '200' || data.respCode == 200){
				for(var i= 0;i<list.length;i++){
					if(i < 9){
						var b = i + 1;
						var a = '0' + b;
					}else{
						var a = i + 1;	
				    }
					
					if(list[i].dected_class_name.length > 10){
						var dected_class_name = list[i].dected_class_name.substring(0,9)+'...';
					}else{
						var dected_class_name = list[i].dected_class_name;	
					}
					
					var dected_class = list[i].dected_class;
					var dected_times = list[i].dected_timeView;
					var id = list[i].id;
					var item_status = list[i].item_status;
					var status_name = list[i].status_name;
					
					html += "<span class='lis'>";
					html += "<li class='lisBlew' name='0' style='font-size:18px;text-align:left;padding-left:55px;padding-top:19px;padding-bottom:45px;position:relative;'>"+a+" . "+dected_class_name+"<span class='mui-icon mui-icon-arrowdown' style='float:right;margin-right:30px;margin-top:-3px;'></span>";
					if(item_status == '02'){
					html += "<a style='display:inline-block;width:38px;height:38px;line-height:38px;background:#0090BB;border-radius:30px;position:absolute;z-index:3000;top:10px;left:65px;text-align:center;color:#FFFFFF;font-size:15px;'>完成</a>";	
					}
					html +="</li>";
					html += "<span id='blewDiv' hidden>";
					if(taskType == 'PJ'){
					html += "<li style='text-align:left;padding-left:55px;height:40px;border-bottom:none;'>";
					html += "<p style='font-size:18px;'>"+status_name+"检查时间:<span style='float:right;margin-right:30px;font-size:16x;'>"+dected_times+"</span></p>";
					html += "</li>";	
					}
					html += "<li style='text-align:left;padding-left:35px;height:60px;border-top:none;'>";
					html += "<p class='pButton' style='margin-top:-3px;font-size:18px;'>";
					if(item_status != '02'){
					html += '<button id="0" name="'+id+'" style="height:43px;color:#0090BB;border:1px solid #0090BB;width:37%;font-size:17px;float:right;margin-right:30px;margin-top:-18px;" type="button" class="mui-btn mui-btn-success mui-btn-outlined" hidden>确定</button>';	
					}else{
					html += '<button id="1" name="'+id+'" style="height:43px;color:#0090BB;border:1px solid #0090BB;float:right;margin-right:30px;width:37%;margin-top:-18px;font-size:17px;" type="button" class="mui-btn mui-btn-success mui-btn-outlined">取消</button>';	
					}
					html += "</p>";
					html += "</li>";
					html += "</span></span>";
				}
				$('#pTexts').hide();
				$('.mui-spinners').hide();
				if(taskType != 'YS'){
				$('#title').text(patient_name+'-检查项目');	
				}
				$('.listUl').html(html);
			}
		},
		complete: function(XMLHttpRequest, status) {　
          if (status == 'timeout') {
            $("#loading").hide();
            $('#pTexts').hide();
						$('.mui-spinners').hide();
            $('#warn small').html('连接超时，请检查您的网络是否通畅！');
            $('#warn').fadeIn(500);
            setTimeout("$('#warn').fadeOut(500)", 3000);　　　
          } else if (status == 'warn') {
            $("#loading").hide();
            $('#pTexts').hide();
						$('.mui-spinners').hide();
            $('#warn small').html('连接失败，服务运行异常！');
            $('#warn').fadeIn(500);
            setTimeout("$('#warn').fadeOut(500)", 3000);　
          }　
        }
	})
}

//按钮点击事件////运送
mui("#navYun").on('tap','a.mui-tab-items',function(){
	var classS = this.getAttribute('id');
    if(classS == '0'){
    	var opCode = 'reback', arrayAccept = '', kk = '0';
    	$('#toAll div#div-child').each(function(index,element){
	    	var status_code = $(this).find('div#checkedDivs').attr('status_code');
	   	 	var codeNameSure = $(this).find('div#checkedDivs').attr('name');
	   	 	var id= $(this).find('div#checkedDivs').attr('class')+',';
	   	 	if(codeNameSure == '1'){
	   	 		arrayAccept += id;
	   	 		kk = '1';
	   	 	}
	    })
    	if(kk == '0'){
        $('#warn small').html('请选择需要回退的单据!');
        $("#warn").fadeIn(500);
       	setTimeout("$('#warn').fadeOut(500)", 3000);
        return;　
    	}
    	Accepted(opCode,arrayAccept);
    }else if(classS == '1'){
    	var opCode = 'accept', arrayAccept = '', kk = '0';
    	$('#toAll div#div-child').each(function(index,element){
	    	var status_code = $(this).find('div#checkedDivs').attr('status_code');
	   	 	var codeNameSure = $(this).find('div#checkedDivs').attr('name');
	   	 	var id= $(this).find('div#checkedDivs').attr('class') + ',';
	   	 	if(codeNameSure == '1'){
	   	 		arrayAccept += id;
	   	 		kk = '1';
	   	 	}
	    })
    	if(kk == '0'){
            $('#warn small').html('请选择需要受理的单据！');
            $("#warn").fadeIn(500);
           	setTimeout("$('#warn').fadeOut(500)", 3000);
           	return;　
    	}
    	Accepted(opCode,arrayAccept);
    }else if(classS == '2'){
    	var arrayAccept = '', kk = '0';
    	$('#toAll div#div-child').each(function(index,element){
	    	var status_code = $(this).find('div#checkedDivs').attr('status_code');
	   	 	var codeNameSure = $(this).find('div#checkedDivs').attr('name');
	   	 	var id= $(this).find('div#checkedDivs').attr('class') + ',';
	   	 	if(codeNameSure == '1'){
	   	 		arrayAccept += id;
	   	 		kk = '1';
	   	 	}
	    })
    	if(kk == '0'){
            $('#warn small').html('请选择需要返回科室的单据 ！');
            $("#warn").fadeIn(500);
           	setTimeout("$('#warn').fadeOut(500)", 3000);
           	return;　
    	}
    	backDepartment(arrayAccept);
    }else{
    	location.reload();
    }
})

function Accepted(opCode,arrayAccept){
	$.ajax({
		url: baseUrl + 'app_carriageAppController.do?billToAcceptOrReback',
		type: 'post',
		data: {
			opCode:opCode,
			taskID:arrayAccept,
			currentUser:workNo,
			currentUserName:worKname
		},
		success:function(data){
			console.log(data);
			if(data.respCode == 200 || data.respCode == '200'){
				$('#warn small').html('处理中, 请稍后...');
        $('#warn').fadeIn(500);
        setTimeout("$('#warn').fadeOut(500)", 3000);
				ajaxData();	
			}else{
				$('#warn small').html(data.respMsg);
        $("#warn").fadeIn(500);
        setTimeout("$('#warn').fadeOut(500)", 3000);
        return;
			}
		},
		complete: function(XMLHttpRequest, status) {　
          if (status == 'timeout') {
            $("#loading").hide();
            $('#warn small').html('连接超时，请检查您的网络是否通畅！');
            $('#warn').show();
            setTimeout("$('#warn').hide()", 3000);　　　
          } else if (status == 'warn') {
            $("#loading").hide();
            $('#warn small').html('连接失败，服务运行异常！');
            $('#warn').show();
            setTimeout("$('#warn').hide()", 3000);　
          }　
        }
	})
}

function backDepartment(arrayAccept){
	$.ajax({
		url: baseUrl + 'app_carriageAppController.do?backToDepartment',
		type: 'post',
		data: {
			taskID:arrayAccept,
			currentUser:workNo,
			currentUserName:worKname
		},
		success:function(data){
			if(data.respCode == 200 || data.respCode == '200'){
				console.log(data);
				$('#warn small').html('处理中, 请稍后...');
        $('#warn').fadeIn(500);
        setTimeout("$('#warn').fadeOut(500)", 3000);
				ajaxData();	
			}else{
				$('#warn small').html(data.respMsg);
        $("#warn").fadeIn(500);
        setTimeout("$('#warn').fadeOut(500)", 3000);
        return;
			}
		},
		complete: function(XMLHttpRequest, status) {　
          if (status == 'timeout') {
            $("#loading").hide();
            $('#warn small').html('连接超时，请检查您的网络是否通畅！');
            $('#warn').show();
            setTimeout("$('#warn').hide()", 3000);　　　
          } else if (status == 'warn') {
            $("#loading").hide();
            $('#warn small').html('连接失败，服务运行异常！');
            $('#warn').show();
            setTimeout("$('#warn').hide()", 3000);　
          }　
        }
	})
}

//确定,取消
mui('.listUl').on('tap','p.pButton button',function(){
	var idss = $(this).attr('name');
	if($(this).attr('id') == '0'){
	var opCode = 'finish';
	}else{
	var opCode = 'cancel';	
	}
	funSureCancel(idss,opCode);
})

function funSureCancel(idss,opCode){
	$.ajax({
		url:baseUrl + 'app_carriageAppController.do?saveForBillToFinishOrCancel',
		type:'post',
		data:{
			taskID: ids,
			taskItemID: idss,
			opCode: opCode,
			currentUser: workNo,
			currentUserName: worKname,
			completeType: 'APP'
		},
		success:function(data){
			console.log(data);
			if(data.respCode == '200' || data.respCode == 200){
				$('#warnss small').html(data.respMsg);
            	$('#warnss').fadeIn(500);
            	setTimeout("$('#warnss').fadeOut(500)",2500)
           		ajaxData();
           		listPJ();
			}else{
				$('#warnss small').html(data.respMsg);
            	$('#warnss').fadeIn(500);
           	 	setTimeout("$('#warnss').fadeOut(500)", 3000);
           	 	return;　
			}
		},
		complete: function(XMLHttpRequest, status) {　
          if (status == 'timeout') {
            $("#loading").hide();
            $('#warn small').html('连接超时，请检查您的网络是否通畅！');
            $('#warn').fadeIn(500);
            setTimeout("$('#warn').fadeOut(500)", 3000);　　　
          } else if (status == 'warn') {
            $("#loading").hide();
            $('#warn small').html('连接失败，服务运行异常！');
            $('#warn').fadeIn(500);
            setTimeout("$('#warn').fadeOut(500)", 3000);　
          }　
        }
	})
}

//选中需扫码的单据
mui('#followCheck').on('tap','div#checkedDiv',function(){
	var nameValue = $(this).attr('name');
	if(nameValue == '0'){
		$(this).parent().find('div#checkedDivBlew').html('<span class="glyphicon glyphicon-ok" style="color:#007AFF;"></span>');
		$(this).attr('name','1');
		$(this).parent().parent().parent().parent().find('div.panel-bodys');
	}else{
		$(this).parent().find('div#checkedDivBlew').html('');
		$(this).attr('name','0');
		$(this).parent().parent().parent().parent().find('div.panel-bodys');
	}
})

//运送
mui('#toAll').on('tap','div#checkedDivs',function(){
	var nameUe = $(this).attr('name');
	if(nameUe == '0'){
		$(this).parent().find('div#checkedDivsg').html('<span class="glyphicon glyphicon-ok" style="color:#007AFF;"></span>');
		$(this).attr('name','1');/*.parent().parent().parent().parent().siblings('div').find('div#checkedDivs').attr('name','0');*/
		$(this).parent().parent().parent().parent().find('div.panel-bodys');
	}else{
		$(this).parent().find('div#checkedDivsg').html('');
		$(this).attr('name','0');
		$(this).parent().parent().parent().parent().find('div.panel-bodys');
	}
})

mui('#toAll').on('tap','div#rowss1',function(){
	$('#listUl').html('');
	clearTimeout(timer);
	var valuessT = $(this).siblings('div').find('div#checkedDivs').attr('name');
	ids = this.getAttribute('taskIds');
	patient_name = $(this).attr('patient_name');
	$(this).parent().parent().parent().css('background','darkgray').siblings('div#div-child').css('background','');;
	$(this).parent().parent().parent().find('div#panel-heading').css('background','darkgray');
	$(this).parent().parent().parent().siblings('div').find('div#panel-heading').css('background','');
	//打开菜单
	$('#pTexts').show();
	$('.mui-spinners').show();
	offCanvasWrapper.offCanvas('show');
	timer= setTimeout('listPJ()',500);
})

mui('.listUl').on('tap','li.lisBlew',function(){
	var name = $(this).attr('name');
	$(this).parent().find('span#blewDiv').toggle();
	if(name == '0'){
		$(this).find('span').attr('class','mui-icon mui-icon-arrowup');
			$(this).attr('name','1');
		}else{
			$(this).find('span').attr('class','mui-icon mui-icon-arrowdown');
			$(this).attr('name','0');
		}
})

//关闭菜单
var offCanvasWrapper = mui('#offCanvasWrapper');
document.getElementById('offCanvasHide').addEventListener('tap', function() {
	offCanvasWrapper.offCanvas('close');
});

var peopeleQrcodeDiv = document.getElementById("peopeleQrcode");
var contentMainss = document.getElementById("contentMain");
var qrcodeParents = document.getElementById("qrcodeParent");
var myModals = document.getElementById("myModal");

peopeleQrcodeDiv.addEventListener('tap',function(){
	qrcodeParents.style.display = 'block';
	myModals.style.display = 'block';
	$('#contentMain').addClass('blur');
	$('#qrcodeName').text(name);
},false);

qrcodeParents.addEventListener('tap',function(){
	$('#contentMain').removeClass('blur');
	this.style.display = 'none';
	myModals.style.display = 'none';
},true);

//禁用ios平台原生侧滑关闭页面
if (mui.os.plus && mui.os.ios) {
	mui.plusReady(function() { 
		plus.webview.currentWebview().setStyle({
			'popGesture': 'none'
		});
	});
}

var elem = document.querySelector('body');
elem.addEventListener("dragend",function(){
   /* alert('加载中...');*/
});

//生成二维码
$(function(){
  //更详细的配置
  $('#qrcode').qrcode({
    text: encodeURIComponent(workNo + ',' + $('#name').text()),
    width: 250,
    height: 250,
    background: "#FFFFFF", 
    foreground: "black"
  });
})

//显示运送、陪检
mui('#sliderSegmentedControl').on('tap','div.center',function(){
	var idText = this.getAttribute('name');
	if(idText == '0'){
		location.href="sendList.html";
	}else if(idText=='1'){
		location.href="yunsong.html";
	}
})

$("#sliderSegmentedControl").on('click','div.center',function(){
	$(this).css('color','red');
})

$('#back').click(function(){
	location.href = "../../menu.html";
})
</script>
</html>
