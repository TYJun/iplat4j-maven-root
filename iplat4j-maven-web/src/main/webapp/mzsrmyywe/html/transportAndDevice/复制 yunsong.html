<!doctype html>
<html class="no-js">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
		<meta name="renderer" content="webkit">
		<meta name="HandheldFriendly" content="true" />
		<meta name="MobileOptimized" content="320" />
		<meta name="format-detection" content="telephone=no">
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<link rel="stylesheet" href="../../reference/bootstrap-3.3.5/css/bootstrap.css" />
		<link rel="stylesheet" href="../../reference/mui/css/mui.css" />
		<link rel="stylesheet" href="../../reference/mui/css/mui.min.css" />
		<link rel="stylesheet" href="../../css/common.css">
		<link rel="stylesheet" href="../../css/detail.css">
		<link rel="stylesheet" href="../../reference/assets/css/common.css" type="text/css" charset="utf-8" />
	</head>
	<style>
		.warns {
			width: 100%;
			background: #000000;
			opacity: 0.3;
		}
		
		.warnss {
			width: 100%;
			font-size: 19px;
		}
		
		#topHeader {
			background: #0090BB;
		}
		
		.aboveDiv,
		.aboveAccept {
			position: absolute;
			z-index: 4999;
			left: 10%;
			top: 24%;
			width: 80%;
			background: #FFFFFF;
			border-radius: 12px;
		}
		
		.aboveDivss,
		.aboveDivWarn {
			position: absolute;
			z-index: 4999;
			left: 10%;
			top: 27%;
			height: 210px;
			width: 80%;
			background: #FFFFFF;
			border-radius: 12px;
		}
		
		.aboveDivWarn li {
			width: 100%;
			height: 95px;
			line-height: 95px;
			text-align: center;
			margin-left: -8%;
			border-bottom: 1px solid #E0E0E0;
			font-size: 23px;
		}
		
		.aboveDivss li {
			width: 100%;
			height: 70px;
			line-height: 70px;
			text-align: center;
			margin-left: -8%;
			border-bottom: 1px solid #E0E0E0;
			font-size: 23px;
		}
		
		.aboveDiv li,
		.aboveAccept li {
			width: 100%;
			height: 80px;
			line-height: 80px;
			text-align: center;
			margin-left: -8%;
			/*border-bottom: 1px solid #E0E0E0;*/
			font-size: 23px;
		}
		
		#spanLi span {
			display: inline-block;
			width: 50%;
		}
	</style>

	<body>
		<div id="offCanvasWrapper" class="mui-off-canvas-wrap">
			<!--侧滑菜单部分-->
			<aside id="offCanvasSide" class="mui-off-canvas-left">
				<div id="offCanvasSideScroll" class="mui-scroll-wrapper">
					<div class="mui-scroll" style="height: 100%;">
						<div id="listUl" class="listUl">

						</div>
						<div id="title" class="title" style="color:#0090BB;padding: 5px 20px;padding-top:20px;position:fixed;z-index:3000;top:-16px;background:#333333;width:100%;height:45px;text-align: center;font-size: 22px;">检查项目<span id="numText" style="float: right;color: #FFFFFF;font-size:18px;"></span></div>
						<button id="offCanvasHide" type="button" class="mui-btn mui-btn-danger mui-btn-block content" style="padding: 5px 20px;position:fixed;z-index:3000;bottom:-10px;width:100%;height:45px;text-align: center;">关闭列表</button>
						<div id="warns" class="warns" hidden>
							<small></small>
						</div>
						<div id="warnss" class="warnss" hidden>
							<small></small>
						</div>
					</div>
				</div>
				<p id="pTexts" style="text-align: center;margin-top: 70%;border-top:none;" hidden>加载中，请稍后...</p>
				<span class="mui-spinner mui-spinners" style="height: 50px;width: 50px;margin-left: 40%;color:#FFFFFF;" hidden></span>
			</aside>
			<!--主界面部分-->
			<div id="contentMain" class="mui-inner-wrap">
				<header id="topHeader" class="mui-bar mui-bar-nav">
					<h1 class="mui-title">任务列表</h1>
					<button id="back" class="mui-btn mui-btn-blue mui-btn-link mui-btn-nav mui-pull-left">
			        <span class="mui-icon mui-icon-left-nav"></span>
			        	返回
			      </button>
					<div id="peopeleQrcode" style="width: 140px;text-align:right;float:right;color: #FFFFFF;">
						<span class="mui-icon mui-icon-contact"><span id="name" style="margin-left: 4px;"></span></span>
					</div>
				</header>
				<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper">
					<div id="mui-scroll">
						<!--菜单导航-->
						<div id="slider" style="position: fixed;z-index:4000;top:44px;width:100%;border-bottom:1px solid #F1F1F1;">
							<div id="sliderSegmentedControl">
								<div class="row">
									<div id="peijian" name="0" class="col-xs-6 col-sm-6 col-md-6 col-lg-6 center">
										陪检
									</div>
									<div id="yunsongs" name="1" class="col-xs-6 col-sm-6 col-md-6 col-lg-6 center" style="border-bottom: 2px solid #007AFF;color:#007AFF;">
										运送
									</div>
								</div>
							</div>
						</div>
						<div id="toAll" class="mui-table-view mui-table-view-chevron" style="background: #F0F0F0;">

						</div>
						<div id='loadMore' name="0" class='alert' role='alert' style='background-color:#F5F5F5;height:5rem;line-height:2rem;text-align:center;margin-bottom: 60px;border-bottom: 2px solid #E6E6E6;'>
							加载更多
						</div>
					</div>
					<p id="pText" style="text-align: center;padding-top: 43%;border-top:none;" hidden>加载中，请稍后...</p>
					<span class="mui-spinner" style="height: 50px;width: 50px;margin-left: 42%;" hidden></span>

					<div id="warn" class="warn" hidden>
						<small></small>
					</div>
				</div>
				<nav class="mui-bar mui-bar-tab" id="navYun" style="background-color:#fff;border-top:1px solid #B6B6B6;">
					<a class="mui-tab-item mui-tab-items" id="0" href="#">
						<span class="mui-icon mui-icon-arrowthinleft" style="height:25px;width:25px;margin-top: -7px;"></span>
						<span class="mui-tab-label" style="font-size: 17px;">回退</span>
					</a>
					<a class="mui-tab-item mui-tab-items" id="1" href="#">
						<span class="mui-icon mui-icon-checkmarkempty" style="height:25px;width:25px;margin-top: -7px;"></span>
						<span class="mui-tab-label" style="font-size: 17px;">受理</span>
					</a>
					<a class="mui-tab-item mui-tab-items" id="2" href="#">
						<span class="mui-icon mui-icon-refreshempty" style="height:25px;width:25px;margin-top: -7px;"></span>
						<span class="mui-tab-label" style="font-size: 17px;">完工</span>
					</a>
					<a class="mui-tab-item mui-tab-items" id="3" href="#">
						<span class="mui-icon mui-icon-refresh" style="height:25px;width:25px;margin-top: -7px;"></span>
						<span class="mui-tab-label" style="font-size: 17px;">刷新</span>
					</a>
				</nav>
				<div class="mui-off-canvas-backdrop"></div>
			</div>

			<div id="myModal" class="child-window" hidden></div>

			<div id="myModalss" class="child-window" style="background: #000000;opacity: 0.5;" hidden></div>

			<div id="qrcodeParent" style="width:250px;height:400px;" hidden>
				<div style="text-align: center;color:black;margin-bottom: 20px;">
					<img src="../../img/img.jpg" style="border-radius: 25px;height:50px;width:50px;vertical-align: middle;">
					<span id="qrcodeName" style="font-size:20px;margin-top: 25px;color:#000000;"></span>
				</div>
				<div id="qrcode"></div>
				<p style="text-align: center;margin-top: 13px;color:#000000;">扫描上方二维码，进行人员转派</p>
			</div>

			<div class="aboveDiv" style="display: none;">
				<ul id="aboveDiv">
					<!--<li id="departmentBack" class="items" name="0">自回科室</li>
				<li id="sendTo" class="items" name="1" style="border-bottom: none;">送达</li>-->
				</ul>
			</div>

			<div class="aboveAccept" style="display: none;">
				<ul id="aboveAccept">
					<!--<li id="departmentBack" class="items" name="0">自回科室</li>
				<li id="sendTo" class="items" name="1" style="border-bottom: none;">送达</li>-->
				</ul>
			</div>

			<div class="aboveDivWarn" style="display: none;">
				<ul>
					<li class="items" style="height: 50px;line-height: 50px;font-weight: bold;">提示</li>
					<li class="items" style="padding-left: 12px;">确认自回科室吗？</li>
					<li class="items" id="spanLi" style="height: 65px;line-height: 65px;border-bottom: none;">
						<span id="0">是</span><span id="1">否</span>
					</li>
				</ul>
			</div>
		</div>

		<div id="signature" style="margin-top:-25px;margin-bottom:60px;display: none;">
		</div>

		<div class="modal fade" id="myModalsssssss" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content" style="top: 116px;">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
		           &times;
		      </button>
						<h4 class="modal-title" id="myModalLabel">
		        	签字人下方签名
		      </h4>
					</div>
					<div class="modal-body js-signature" id="js-signature" style='height:18rem;' data-width="320" data-height="175">

					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" onclick="clearCanvas()">
		                    清除
		        </button>
						<button type="button" class="btn btn-info" data-dismiss="modal" onclick="saveSignature()">
		                   确认
		        </button>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script src="../../reference/bootstrap-3.3.5/js/jquery-2.1.4.js" type="text/javascript"></script>
	<script src="../../reference/bootstrap-3.3.5/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="../../reference/mui/js/mui.js" type="text/javascript"></script>
	<script src="../../js/jquery.qrcode.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript" src="../../cordova.js"></script>
	<script src="../../js/jq-signature.js"></script>
	<script type="text/javascript">
		var baseUrl = localStorage.getItem('url');
		var workNo = localStorage.getItem('workNo');
		var workNoss = localStorage.getItem('workNo');
		var worKname = localStorage.getItem('name');
		var worKnamess = localStorage.getItem('name');
		var deptCode = localStorage.getItem('deptCode');
		var deptCodess;
		var deptName = localStorage.getItem('deptName');
		var page = 1;
		var rows = 4;
		var taskType = 'YS',
			deptAcceptCode = '',
			back_signature_accept = '';
		var back_type, back_signature, back_time = '',
			service_score = '',
			ids, patient_name, timer = null;
		//完成时是否需要扫码确认
		var scanFinish = false;
		$.ajax({
			url: baseUrl + 'app_carriageAppController.do?queryClickYSType',
			type: 'post',
			success: function(data) {
				console.log(data);
				if(data.respCode == "200") {
					if(data.obj[0].paramValue1 == "Y")
						scanFinish = true;
				} else {

				}
			}
		});
		$('#pText').show();
		$('.mui-spinner').show();
		ajaxData();

		function ajaxData() {
			$.ajax({
				url: baseUrl + 'app_carriageAppController.do?queryCurrentTaskList',
				type: 'post',
				data: {
					currentUser: workNo,
					taskType: taskType,
					page: page,
					rows: rows
				},
				success: function(data) {
					var list = data.obj;
					var html = '';
					var array = new Array();
					console.log(list);
					if(list.length < rows) {
						$('#loadMore').text('暂无更多数据');
					} else {
						$('#loadMore').text('加载更多');
					}

					for(var i = 0; i < list.length; i++) {
						var status_code = list[i].status_code;
						var billNo = list[i].billNo;
						var createCateView = list[i].createCateView;
						var from_address = list[i].from_address;
						var from_dept_name = list[i].from_dept_name;
						var id = list[i].id;
						var status_code = list[i].status_code;
						var status_name = list[i].status_name;
						var execute_user_name = list[i].execute_user_name;
						var has_doctor = list[i].has_doctor;
						var transport_means_class_name = list[i].transport_means_class_name;
						var urgent = list[i].urgent;
						var viewDeptName = list[i].viewDeptName;
						var patient_name = list[i].patient_name;
						var patient_bed = list[i].patient_bed;
						var billDesc = list[i].billDesc; //备注
						var urgent = list[i].urgent; //是否加急

						var index = i + 1;
						html += sendTaskList(urgent, billDesc, index, viewDeptName, createCateView, status_code, billNo, from_address, from_dept_name, id, status_code, status_name, patient_name, execute_user_name, transport_means_class_name)
					}
					$('#name').text(localStorage.getItem('name'));
					$('#toAll').html(html);
					$('#pText').hide();
					$('.mui-spinner').hide();
				},
				complete: function(XMLHttpRequest, status) {　
					if(status == 'timeout') {
						$('#pText').hide();
						$('.mui-spinner').hide();
						$("#loading").hide();
						$('#warn small').html('连接超时，请检查您的网络是否通畅！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　　　
					} else if(status == 'warn') {
						$('#pText').hide();
						$('.mui-spinner').hide();
						$("#loading").hide();
						$('#warn small').html('连接失败，服务运行异常！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　
					}　
				}
			})
		}

		//运送
		function sendTaskList(urgent, billDesc, index, viewDeptName, createCateView, status_code, billNo, from_address, from_dept_name, id, status_code, status_name, patient_name, execute_user_name, transport_means_class_name) {
			var html = "";
			html += "<div id='div-child' class='panel panel-danger' style='margin-bottom:10px;border:1px solid #DEDEDE;'>";
			html += "<div style='margin-bottom:10px;border:none;'>";
			html += "<div id='panel-heading' class='row' style='background:#FFF;border:none;font-size:21px;padding-top:15px;border-bottom:none;'>";
			html += "<div id='rowss1' taskIds='" + id + "' class='col-xs-6 col-sm-6 col-md-6 col-lg-6' style='padding-top:4px;'>";
			html += "<span class='detail' style='color:#007AFF;'>" + createCateView + "</span></div>";
			html += "<div class='col-xs-6 col-sm-6 col-md-6 col-lg-6 right'>";
			if(status_code == '04') {
				html += "<span style='display:inline-block;padding-top:4px;padding-right:8px;color:#0090BB;'>" + status_name + "</span>";
			} else {
				html += "<span style='display:inline-block;padding-top:4px;padding-right:8px;color:#F5A224;'>" + status_name + "</span>";
			}
			html += "<div id='checkedDivs' name='0' status_code='" + status_code + "' class='" + id + "' billNo='" + billNo + "' style='width:125px;height:75px;background:transparent;position:absolute;z-index:3000;top:0;right:0;'></div>";
			html += "<div id='checkedDivsg' style='display:inline-block;border:1px solid #DEDEDE;border-radius:3px;width:25px;height:25px;float:right;'></div>";
			html += "</div></div>";
			html += "<div class='panel-bodys' taskIds='" + id + "' style='border-bottom:none;border-top:none;'>";
			html += "<div class='row' style='margin-top:-4px;padding-top:16px;font-size:21px;padding-bottom:2px;'>";

			if(urgent != "") {
				html += "<div class='col-xs-12 col-sm-12 col-md-12 col-lg-12' style='font-size:20px;color:#e4134b;'>" + from_dept_name + "</div>";
			} else {
				html += "<div class='col-xs-12 col-sm-12 col-md-12 col-lg-12' style='font-size:20px;color:#007AFF;'>" + from_dept_name + "</div>";
			}

			html += "</div></div></div>";

			//******************
			html += "<div  style='border-bottom:none;border-top:none;'>";
			html += "<div class='row' style='margin-top:-4px;padding-top:8px;font-size:21px;  padding-bottom: 3px;line-height: 25px;'>";
			if(billDesc != "") {

				html += "<span class='col-xs-8 col-sm-8 col-md-8 col-lg-8 font-grey'>备注:" + billDesc + "</span>";
			} else {
				html += "<span class='col-xs-8 col-sm-8 col-md-8 col-lg-8 font-grey'>备注:无</span>";
			}
			if(patient_name != "") {
				html += "<span class='col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey'>" + patient_name + "</span>";
			} else {
				html += "<span class='col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey'></span>";
			}
			html += "</div></div></div>";
			//***********

			return html;
		}

		//加载更多
		var loadMores = document.getElementById("loadMore");
		loadMores.addEventListener('tap', function() {
			if($('#loadMore').text().trim() == '加载更多') {
				rows += 4;
				ajaxData();
				$('#loadMore').text('正在加载中...');
			}
		}, false);

		//运送
		mui('#toAll').on('tap', 'div.panel-bodys', function() {
			$('#listUl').html('');
			clearTimeout(timer);
			var valuessT = $(this).parent().parent().find('div#checkedDivs').attr('name');
			ids = this.getAttribute('taskIds');
			patient_name = $(this).attr('patient_name');
			$(this).parent().parent().css('background', 'darkgray').siblings('div#div-child').css('background', '');
			$(this).parent().parent().find('div#panel-heading').css('background', 'darkgray');
			$(this).parent().parent().siblings('div#div-child').find('div#panel-heading').css('background', '');
			//打开菜单
			$('#pTexts').show();
			$('.mui-spinners').show();
			offCanvasWrapper.offCanvas('show');
			timer = setTimeout('listPJ()', 500);
		})

		mui('#toAll').on('tap', 'div#rowss1', function() {
			$('#listUl').html('');
			clearTimeout(timer);
			var valuessT = $(this).siblings('div').find('div#checkedDivs').attr('name');
			ids = this.getAttribute('taskIds');
			patient_name = $(this).attr('patient_name');
			$(this).parent().parent().parent().css('background', 'darkgray').siblings('div#div-child').css('background', '');;
			$(this).parent().parent().parent().find('div#panel-heading').css('background', 'darkgray');
			$(this).parent().parent().parent().siblings('div').find('div#panel-heading').css('background', '');
			//打开菜单
			$('#pTexts').show();
			$('.mui-spinners').show();
			offCanvasWrapper.offCanvas('show');
			timer = setTimeout('listPJ()', 500);
		})

		function listPJ() {
			$('#pTexts').show();
			$('.mui-spinners').show();
			$.ajax({
				url: baseUrl + 'app_carriageAppController.do?queryCurrentTaskItemList',
				type: 'post',
				data: {
					BillId: ids,
					taskType: taskType
				},
				success: function(data) {
					var list = data.obj;
					var lengthList = list.length;
					var html = "";
					if(data.respCode == '200' || data.respCode == 200) {
						for(var i = 0; i < list.length; i++) {
							if(i < 9) {
								var b = i + 1;
								var a = '0' + b;
							} else {
								var a = i + 1;
							}

							if(list[i].dected_class_name.length > 10) {
								var dected_class_name = list[i].dected_class_name.substring(0, 9) + '...';
							} else {
								var dected_class_name = list[i].dected_class_name;
							}

							var dected_class = list[i].dected_class;
							var dected_times = list[i].dected_timeView;
							var id = list[i].id;
							var item_status = list[i].item_status;
							var status_name = list[i].status_name;
							var item_acount = list[i].item_acount; //物品数量*
							var create_dateView = list[i].create_dateView; //登记时间*
							var complete_timeView = list[i].complete_timeView; //完成时间
							var to_address_content = list[i].to_address_content;
							html += "<span class='lis'>";
							html += "<li class='lisBlew' name='0' style='font-size:18px;text-align:left;padding-left:55px;padding-top:19px;padding-bottom:45px;position:relative;'>" + a + " . " + dected_class_name + "<span class='mui-icon mui-icon-arrowdown' style='float:right;margin-right:30px;margin-top:-3px;'></span>";
							if(item_status == '02') {
								html += "<a style='display:inline-block;width:38px;height:38px;line-height:38px;background:#0090BB;border-radius:30px;position:absolute;z-index:3000;top:10px;left:65px;text-align:center;color:#FFFFFF;font-size:15px;'>完成</a>";
							}
							html += "</li>";
							html += "<span id='blewDiv' hidden>";

							//***********************

							html += "<li style='text-align:left;padding-left:80px;height:40px;border-bottom:none;list-style: none;'>";
							html += "<p style='font-size:18px;'>物品数量:<span style='float:right;margin-right:30px;font-size:16x;'>" + item_acount + "</span></p>";
							html += "</li>";

							html += "<li style='text-align:left;padding-left:80px;height:40px;border-bottom:none;list-style: none;'>";
							html += "<p style='font-size:18px;'>登记时间:<span style='float:right;margin-right:30px;font-size:16x;'>" + create_dateView + "</span></p>";
							html += "</li>";

							if(complete_timeView != "") {
								html += "<li style='text-align:left;padding-left:80px;height:40px;border-bottom:none;list-style: none;'>";
								html += "<p style='font-size:18px;'>完成时间:<span style='float:right;margin-right:30px;font-size:16x;'>" + complete_timeView + "</span></p>";
								html += "</li>";
							}
							if(to_address_content != "") {
								html += "<li style='text-align:left;padding-left:80px;height:40px;border-bottom:none;list-style: none;'>";
								html += "<p style='font-size:18px;'>送达科室:<span style='float:right;margin-right:30px;font-size:16x;'>" + to_address_content + "</span></p>";
								html += "</li>";
							}
							//***************

							html += "<li style='text-align:left;padding-left:35px;height:60px;border-top:none;'>";
							html += "<p class='pButton' style='margin-top:-3px;font-size:18px;'>";
							if(item_status != '02') {
								html += '<button id="0" name="' + id + '" style="height:43px;color:#0090BB;border:1px solid #0090BB;width:37%;font-size:17px;float:right;margin-right:30px;margin-top:-18px;" type="button" class="mui-btn mui-btn-success mui-btn-outlined" hidden>确定</button>';
							} else {
								html += '<button id="1" name="' + id + '" style="height:43px;color:#0090BB;border:1px solid #0090BB;float:right;margin-right:30px;width:37%;margin-top:-18px;font-size:17px;" type="button" class="mui-btn mui-btn-success mui-btn-outlined">取消</button>';
							}
							html += "</p>";
							html += "</li>";
							html += "</span></span>";
						}
						$('#numText').text('共:' + lengthList);
						$('#pTexts').hide();
						$('.mui-spinners').hide();
						$('.listUl').html(html);
					}
				},
				complete: function(XMLHttpRequest, status) {　
					if(status == 'timeout') {
						$("#loading").hide();
						$('#pTexts').hide();
						$('.mui-spinners').hide();
						$('#warn small').html('连接超时，请检查您的网络是否通畅！');
						$('#warn').fadeIn(500);
						setTimeout("$('#warn').fadeOut(500)", 3000);　　　
					} else if(status == 'warn') {
						$("#loading").hide();
						$('#pTexts').hide();
						$('.mui-spinners').hide();
						$('#warn small').html('连接失败，服务运行异常！');
						$('#warn').fadeIn(500);
						setTimeout("$('#warn').fadeOut(500)", 3000);　
					}　
				}
			})
		}

		//按钮点击事件////运送
		mui("#navYun").on('tap', 'a.mui-tab-items', function() {
			var classS = this.getAttribute('id');
			if(classS == '0') {
				var opCode = 'reback',
					arrayAccept = '',
					kk = '0';
				$('#toAll div#div-child').each(function(index, element) {
					var status_code = $(this).find('div#checkedDivs').attr('status_code');
					var codeNameSure = $(this).find('div#checkedDivs').attr('name');
					var id = $(this).find('div#checkedDivs').attr('class') + ',';
					if(codeNameSure == '1') {
						arrayAccept += id;
						kk = '1';
					}
				})
				if(kk == '0') {
					$('#warn small').html('请选择需要回退的单据!');
					$("#warn").fadeIn(500);
					setTimeout("$('#warn').fadeOut(500)", 3000);
					return;　
				}
				Accepted(opCode, arrayAccept);
			} else if(classS == '1') {
				judgeCao = 'accept';
				var opCode = 'accept',
					arrayAccept = '',
					kk = '0';
				$('#toAll div#div-child').each(function(index, element) {
					var status_code = $(this).find('div#checkedDivs').attr('status_code');
					var codeNameSure = $(this).find('div#checkedDivs').attr('name');
					var id = $(this).find('div#checkedDivs').attr('class') + ',';
					if(codeNameSure == '1' && status_code == '02') {
						arrayAccept += id;
						kk = '1';
					}
				})
				if(kk == '0') {
					$('#warn small').html('请选择需要受理的单据，或检查单据是否可受理！');
					$("#warn").fadeIn(500);
					setTimeout("$('#warn').fadeOut(500)", 3000);
					return;　
				}
				judgeAccept(opCode, arrayAccept);
				//Accepted(opCode,arrayAccept);
			} else if(classS == '2') {
				var arrayAccept = '',
					kk = '0',
					statuArray = new Array();
				judgeCao = 'over';

				$('#toAll div#div-child').each(function(index, element) {
					var status_code = $(this).find('div#checkedDivs').attr('status_code');
					var codeNameSure = $(this).find('div#checkedDivs').attr('name');
					var id = $(this).find('div#checkedDivs').attr('class') + ',';
					if(codeNameSure == '1') {
						arrayAccept += id;
						kk = '1';
						statuArray.push(status_code);
					}
				})

				if(kk == '0') {
					$('#warn small').html('请选择需要完工的单据 ！');
					$("#warn").fadeIn(500);
					setTimeout("$('#warn').fadeOut(500)", 3000);
					return;　
				}

				//console.log(statuArray);
				if(statuArray.indexOf('03') != -1 || statuArray.indexOf('02') != -1) {
					$('#warn small').html('请选择待完工的单据完工!');
					$('#warn').fadeIn(500);
					setTimeout("$('#warn').fadeOut(500)", 3000);
					return;
				}

				//完工是否直接完工
				var btnArray = ['取消', '确认'];
				mui.confirm('请确认已完成的具体项目', '提醒', btnArray, function(e) {
					if(e.index == 1) {
						judgeData()
					}
				})
				//judgeData();
			} else {
				location.reload();
			}
		})

		$('#myModalss').click(function() {
			$(this).css('display', 'none');
			$('.aboveDiv').css('display', 'none');
			$('.aboveDivss').css('display', 'none');
		})

		//判断是否显示
		function judgeData() {
			var arrayValue = new Array(),
				arrayComplete = new Array(),
				numComplete = 0;
			$.ajax({
				url: baseUrl + 'app_carriageAppController.do?queryBackTypes',
				type: "post",
				success: function(data) {
					if(data.respCode == 200 || data.respCode == '200') {
						var list = data.obj;
						var html = '';
						//console.log(list);
						for(var i = 0; i < list.length; i++) {
							var paramValue1 = list[i].paramValue1;
							var typecode = list[i].typecode;
							var typename = list[i].typename;
							arrayValue.push(paramValue1);
							arrayComplete.push({ 'paramValue1s': paramValue1, 'typecodes': typecode });

							if(paramValue1 == 'Y') {
								numComplete += 1;
								html += '<li class="items" typecode="' + typecode + '">' + typename + '</li>';
							}
						}

						//console.log(arrayValue);
						if(arrayValue.indexOf('Y') == -1) {
							back_type = '03';
							funJudge();
							return;
						}

						if(numComplete == 1) {
							for(var j = 0; j < arrayComplete.length; j++) {
								var paramValue1Judge = arrayComplete[j].paramValue1s;
								var typecodesJudge = arrayComplete[j].typecodes;
								if(paramValue1Judge == 'Y') {
									if(typecodesJudge == '01' || typecodesJudge == 01) {
										back_type = '01';
										qrcodeCordovasss();
									} else if(typecodesJudge == '02' || typecodesJudge == 02) {
										$('#myModalsssssss').modal('show');
										back_type = '02';
									} else if(typecodesJudge == '03' || typecodesJudge == 03) {
										$('.aboveDivWarn').css('display', 'block');
										back_type = '03';
										mui('#spanLi').on('tap', 'span', function() {
											var idTexe = this.getAttribute('id');
											if(idTexe == '0') {
												var arrayAccepts = '';
												back_signature = '';
												workNoss = localStorage.getItem('workNo');
												worKnamess = localStorage.getItem('name');
												$('#toAll div#div-child').each(function(index, element) {
													var status_code = $(this).find('div#checkedDivs').attr('status_code');
													var codeNameSure = $(this).find('div#checkedDivs').attr('name');
													var id = $(this).find('div#checkedDivs').attr('class') + ',';
													if(codeNameSure == '1') {
														arrayAccepts += id;
													}
												})
												backDepartment(arrayAccepts);
											} else {
												$('.aboveDivWarn').css('display', 'none');
											}
										})
									}
								}
							}
							return;
						}

						$('.aboveDiv').css('display', 'block');
						$('#myModalss').css('display', 'block');
						$('#aboveDiv').html(html);
					}
				},
				complete: function(XMLHttpRequest, status) {　
					if(status == 'timeout') {
						$("#loading").hide();
						$('#warn small').html('连接超时，请检查您的网络是否通畅！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　　　
					} else if(status == 'warn') {
						$("#loading").hide();
						$('#warn small').html('连接失败，服务运行异常！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　
					}　
				}
			});
		}

		function judgeAccept(opCode, arrayAccept) {
			var arrayAcceptssss = new Array(),
				arrays = new Array(),
				num = 0;
			$.ajax({
				url: baseUrl + 'app_carriageAppController.do?queryConfimTypes',
				type: "post",
				success: function(data) {
					if(data.respCode == 200 || data.respCode == '200') {
						var list = data.obj;
						var html = '';
						//console.log(list);
						for(var i = 0; i < list.length; i++) {
							var paramValue1s = list[i].paramValue1;
							var typecodes = list[i].typecode;
							var typenames = list[i].typename;
							arrayAcceptssss.push(paramValue1s);
							arrays.push({ 'paramValue1s': paramValue1s, 'typecodes': typecodes });

							if(paramValue1s == 'Y') {
								num += 1;
								html += '<li class="items" typecode="' + typecodes + '">' + typenames + '</li>';
							}
						}

						//判断可配置项
						if(arrayAcceptssss.indexOf('Y') == -1) {
							Accepted(opCode, arrayAccept);
							return;
						}

						if(num == 1 || num == '1') {
							for(var j = 0; j < arrays.length; j++) {
								var paramValue1Judge = arrays[j].paramValue1s;
								var typecodesJudge = arrays[j].typecodes;
								if(paramValue1Judge == 'Y') {
									if(typecodesJudge == '01' || typecodesJudge == 01) {
										qrcodeAccept();
									} else if(typecodesJudge == '02' || typecodesJudge == 02) {
										$('#myModalsssssss').modal('show');
									} else if(typecodesJudge == '03' || typecodesJudge == 03) {
										Accepted(opCode, arrayAccept);
									}
								}
							}
							return;
						}

						$('#aboveAccept').html(html);
						$('.aboveAccept').css('display', 'block');
						$('#myModal').css('display', 'block');
					}
				},
				complete: function(XMLHttpRequest, status) {　
					if(status == 'timeout') {
						$("#loading").hide();
						$('#warn small').html('连接超时，请检查您的网络是否通畅！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　　　
					} else if(status == 'warn') {
						$("#loading").hide();
						$('#warn small').html('连接失败，服务运行异常！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　
					}　
				}
			});
		}

		//受理
		mui('#aboveAccept').on('tap', 'li.items', function() {
			var typecodeJudges = this.getAttribute('typecode');

			if(typecodeJudges == '01') {

				qrcodeAccept();

			} else if(typecodeJudges == '02') {

				$('#myModalsssssss').modal('show');

			} else if(typecodeJudges == '03') {

				var opCode = 'accept',
					arrayAccept = '';
				$('#toAll div#div-child').each(function(index, element) {
					var codeNameSure = $(this).find('div#checkedDivs').attr('name');
					var id = $(this).find('div#checkedDivs').attr('class') + ',';
					if(codeNameSure == '1') {
						arrayAccept += id;
					}
				})

				Accepted(opCode, arrayAccept);
			}
		})

		function qrcodeAccept() {
			cordova.plugins.barcodeScanner.scan(
				function(result) {
					if(result.text != "") {
						scaneAccept(result.text);
					}
				},
				function(error) {
					$('#warn small').html('自回科室失败，请重试！');
					$("#warn").fadeIn(500);
					setTimeout("$('#warn').fadeOut(500)", 3000);
				}
			)
		}

		//resultss
		function scaneAccept(resultss) {
			var codeName = decodeURIComponent(resultss);
			var index = codeName.indexOf(',');
			var indexFina = codeName.indexOf('.');
			var nameScan = codeName.substring(index + 1, indexFina);

			deptAcceptCode = codeName.substring(indexFina + 1, codeName.length);

			var arrayAccept = '',
				opCode = 'accept';
			$('#toAll div#div-child').each(function(index, element) {
				var codeNameSure = $(this).find('div#checkedDivs').attr('name');
				var id = $(this).find('div#checkedDivs').attr('class') + ',';
				if(codeNameSure == '1') {
					arrayAccept += id;
				}
			})

			Accepted(opCode, arrayAccept);
		}

		function funJudge() {
			var arrayAccepts = '';
			back_signature = '';
			workNoss = localStorage.getItem('workNo');
			worKnamess = localStorage.getItem('name');

			$('#toAll div#div-child').each(function(index, element) {
				var status_code = $(this).find('div#checkedDivs').attr('status_code');
				var codeNameSure = $(this).find('div#checkedDivs').attr('name');
				var id = $(this).find('div#checkedDivs').attr('class') + ',';
				if(codeNameSure == '1') {
					arrayAccepts += id;
				}
			})

			backDepartment(arrayAccepts);
		}

		mui('#aboveDiv').on('tap', 'li.items', function() {
			var typecodeJudge = this.getAttribute('typecode');
			back_type = typecodeJudge;
			if(typecodeJudge == '01') {

				qrcodeCordovasss();

			} else if(typecodeJudge == '02') {

				$('#myModalsssssss').modal('show');
				/*$('#warn small').html('签名签收功能暂未开通！');
    $('#warn').fadeIn(500);
    setTimeout("$('#warn').fadeOut(500)", 3000);
    return;*/

			} else if(typecodeJudge == '03') {

				$('.aboveDivWarn').css('display', 'block');
				mui('#spanLi').on('tap', 'span', function() {
					var idTexe = this.getAttribute('id');
					if(idTexe == '0') {
						var arrayAccepts = '';
						back_signature = '';
						workNoss = localStorage.getItem('workNo');
						worKnamess = localStorage.getItem('name');

						$('#toAll div#div-child').each(function(index, element) {
							var status_code = $(this).find('div#checkedDivs').attr('status_code');
							var codeNameSure = $(this).find('div#checkedDivs').attr('name');
							var id = $(this).find('div#checkedDivs').attr('class') + ',';
							if(codeNameSure == '1') {
								arrayAccepts += id;
							}
						})

						backDepartment(arrayAccepts);

					} else {
						$('.aboveDivWarn').css('display', 'none');
					}
				})
			}
		})

		function qrcodeCordovasss() {
			cordova.plugins.barcodeScanner.scan(
				function(result) {
					if(result.text != "") {
						scanedsss(result.text);
					}
				},
				function(error) {
					$('#warn small').html('自回科室失败，请重试！');
					$("#warn").fadeIn(500);
					setTimeout("$('#warn').fadeOut(500)", 3000);
				}
			)
		}

		//resultss
		function scanedsss(resultss) {
			var codeName = decodeURIComponent(resultss);
			var index = codeName.indexOf(',');
			var indexFina = codeName.indexOf('.');
			var nameScan = codeName.substring(index + 1, indexFina);

			workNoss = codeName.substring(0, index);
			deptCodess = codeName.substring(indexFina + 1, codeName.length);

			var zhaunArray = new Array();
			$('#toAll div#div-child').each(function(index, element) {
				var codeName = $(this).find('div#checkedDivs').attr('name');
				var id = $(this).find('div#checkedDivs').attr('class') + ',';
				var status_code = $(this).find('div#checkedDivs').attr('status_code');
				if(codeName == '1') {
					zhaunArray += id;
				}
			});

			departmentScan(zhaunArray, nameScan);

		}

		//扫码及扫码
		function departmentScan(zhaunArray, nameScan) {
			/*alert(zhaunArray);*/
			$.ajax({
				url: baseUrl + 'app_carriageAppController.do?backToDepartmentByScan',
				type: 'post',
				data: {
					taskID: zhaunArray,
					currentUser: workNo,
					currentUserName: worKname,
					back_type: back_type,
					back_time: back_time,
					back_confirm_man_account: workNoss,
					back_confirm_man_name: nameScan,
					back_signature: back_signature,
					service_score: service_score,
					deptCode: deptCodess
				},
				success: function(data) {
					//console.log(data);
					if(data.respCode == 200 || data.respCode == '200') {
						judgeEve(zhaunArray);
					} else {
						$('#warn small').html(data.respMsg);
						$("#warn").fadeIn(500);
						setTimeout("$('#warn').fadeOut(500)", 3000);
						return;
					}
				},
				complete: function(XMLHttpRequest, status) {　
					if(status == 'timeout') {
						$("#loading").hide();
						$('#warn small').html('连接超时，请检查您的网络是否通畅！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　　　
					} else if(status == 'warn') {
						$("#loading").hide();
						$('#warn small').html('连接失败，服务运行异常！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　
					}　
				}
			})
		}

		function judgeEve(zhaunArray) {
			$.ajax({
				url: baseUrl + 'app_carriageAppController.do?queryEvalTypes',
				type: 'post',
				data: {
					taskID: zhaunArray,
					currentUser: workNo,
					currentUserName: worKname,
					back_type: back_type,
					back_time: back_time,
					back_confirm_man_account: workNoss,
					back_confirm_man_name: worKnamess,
					back_signature: back_signature,
					service_score: service_score,
					deptCode: deptCodess
				},
				success: function(data) {
					//console.log(data);
					var listdata = data.obj;
					if(data.respCode == 200 || data.respCode == '200') {
						var arraryData = {
							'taskID': zhaunArray,
							'currentUser': workNo,
							'currentUserName': worKname,
							'taskType': 'YS'
						}
						var jsonArray = JSON.stringify(arraryData);

						for(var i = 0; i < listdata.length; i++) {
							var typecode = listdata[i].typecode;
							var paramValue1 = listdata[i].paramValue1;
							if(typecode == '01') {
								if(paramValue1 == 'Y') {
									location.href = "evalStar.html?" + encodeURIComponent(jsonArray);
								} else {
									location.reload();
								}
							}
						}
					}
				},
				complete: function(XMLHttpRequest, status) {　
					if(status == 'timeout') {
						$("#loading").hide();
						$('#warn small').html('连接超时，请检查您的网络是否通畅！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　　　
					} else if(status == 'warn') {
						$("#loading").hide();
						$('#warn small').html('连接失败，服务运行异常！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　
					}　
				}
			})
		}

		//签名
		$(document).on('ready', function() {
			if($('.js-signature').length) {
				$('.js-signature').jqSignature();
			}
		});

		function clearCanvas() {
			$('.js-signature').eq(0).jqSignature('clearCanvas');
			//$('#saveBtn').attr('disabled', true);
		}

		function saveSignature() {
			$('#signature').empty();
			var dataUrl = $('.js-signature').eq(0).jqSignature('getDataURL');
			/*console.log(dataUrl);*/
			var img = $('<img>').attr('src', dataUrl);
			$('#signature').append(img);

			//获取图片
			$("#signature img").each(function(index, element) {
				if(judgeCao == 'over') {
					back_signature = getBase64Image(element);
				} else {
					back_signature_accept = getBase64Image(element);
				}
			})

			var arrayAccepts = '',
				arrayAccept = '';

			$('#toAll div#div-child').each(function(index, element) {
				var status_code = $(this).find('div#checkedDivs').attr('status_code');
				var codeNameSure = $(this).find('div#checkedDivs').attr('name');
				var id = $(this).find('div#checkedDivs').attr('class') + ',';
				//alert(id);
				if(codeNameSure == '1') {
					arrayAccepts += id;
					arrayAccept += id;
				}
			})

			//判断调的接口
			if(judgeCao == 'over') {
				AcceptSignature(arrayAccepts);
			} else {
				var opCode = 'accept';
				Accepted(opCode, arrayAccept);
			}
		}

		$('.js-signature').eq(1).on('jq.signature.changed', function() {
			$('#saveBtn').attr('disabled', false);
		});

		function AcceptSignature(arrayAccepts) {
			$.ajax({
				url: baseUrl + 'app_carriageAppController.do?saveSignatures',
				type: 'post',
				data: {
					picStr: back_signature,
					id: arrayAccepts,
					workNo: workNo,
					back_type: back_type
				},
				success: function(data) {
					if(data.respCode == 200 || data.respCode == '200') {
						judgeEve(arrayAccepts);
					} else {
						$('#warn small').html(data.respMsg);
						$("#warn").fadeIn(500);
						setTimeout("$('#warn').fadeOut(500)", 3000);
						return;
					}
				},
				complete: function(XMLHttpRequest, status) {　
					if(status == 'timeout') {
						$("#loading").hide();
						$('#warn small').html('连接超时，请检查您的网络是否通畅！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　　　
					} else if(status == 'warn') {
						$("#loading").hide();
						$('#warn small').html('连接失败，服务运行异常！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　
					}　
				}
			})
		}

		//获取图片base64
		function getBase64Image(img) {
			var canvas = document.createElement("canvas");
			var image = new Image();
			image.src = img.src;
			img.crossOrigin = "Anonymous";
			var width;
			var height;
			width = 768;
			height = image.height * 768 / image.width;
			background = 'red';
			canvas.width = width;
			canvas.height = height;
			canvas.background = "#FFFFFF";
			var ctx = canvas.getContext("2d");
			ctx.drawImage(image, 0, 0, width, height);
			var dataURL = canvas.toDataURL("image/JPEG");
			//data:image/jpeg;base64,
			return dataURL.substring(23, dataURL.length);
			// return dataURL.replace("data:image/png;base64,", "");
		};

		$('#myModal').click(function() {
			$(this).css('display', 'none');
			$('.aboveDiv').css('display', 'none');
			$('.aboveDivss').css('display', 'none');
			$('.aboveAccept').css('display', 'none');
		})

		function Accepted(opCode, arrayAccept) {
			$.ajax({
				url: baseUrl + 'app_carriageAppController.do?billToAcceptOrReback',
				type: 'post',
				data: {
					opCode: opCode,
					taskID: arrayAccept,
					currentUser: workNo,
					currentUserName: worKname,
					scanCode: deptAcceptCode,
					signatures: back_signature_accept
				},
				success: function(data) {
					//console.log(data);
					if(data.respCode == 200 || data.respCode == '200') {
						$('#warn small').html('处理中, 请稍后...');
						$('#warn').fadeIn(500);
						setTimeout("$('#warn').fadeOut(500)", 1500);
						ajaxData();

						//隐藏
						$('.aboveAccept').css('display', 'none');
						$('#myModal').css('display', 'none');
					} else {
						$('#warn small').html(data.respMsg);
						$("#warn").fadeIn(500);
						setTimeout("$('#warn').fadeOut(500)", 3000);
						return;
					}
				},
				complete: function(XMLHttpRequest, status) {　
					if(status == 'timeout') {
						$("#loading").hide();
						$('#warn small').html('连接超时，请检查您的网络是否通畅！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　　　
					} else if(status == 'warn') {
						$("#loading").hide();
						$('#warn small').html('连接失败，服务运行异常！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　
					}　
				}
			})
		}

		function backDepartment(arrayAccept) {
			$.ajax({
				url: baseUrl + 'app_carriageAppController.do?backToDepartment',
				type: 'post',
				data: {
					taskID: arrayAccept,
					currentUser: workNo,
					currentUserName: worKname,
					back_type: back_type,
					back_time: back_time,
					back_confirm_man_account: workNoss,
					back_confirm_man_name: worKnamess,
					back_signature: back_signature,
					service_score: service_score,
					deptCode: deptCode
				},
				success: function(data) {
					if(data.respCode == 200 || data.respCode == '200') {
						$('#warn small').html('处理中, 请稍后...');
						$('#warn').fadeIn(500);
						setTimeout("$('#warn').fadeOut(500)", 3000);
						location.reload();
					} else {
						$('#warn small').html(data.respMsg);
						$("#warn").fadeIn(500);
						setTimeout("$('#warn').fadeOut(500)", 3000);
						return;
					}
				},
				complete: function(XMLHttpRequest, status) {　
					if(status == 'timeout') {
						$("#loading").hide();
						$('#warn small').html('连接超时，请检查您的网络是否通畅！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　　　
					} else if(status == 'warn') {
						$("#loading").hide();
						$('#warn small').html('连接失败，服务运行异常！');
						$('#warn').show();
						setTimeout("$('#warn').hide()", 3000);　
					}　
				}
			})
		}

		//确定,取消
		mui('.listUl').on('tap', 'p.pButton button', function() {
			var idss = $(this).attr('name');
			if($(this).attr('id') == '0') {
				var opCode = 'finish';
				if(scanFinish) {
					cordova.plugins.barcodeScanner.scan(
						function(result) {
							if(result.text != "")
								funSureCancel(idss, opCode, result.text);
						},
						function(error) {
							$('#warn small').html('获取二维码失败');
							$("#warn").fadeIn(500);
							setTimeout("$('#warn').fadeOut(500)", 3000);
						}
					)
				} else {
					funSureCancel(idss, opCode, "");
				}
			} else {
				var opCode = 'cancel';
				funSureCancel(idss, opCode, "");
			}

		})

		function funSureCancel(idss, opCode) {
			$.ajax({
				url: baseUrl + 'app_carriageAppController.do?saveForBillToFinishOrCancel',
				type: 'post',
				data: {
					taskID: ids,
					taskItemID: idss,
					opCode: opCode,
					currentUser: workNo,
					currentUserName: worKname,
					completeType: 'APP'
				},
				success: function(data) {
					//console.log(data);
					if(data.respCode == '200' || data.respCode == 200) {
						$('#warnss small').html(data.respMsg);
						$('#warnss').fadeIn(500);
						setTimeout("$('#warnss').fadeOut(500)", 2500)
						ajaxData();
						listPJ();
					} else {
						$('#warnss small').html(data.respMsg);
						$('#warnss').fadeIn(500);
						setTimeout("$('#warnss').fadeOut(500)", 3000);
						return;　
					}
				},
				complete: function(XMLHttpRequest, status) {　
					if(status == 'timeout') {
						$("#loading").hide();
						$('#warn small').html('连接超时，请检查您的网络是否通畅！');
						$('#warn').fadeIn(500);
						setTimeout("$('#warn').fadeOut(500)", 3000);　　　
					} else if(status == 'warn') {
						$("#loading").hide();
						$('#warn small').html('连接失败，服务运行异常！');
						$('#warn').fadeIn(500);
						setTimeout("$('#warn').fadeOut(500)", 3000);　
					}　
				}
			})
		}

		//运送
		mui('#toAll').on('tap', 'div#checkedDivs', function() {
			var nameUe = $(this).attr('name');
			if(nameUe == '0') {
				$(this).parent().find('div#checkedDivsg').html('<span class="glyphicon glyphicon-ok" style="color:#007AFF;"></span>');
				$(this).attr('name', '1'); /*.parent().parent().parent().parent().siblings('div').find('div#checkedDivs').attr('name','0');*/
				$(this).parent().parent().parent().parent().find('div.panel-bodys');
			} else {
				$(this).parent().find('div#checkedDivsg').html('');
				$(this).attr('name', '0');
				$(this).parent().parent().parent().parent().find('div.panel-bodys');
			}
		})

		mui('#toAll').on('tap', 'div#rowss1', function() {
			$('#listUl').html('');
			clearTimeout(timer);
			var valuessT = $(this).siblings('div').find('div#checkedDivs').attr('name');
			ids = this.getAttribute('taskIds');
			patient_name = $(this).attr('patient_name');
			$(this).parent().parent().parent().css('background', 'darkgray').siblings('div#div-child').css('background', '');;
			$(this).parent().parent().parent().find('div#panel-heading').css('background', 'darkgray');
			$(this).parent().parent().parent().siblings('div').find('div#panel-heading').css('background', '');
			//打开菜单
			$('#pTexts').show();
			$('.mui-spinners').show();
			offCanvasWrapper.offCanvas('show');
			timer = setTimeout('listPJ()', 500);
		})

		mui('.listUl').on('tap', 'li.lisBlew', function() {
			var name = $(this).attr('name');
			$(this).parent().find('span#blewDiv').toggle();
			if(name == '0') {
				$(this).find('span').attr('class', 'mui-icon mui-icon-arrowup');
				$(this).attr('name', '1');
			} else {
				$(this).find('span').attr('class', 'mui-icon mui-icon-arrowdown');
				$(this).attr('name', '0');
			}
		})

		//关闭菜单
		var offCanvasWrapper = mui('#offCanvasWrapper');
		document.getElementById('offCanvasHide').addEventListener('tap', function() {
			offCanvasWrapper.offCanvas('close');
		});

		var peopeleQrcodeDiv = document.getElementById("peopeleQrcode");
		var contentMainss = document.getElementById("contentMain");
		var qrcodeParents = document.getElementById("qrcodeParent");
		var qrcode = document.getElementById("qrcode");
		var myModals = document.getElementById("myModal");

		peopeleQrcodeDiv.addEventListener('tap', function() {
			qrcodeParents.style.display = 'block';
			myModals.style.display = 'block';
			$('#contentMain').addClass('blur');
			$('#qrcodeName').text(name);
		}, false);

		qrcode.addEventListener('tap', function() {
			$('#contentMain').removeClass('blur');
			qrcodeParents.style.display = 'none';
			myModals.style.display = 'none';
		}, true);

		//禁用ios平台原生侧滑关闭页面
		if(mui.os.plus && mui.os.ios) {
			mui.plusReady(function() {
				plus.webview.currentWebview().setStyle({
					'popGesture': 'none'
				});
			});
		}

		var elem = document.querySelector('body');
		elem.addEventListener("dragend", function() {
			/* alert('加载中...');*/
		});

		//生成二维码
		$(function() {
			//更详细的配置
			$('#qrcode').qrcode({
				text: encodeURIComponent(workNo + ',' + name + '.' + deptCode),
				width: 250,
				height: 250,
				background: "#FFFFFF",
				foreground: "black"
			});
		})

		//显示运送、陪检
		mui('#sliderSegmentedControl').on('tap', 'div.center', function() {
			var idText = this.getAttribute('name');
			if(idText == '0') {
				location.href = "sendList.html";
			} else if(idText == '1') {
				location.href = "yunsong.html";
			}
		})

		$('#back').click(function() {
			location.href = "../../menu.html";
		})
	</script>

</html>