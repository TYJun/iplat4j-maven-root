<!DOCTYPE html>
<html class="no-js">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="renderer" content="webkit" />
  <!--   <meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'"> -->
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <link rel="stylesheet" href="../../reference/bootstrap-3.3.5/css/bootstrap.min.css" />
  <link rel="stylesheet" href="../../reference/bootstrap-3.3.5/css/bootstrap-theme.min.css" />
  <link rel="stylesheet" href="../../reference/loading/loaders.min.css" />
  <link rel="stylesheet" href="../../reference/mobiscroll-2.5.2/css/mobiscroll.custom-2.5.2.min.css" />
  <link rel="stylesheet" href="../../css/android-ios.css" />
  <link rel="stylesheet" href="../../css/loading.css" />
  <link rel="stylesheet" href="../../reference/mui/css/mui.css" />
  <link rel="stylesheet" href="css/colorGreen.css" />
</head>
<style type="text/css">
  body {
    background: #f1f1f1;
  }

  hr {
    margin-top: 0px;
    margin-bottom: 0px;
  }

  h3 {
    margin-top: 10px;
    margin-bottom: 10px;
  }

  .round {
    border: 1px solid #2aabd2;
    -moz-box-shadow: 3px 3px 4px #2aabd2;
    -webkit-box-shadow: 3px 3px 4px #2aabd2;
    box-shadow: 3px 3px 4px #2aabd2;
    width: 70%;
    height: 175px;
    position: absolute;
    overflow: scroll;
    overflow-x: hidden;
    background-color: #ffffff;
    border-radius: 3px;
  }

  .btn-sb {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: #2aabd2;
    text-align: center;
    height: 50px;
    line-height: 50px;
    color: #fff;
    font-size: 18px;
  }

  .navbar {
    margin-bottom: 0px;
  }

  .nav>li>a {
    padding: 5px 5px;
  }

  h1 {
    margin: 0 0 0rem;
  }

  .row {
    margin-right: 0px;
    margin-left: 0px;
  }

  input[type="text"] {
    padding: 0 0;
    height: 21px;
    margin-bottom: 0px;
  }

  /*录音*/

  .audio {
    display: flex;
    justify-content: center;
    margin-top: 10px;
    display: none;
  }

  .audio img {
    width: 50px;
    height: 50px;
    opacity: 0.5;
  }
</style>

<body>
  <div>
    <nav class="navbar navbar-fixed-top navbar-inverse nav-height">
      <div id="back" class="glyphicon-btn-left">
        <span class="glyphicon glyphicon-triangle-left userBtn" style="margin-left: 1rem"></span>
      </div>
      <div>
        <h1 class="title-right">保洁完工</h1>
      </div>
    </nav>
  </div>
  <div id="warn" class="warn" hidden>
    <small></small>
  </div>

  <div id="loading" class="spinner" hidden style="position: fixed; z-index: 9999; text-align: center; width: 100%">
    <div class="bounce1"></div>
    <div class="bounce2"></div>
    <div class="bounce3"></div>
  </div>

  <div id="upload" class="transparent" hidden>
    <div id="waiting" class="loader loading-position">
      <div class="loader-inner line-spin-fade-loader">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
    <div style="
          color: #fff;
          position: relative;
          width: 100%;
          text-align: center;
          top: 40%;
        ">
      正在提交，请稍候...
    </div>

    <div id="succeed" class="result-window" hidden>
      <span class="glyphicon glyphicon-ok-circle" style="font-size: 40px; color: #25f706"></span>
      <span style="color: #25f706">提交成功</span>
    </div>
    <div id="failed" class="result-window" hidden>
      <span class="glyphicon glyphicon-remove-circle" style="font-size: 40px; color: #ff7c7c"></span>
      <span style="color: #ff7c7c">提交失败了</span>
    </div>
  </div>

  <div id="content" class="top50">
    <div style="
          width: 100%;
          background: #fff;
          border: 1px solid #eee;
          margin-bottom: 0px;
        ">
      <div class="row" style="margin-top: 10px" id="updateShow">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
          工单号
        </div>
        <div id="taskNo" class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align: right"></div>
      </div>
      <hr style="margin-top: 10px" />

      <div class="row" style="margin-top: 10px">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
          登记人
        </div>
        <div id="name" class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align: right"></div>
      </div>
      <hr style="margin-top: 10px" />

      <div class="row" style="margin-top: 10px">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
          联系电话
        </div>
        <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align: right">
          <input id="phoneNum" style="border: none; outline: none; text-align: right" placeholder="请输入报修电话"
            maxlength="11" onkeyup="this.value=this.value.replace(/\D/g,'')" />
        </div>
      </div>
      <hr style="margin-top: 10px" />

      <div class="row" style="margin-top: 10px" hidden="true">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
          报修来源
        </div>
        <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align: right; color: #3ec521">
          请选择报修来源
          <p id="repairSource" hidden>01</p>
        </div>
      </div>
      <div id="yang" class="row" style="margin-top: 10px" hidden="true">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 center">
          <button type="button" value="01" id="butOne" class="status btn btn-sm btn-info" style="
                width: 70px;
                text-align: center;
                text-shadow: none;
                width: 100%;
              ">
            医务报修
          </button>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 center">
          <button type="button" value="02" id="butTwo" class="status btn btn-sm btn-default" style="
                width: 70px;
                text-align: center;
                text-shadow: none;
                width: 100%;
              ">
            班组自查
          </button>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 center">
          <button type="button" value="03" id="butThree" class="status btn btn-sm btn-default" style="
                width: 70px;
                text-align: center;
                text-shadow: none;
                width: 100%;
              ">
            领导巡查
          </button>
        </div>
      </div>
      <div class="wocaojINJI">
        <hr style="margin-top: 10px" />

        <div class="row">
          <div class="col-xs-5 col-sm-5 col-md-5 col-lg-5 font-grey" style="padding-top: 10px">
            任务是否紧急
          </div>
          <div id="YorN" class="col-xs-7 col-sm-7 col-md-7 col-lg-7"
            style="text-align: right; display: flex; height: 40px">
            <div class="mui-input-row mui-radio">
              <label style="font-weight: normal">是</label>
              <input name="radio1" type="radio" id="Y" style="top: 2px" />
            </div>
            <div class="mui-input-row mui-radio">
              <label style="font-weight: normal">否</label>
              <input name="radio1" type="radio" id="N" style="top: 2px" />
            </div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top: 10px">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
          登记科室
        </div>
        <div id="reqDeptName" class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align: right"></div>
      </div>
      <hr style="margin-top: 10px" />

      <!-- <div class="row" style="margin-top: 10px">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">楼</div>
        <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align: right">
          <input type="text" id="building" style="
                border: none;
                outline: none;
                text-align: right;
                font-size: 12px;
                width: 100%;
              " placeholder="选择楼" readonly />
        </div>
        <div id="addIcon1" class="col-xs-1 col-sm-1 col-md-1 col-lg-1" style="padding: 0px">
          <span class="glyphicon glyphicon-map-marker" style="color: #ef8915"></span>
        </div>
      </div>
      <hr style="margin-top: 10px" />

      <div class="row" style="margin-top: 10px">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">层</div>
        <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align: right">
          <input type="text" id="floor" style="
                border: none;
                outline: none;
                text-align: right;
                font-size: 12px;
                width: 100%;
              " placeholder="选择层" readonly />
        </div>
        <div id="addIcon2" class="col-xs-1 col-sm-1 col-md-1 col-lg-1" style="padding: 0px">
          <span class="glyphicon glyphicon-map-marker" style="color: #ef8915"></span>
        </div>
      </div>
      <hr style="margin-top: 10px" /> -->

      <div class="row" style="margin-top: 10px">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">地点</div>
        <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align: right">
          <input type="text" id="reqSpotName" style="
                border: none;
                outline: none;
                text-align: right;
                font-size: 12px;
                width: 100%;
              " placeholder="选择或输入查询地点" />
        </div>
        <div id="addIcon3" class="col-xs-1 col-sm-1 col-md-1 col-lg-1" style="padding: 0px">
          <span class="glyphicon glyphicon-map-marker" style="color: #ef8915"></span>
        </div>
      </div>
      <hr style="margin-top: 10px" />

      <div class="row" style="margin-top: 10px; position: relative">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
          保洁事项
        </div>
        <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align: right">
          <input type="text" id="itemName" style="
                border: none;
                outline: none;
                text-align: right;
                font-size: 12px;
                width: 100%;
              " placeholder="选择或输入维修事项" oninput="getItemByName(this.value)" />
          <p id="itemCode" hidden></p>
        </div>
        <div id="itemIcon" class="col-xs-1 col-sm-1 col-md-1 col-lg-1" style="padding: 0px">
          <span class="glyphicon glyphicon-tags" style="color: #ef8915"></span>
        </div>
        <div id="closeSpanss" style="
              position: absolute;
              z-index: 200;
              top: 42px;
              right: 3px;
              width: 55px;
              height: 25px;
              text-align: center;
            " hidden>
          关闭
        </div>
      </div>
      <hr style="margin-top: 10px" />

      <div class="row" id="departParent" style="margin-top: 10px; position: relative" hidden>
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
          保洁科室
        </div>
        <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" id="departIcon" style="text-align: right">
          <input type="text" id="departName" style="
                border: none;
                outline: none;
                text-align: right;
                font-size: 12px;
                width: 100%;
              " placeholder="点击选择维修科室" readonly />
          <p id="departCode" hidden></p>
        </div>
      </div>
      <hr id="departHr" style="margin-top: 10px" hidden />

      <div class="row" style="margin-top: 10px" hidden="true">
        <div class="col-xs-5 col-sm-5 col-md-5 col-lg-5 font-grey">
          预约维修时间
        </div>
        <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align: right">
          <input id="reOrderTime" type="text" style="
                border: none;
                outline: none;
                text-align: right;
                font-size: 12px;
                width: 100%;
              " placeholder="选择预约维修时间" />
        </div>
      </div>
      <hr style="margin-top: 10px" hidden="true" />

      <!--<div class="row" style="margin-top:10px;">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
          设备档案
        </div>
        <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align:right;">
          <input id="deviceSelect" type="text" style="border:none;outline:none;text-align:right;font-size:12px;width:100%;" data-toggle="modal" 
   				data-target="#myModalWaste" placeholder="选择设备档案">
        </div>
        <p id="itemTypeCode" hidden></p>
      </div>
      <hr style="margin-top:10px;">-->
      <!-- <div class="row" style="margin-top: 10px">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
          事项分类
        </div>
        <div id="itemTypeName" class="col-xs-8 col-sm-8 col-md-8 col-lg-8"
          style="text-align: right; font-size: 12px; line-height: 20px"></div>
        <p id="itemTypeCode" hidden></p>
      </div>
      <hr style="margin-top: 10px" /> -->
      <div class="row" style="margin-top: 10px">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">备注</div>
        <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align: right">
          <input type="text" id="comments" style="
                border: none;
                outline: none;
                text-align: right;
                font-size: 12px;
              " placeholder="" />
        </div>
      </div>
      <hr style="margin-top: 10px" />

      <div class="row" style="margin-top: 10px">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
          图片上传
        </div>
        <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align: right">
          <button type="button" id="btnPicture" class="btn btn-info btn-sm">
            本地上传
          </button>
          <button type="button" id="btnCamera" class="btn btn-info btn-sm">
            相机拍摄
          </button>
        </div>
      </div>
      <hr style="margin-top: 10px" />
      <div class="row" style="margin-top: 10px">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 font-grey">
          图片
        </div>
      </div>
      <hr style="margin-top: 10px" />
      <div class="row" style="margin-top: 10px">
        <div id="picture" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 row"></div>
      </div>
      <!-- <hr style="margin-top:10px;">  -->
      <!-- <div class="row" style="padding-bottom: 10px">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey" style="line-height: 30px">
          录音
        </div>
        <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align: right">
          <button type="button" id="audioClick" class="btn btn-info btn-sm">
            录音
          </button>
          <button type="button" class="btn btn-info btn-sm" onclick="audioCapture()">录音</button>
        </div>
      </div> -->
      <!-- <hr style="margin-top:10px;" > -->
      <div class="row" style="min-height: 0px; margin-bottom: 60px">
        <div class="audio">
          <img src="img/play.png" />
        </div>
      </div>
      <!-- <div class="row" style="margin-top:10px;margin-bottom:70px;">
					<div id="luyin" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 row">

					</div>
				</div> -->
    </div>

    <button id="submit" type="button" class="btn btn-info btn-block"
      style="height: 40px; border-radius: 2px; position: fixed; bottom: 0px">
      提交
    </button>
  </div>

  <!-- <div id="submit" class="btn-sb">
    提交
  </div> -->

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">图片预览</h4>
        </div>
        <div style="text-align: center">
          <img id="bigPicture" />
        </div>
        <div class="modal-footer">
          <button id="delPic" type="button" class="btn btn-danger btn-block" data-dismiss="modal">
            删除图片
          </button>
          <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">
            关闭
          </button>
        </div>
      </div>
    </div>
  </div>

  <!--报废原因-->
  <div class="modal fade" id="myModalWaste" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true" style="margin-top: 15%">
    <div class="modal-dialog">
      <div class="modal-content" style="
            margin-top: 100px;
            padding-top: 15px;
            height: 350px;
            overflow-y: auto;
          ">
        <div class="modal-header" style="position: fixed; z-index: 2000; background: #ffffff; top: 0">
          <div class="row">
            <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align: center">
              <input id="shebei" type="text" style="
                    width: 130%;
                    border: 1px solid #d0d6d6;
                    outline: none;
                    text-align: center;
                    height: 30px;
                  " placeholder="输入设备名称" />
            </div>
            <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align: left">
              <input id="place" type="text" style="
                    width: 130%;
                    border: 1px solid #d0d6d6;
                    outline: none;
                    text-align: center;
                    height: 30px;
                  " placeholder="输入安装地点" />
            </div>
            <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align: left">
              <button id="searchIn" type="button" class="btn btn-sm" style="
                    height: 30px;
                    width: 100%;
                    background: #43b6d8;
                    color: #ffffff;
                  ">
                搜索
              </button>
            </div>
          </div>
        </div>
        <div class="row" style="margin-top: 50px">
          <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="text-align: center; overflow-y: auto">
            <ul id="ddUl" class="nav nav-pills nav-justified"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="getItemByName" class="round" hidden>
    <ul class="nav nav-pills nav-justified getItemByName" style="clear: both; position: relative; padding-top: 20px">
    </ul>
  </div>

  <div id="getAddByName" class="round" hidden>
    <ul class="nav nav-pills nav-justified getAddByName" style="clear: both; position: relative; padding-top: 20px">
    </ul>
  </div>

  <div class="modal fade" id="addIconModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true" style="margin-top: 15%">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">地点选择</h4>
        </div>
        <div class="row">
          <div class="col-xs-5 col-sm-5 col-md-5 col-lg-5" style="text-align: right; height: 300px; overflow-y: auto">
            <ul id="ks" class="nav nav-pills nav-justified"></ul>
          </div>
          <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align: left; height: 300px; overflow-y: auto">
            <ul id="dd" class="nav nav-pills nav-justified"></ul>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">
            关闭
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="itemIconModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true" style="margin-top: 15%">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">事项选择</h4>
        </div>
        <div class="row">
          <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align: right; height: 300px; overflow-y: auto">
            <ul id="sx1" class="nav nav-pills nav-justified"></ul>
          </div>
          <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align: left; height: 300px; overflow-y: auto">
            <ul id="sx2" class="nav nav-pills nav-justified"></ul>
          </div>
          <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align: left; height: 300px; overflow-y: auto">
            <ul id="sx3" class="nav nav-pills nav-justified"></ul>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">
            关闭
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="departIconModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true" style="margin-top: 15%">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">科室选择</h4>
        </div>
        <div class="row">
          <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"
            style="text-align: right; height: 300px; overflow-y: auto">
            <ul id="departX1" class="nav nav-pills nav-justified"></ul>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">
            关闭
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true" style="margin-top: 15%">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="addressTitle"></h4>
        </div>
        <div class="row">
          <ul id="address" class="nav nav-pills nav-justified" style="max-height: 300px; overflow-x: hidden">
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">
            关闭
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="itemIconModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true" style="margin-top: 15%">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">事项选择</h4>
        </div>
        <div class="row">
          <div class="col-xs-5 col-sm-5 col-md-5 col-lg-5" style="text-align: right; height: 300px; overflow-y: auto">
            <ul id="sx1" class="nav nav-pills nav-justified"></ul>
          </div>
          <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align: left; height: 300px; overflow-y: auto">
            <ul id="sx2" class="nav nav-pills nav-justified"></ul>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">
            关闭
          </button>
        </div>
      </div>
    </div>
  </div>
</body>
<script src="../../reference/bootstrap-3.3.5/js/jquery-2.1.4.js" type="text/javascript"></script>
<script src="../../reference/bootstrap-3.3.5/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../../reference/mui/js/mui.js"></script>
<script src="../../reference/loading/loaders.css.js" type="text/javascript"></script>
<script src="../../reference/mobiscroll-2.5.2/js/mobiscroll.custom-2.5.2.min.js" type="text/javascript"></script>
<script src="../../reference/mobiscroll-2.5.2/dev/js/mobiscroll.core-2.5.2-zh.js" type="text/javascript"></script>
<script src="../../reference/mobiscroll-2.5.2/dev/js/mobiscroll.datetime-2.5.1-zh.js" type="text/javascript"></script>
<script type="text/javascript" src="../../cordova.js"></script>
<script type="text/javascript">
  // localStorage.setItem("url","http://gzfetest1.yyhq365.cn/");
  var baseUrl = localStorage.getItem("url");
  var workNo = localStorage.getItem("workNo"); //工号
  //console.log(workNo,baseUrl);
  var deptCode = localStorage.getItem("deptCode"); //科室代码
  var sendUrl = baseUrl + "maintain";
  var telphone2 = localStorage.getItem("telphone2");
  var itemcheck = localStorage.getItem("itemcheck");
  var addressplaceName = localStorage.getItem("addressplaceName");
  var addressfloor = localStorage.getItem("addressfloor");
  var addressbuilding = localStorage.getItem("addressbuilding");
  var handLoseItem = localStorage.getItem("handLoseItem");
  /*console.log(telphone2);*/
  var testNumber = 0;
  var deviceCode = "",
    wgroupCode = "",
    roless = "";
  var str = "";
  str += telphone2;
  var _this = "";
  var roles = localStorage.getItem("role");
  var role = localStorage.getItem("role");
  var dataGroupCode = localStorage.getItem("dataGroupCode");
  var arrays = new Array();
  arrays = roles.split(",");
  //维修地点   楼层
  var reqSpotNum = "",
    buildingName = "",
    floorName = "",
    buildingName = "";
  var my_media; //语音
  var audioStatus = 0; //语音状态
  if (localStorage.getItem("jinJiFlag") == "Y") $(".wocaojINJI").show();
  else $(".wocaojINJI").hide();
  $(".chooseShixiang1 ul").css("max-height", $(window).height() - 160 + "px");
  var current_taskNo = GetQueryString("taskNo")
  // //角色
  // if (arrays.indexOf("stis_leader") >= 0) {
  //   roless = "stis_leader";
  // }
  // if (arrays.indexOf("ADMIN") >= 0) {
  //   roless = "ADMIN";
  // }
  // if (arrays.indexOf("MAINTAIN_WXY") >= 0) {
  //   roless = "MAINTAIN_WXY";
  // }
  // if (arrays.indexOf("MAINTAIN_WXZZ") >= 0) {
  //   roless = "MAINTAIN_WXZZ";
  // }
  // if (arrays.indexOf("MAINTAIN_DDZX") >= 0) {
  //   roless = "MAINTAIN_DDZX";
  //   /*$('#departParent').show();
  //                                                 $('#departHr').show();*/
  // }

  document.addEventListener("deviceready", onDeviceReady, false);

  function onDeviceReady() {
    console.log(navigator.camera);
  }

  //添加消息提示
  function showMsg(msg) {
    $("#warn small").html(msg);
    $("#warn").fadeIn(500);
    setTimeout('$("#warn").fadeOut(500)', 3000);
  }

  function drawImage(imageBase64) {
    var img = $('<img class="img-circle" style="width:100%;">');
    img.attr("src", "data:image/jpeg;base64," + imageBase64);
    var a = $('<a href="#" class="thumbnail"></a>');
    var div = $('<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4"></div>');
    img.appendTo(a);
    a.appendTo(div);
    div.appendTo("#picture");
    var width = $("a.thumbnail:parent").width();
    $("img.img-circle").css("height", width);

    $("a.thumbnail").click(function () {
      _this = $(this);
      $("#bigPicture").removeAttr("style");
      var image = new Image();
      image.src = $(this).find("img").attr("src");
      var width;
      var height;
      if (image.width >= image.height) {
        $("#bigPicture").css("width", screen.width - 40);
      } else {
        var i;
        height = screen.height - 200;
        i = image.height / height;
        width = image.width / i;
      }
      $("#bigPicture").css("width", width);
      $("#bigPicture").css("height", height);
      $("#bigPicture").attr("src", $(this).find("img").attr("src"));
      $("#myModal").modal("show");
      return false;
    });
  }
  // 初始化获取工单信息
  init();
  function init() {
    $("#loading").show();
    $.ajax({
      type: "post",
      url: baseUrl + "cleanService",
      headers: {
        methodName: "getTaskDetailInfo",
        serviceName: "AppLinkService"
      },
      data: {
        taskId: localStorage.getItem("current_taskId")
      },
      success: function (data) {
        $("#loading").hide();
        $("#taskNo").text(current_taskNo)
        $("#name").html(data.obj[0].reqStaffName)
        $("#phoneNum").val(data.obj[0].reqTelNum)
        $("#reqDeptName").html(data.obj[0].reqDeptName)
        $("#reqSpotName").val(data.obj[0].reqSpotName)
        $("#itemName").val(data.obj[0].itemName)
        $("#comments").val(data.obj[0].comments)
      }
    })
  }

  //获取当前页面携带参数信息
  function GetQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]); return null;
  }

  $("#back").click(function () {
    // getAddressInfo();
    location.href = "taskList.html";
  });

  //提交按钮
  $("#submit").click(function () {
    uploadAudio();
  });


  // 登记提交
  function ajaxTest(audioId) {
    var picList = [];
    $("#picture img").each(function (index, element) {
      var obj = {};
      obj.fileName = "over_work.jpg";
      obj.path = "";
      obj.base64 = getBase64Image(element);
      obj.type = "FS";
      picList.push(obj);
    });
    var param = {
      "workNo": workNo,
      "taskId": localStorage.getItem("current_taskId"),
      "itemCode": localStorage.getItem("current_itemCode"),
      "statusCode": "03",
      "picList": picList
    }
    $.ajax({
      url: baseUrl + "MobileAgentService",
      type: "post",
      headers: {
        methodName: "finishMethod",
        serviceName: "CSFS0101"
      },
      data: {
        prames: JSON.stringify(param)
      },
      success: function (data) {
        if (data.status == 0) {
          $("#upload").hide();
          mui.toast("完工成功!")
          setTimeout(function () {
            location.href = "./taskList.html"
          }, 1000)
        } else {
          $("#upload").hide();
          mui.toast(data.msg)
        }
      },
      complete: function (XMLHttpRequest, status) {
        //请求完成后最终执行参数
        if (status == "timeout") {
          $("#upload").hide();
          $("#warn small").html("提交超时！请检查网络并重试！");
          $("#warn").fadeIn(500);
          setTimeout("$('#warn').fadeOut(500)", 3000);
          $("#loading").hide();
          setTimeout("$('#warn').fadeOut(500)", 3000);
        } else if (status == "error") {
          $("#upload").hide();
          $("#warn small").html("网络异常！");
          $("#warn").fadeIn(500);
          setTimeout("$('#warn').fadeOut(500)", 3000);
          $("#loading").hide();
        }
      },
    });
  }
  //获取图片base64
  function getBase64Image(img) {
    var canvas = document.createElement("canvas");
    var image = new Image();
    image.src = img.src;
    var width;
    var height;
    width = 768;
    height = (image.height * 768) / image.width;
    canvas.width = width;
    canvas.height = height;
    var ctx = canvas.getContext("2d");
    ctx.drawImage(image, 0, 0, width, height);
    var dataURL = canvas.toDataURL("image/JPEG");
    //data:image/jpeg;base64,
    return dataURL.substring(23, dataURL.length);

    // return dataURL.replace("data:image/png;base64,", "");
  }


  $("#closeSpan").click(function () {
    $("#getAddByName").hide();
    $("#reqSpotName").val("");
    $("#closeSpan").hide();
  });

  $("#closeSpanss").click(function () {
    $("#getItemByName").hide();
    // $("#itemName").val("");
    $("#closeSpanss").hide();
  });


  //删除图片
  $("#delPic").click(function () {
    _this.parent().remove();
  });

  //拍摄照片
  $("#btnCamera").click(function () {
    if ($("#picture").find("img").length == 3) {
      $("#warn small").html("最多只能上传三张图片");
      $("#warn").fadeIn(500);
      setTimeout("$('#warn').fadeOut(500)", 3000);
      return;
    }
    //$('#myModal').modal('hide');
    navigator.camera.getPicture(onSuccess, onFail, {
      quality: 50,
      destinationType: Camera.DestinationType.FILE_URI,
      sourceType: Camera.PictureSourceType.CAMERA,
      allowEdit: false,
      encodingType: Camera.EncodingType.JPEG,
      popoverOptions: CameraPopoverOptions,
      saveToPhotoAlbum: false,
    });
  });

  function onSuccess(imageData) {
    var img = $('<img class="img-circle" style="width:100%;">');
    img.attr("src", imageData);
    var a = $('<a href="#" class="thumbnail"></a>');
    var div = $('<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4"></div>');
    img.appendTo(a);
    a.appendTo(div);
    div.appendTo("#picture");

    //$("a.thumbnail:parent").width();
    var width = $("a.thumbnail:parent").width();
    //$("a.thumbnail:parent").css('height',width);
    $("img.img-circle").css("height", width);
    $("a.thumbnail").click(function () {
      _this = $(this);
      $("#bigPicture").removeAttr("style");
      var image = new Image();
      image.src = $(this).find("img").attr("src");
      var width;
      var height;
      if (image.width >= image.height) {
        $("#bigPicture").css("width", screen.width - 40);
      } else {
        var i;
        height = screen.height - 200;
        i = image.height / height;
        width = image.width / i;
      }
      $("#bigPicture").css("width", width);
      $("#bigPicture").css("height", height);
      $("#bigPicture").attr("src", $(this).find("img").attr("src"));
      $("#myModal").modal("show");
      return false;
    });
  }

  function onFail(message) {
    //alert('Failed because: ' + message);
  }

  //本地上传
  $("#btnPicture").bind("touchstart", function () {
    if ($("#picture").find("img").length == 3) {
      $("#warn small").html("最多只能上传三张图片");
      $("#warn").fadeIn(500);
      setTimeout("$('#warn').fadeOut(500)", 3000);
      return;
    }
    navigator.camera.getPicture(
      function (data) {
        var img = $('<img class="img-circle" style="width:100%;">');
        img.attr("src", data);
        var a = $('<a class="thumbnail"></a>');
        a.attr("href", data);
        var div = $(
          '<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4"></div>'
        );
        img.appendTo(a);
        a.appendTo(div);
        div.appendTo("#picture");

        //alert($("a.thumbnail:parent").width());
        var width = $("a.thumbnail:parent").width();
        //$("a.thumbnail:parent").css('height',width);
        $("img.img-circle").css("height", width);

        $("a.thumbnail").click(function () {
          _this = $(this);
          $("#bigPicture").removeAttr("style");
          var image = new Image();
          image.src = $(this).find("img").attr("src");
          var width;
          var height;
          if (image.width >= image.height) {
            $("#bigPicture").css("width", screen.width - 40);
          } else {
            var i;
            height = screen.height - 200;
            i = image.height / height;
            width = image.width / i;
          }
          $("#bigPicture").css("width", width);
          $("#bigPicture").css("height", height);
          $("#bigPicture").attr("src", $(this).find("img").attr("src"));
          $("#myModal").modal("show");
          return false;
        });
      },
      function (error) {
        //console.log('Error');
      }, {
      destinationType: Camera.DestinationType.FILE_URI,
      sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
      allowEdit: false,
      mediaType: Camera.MediaType.PICTURE,
    }
    );
  });


  //录音
  // function audioCapture() {
  // 	navigator.device.capture.captureAudio(onSuccess, onError, { duration: 15 });
  // 	//录制成功
  // 	function onSuccess(mediaFiles) {
  // 		var i, path, len;
  // 		for(i = 0; i < mediaFiles.length; i++) {
  // 			path = mediaFiles[i].fullPath;
  // 			alert("文件名：" + mediaFiles[i].name + "\n" +
  // 				"localURL：" + mediaFiles[i].localURL + "\n\n" +
  // 				"fullPath：" + path
  // 			);
  // 		}
  // 	}
  // 	//录制失败
  // 	function onError(error) {
  // 		alert('录制失败！错误码：' + error.code);
  // 	}
  // }
  //设备档案
  $("#searchIn").bind("click", function () {
    $.ajax({
      url: baseUrl + "app_maintainController.do?getTaskDevice",
      type: "post",
      data: {
        deviceName: $("#shebei").val(),
        fixedPlace: $("#place").val(),
      },
      success: function (data) {
        var data = eval("(" + data + ")");
        var list = data.obj;
        var html = "";
        console.log(list);
        if (data.respCode == "200") {
          for (var i = 0; i < list.length; i++) {
            var deviceCode = list[i].deviceCode;
            var deviceName = list[i].deviceName;
            var fixedPlace = list[i].fixedPlace;
            html += deviceHtml(deviceCode, deviceName, fixedPlace);
          }
          $("#ddUl").html(html);
        }
      }, //子节点succes
    });
  });
  //HTML
  function deviceHtml(deviceCode, deviceName, fixedPlace) {
    //alert('12')
    var html = "";
    html +=
      '<li class="' +
      deviceCode +
      '" onclick="hideDevice(this)"><a href="#">' +
      deviceName +
      "</a></li>";
    return html;
  }
  //hide
  function hideDevice(src) {
    deviceCode = $(src).attr("class");
    $("#deviceSelect").val($(src).find("a").text());
    $("#myModalWaste").modal("toggle");
  }

  /**
   * 语音报修
   * @param  {[type]} ){                   } [description]
   * @return {[type]}     [description]
   */
  var filePath = "";
  $("#audioClick").click(function () {
    //开始录音（最长录制时间：15秒）
    navigator.device.capture.captureAudio(onSuccess, onError, {
      duration: 15,
    });

    //录制成功
    function onSuccess(mediaFiles) {
      audioStatus = 0;
      var i, path, len;
      //遍历获取录制的文件（iOS只支持一次录制一个视频或音频）
      // for (i = 0, len = mediaFiles.length; i < len; i += 1) {
      console.log(mediaFiles);
      path = mediaFiles[0].fullPath;
      filePath = path;
      $(".audio").show();
      $(".audio").css({
        display: "flex",
        "justify-content": "center",
      });
      // alert("录制成功！\n\n"
      //      + "文件名：" + mediaFiles[i].name + "\n"
      //      + "大小：" + mediaFiles[i].size + "\n\n"
      //      + "localURL地址：" + mediaFiles[i].localURL + "\n\n"
      //      + "fullPath地址：" + path);
      // }
    }

    //录制失败
    function onError(error) {
      // alert('录制失败！错误码：' + error.code);
    }
  });

  /**
   * 播放语音/重新播放
   * @return {[type]} [description]
   */
  $(".audio img").click(function () {
    if (audioStatus == 0) {
      my_media = new Media(
        filePath,
        function () {
          $(".audio img").attr("src", "img/play.png");
        },
        function (err) {
          // showMsg("语音错误");
          err = JSON.stringify(err)
          showMsg(err);
        },
        function (mediaStatus) {
          audioStatus = mediaStatus;
        }
      );
    }
    if ($(this).attr("src") == "img/play.png") {
      $(".audio img").attr("src", "img/stop.png");
      my_media.play();
    } else {
      $(".audio img").attr("src", "img/play.png");
      my_media.stop()
    }
  });
  /**
   * 上传语音
   * @return {[type]} [description]
   */
  function uploadAudio() {
    "`";
    // debugger
    $("#upload").show();
    if (filePath == "") {
      ajaxTest("");
      return;
    }
    var uri = encodeURI(baseUrl + "mtUploadAudio");
    var options = new FileUploadOptions();
    options.fileKey = "file";
    options.fileName = filePath.substr(filePath.lastIndexOf("/") + 1);
    options.mimeType = "text/plain";
    var headers = {
      headerParam: "headerValue",
    };
    options.headers = headers;
    var ft = new FileTransfer();
    // ft.onprogress = function(progressEvent) {
    //   if (progressEvent.lengthComputable) {
    //     $("#progress").html(progressEvent.loaded / progressEvent.total * 100);
    //     loadingStatus.setPercentage(progressEvent.loaded / progressEvent.total);
    //   } else {
    //     loadingStatus.increment();
    //   }
    // };
    // alert(JSON.stringify(options));
    ft.upload(filePath, uri, win, fail, options);
  }

  function win(r) {
    // alert("Code = " + r.responseCode);
    // alert("Response = " + r.response);
    // alert("Sent = " + r.bytesSent);
    var jsonData = JSON.stringify(r);
    // alert(jsonData)
    var result = $.parseJSON(jsonData);
    // var data = eval("(" + r.response + ")");
    // alert(result.response)
    if (result.responseCode != "200") {
      $("#upload").hide();
      showMsg("语音保存失败!");
    } else {
      ajaxTest(result.response);
    }
  }

  function fail(error) {
    $("#upload").hide();
    showMsg("语音上传失败，请联系系统相关人员");
    // alert("An error has occurred: Code = " + error.code);
    // alert("upload error source " + error.source);
    // alert("upload error target " + error.target);
  }
</script>

</html>