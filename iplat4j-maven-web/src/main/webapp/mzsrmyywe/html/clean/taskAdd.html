<!doctype html>
<html class="no-js">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="renderer" content="webkit">
    <!--   <meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'"> -->
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="../../reference/bootstrap-3.3.5/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../../reference/bootstrap-3.3.5/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="../../reference/loading/loaders.min.css">
    <link rel="stylesheet" href="../../reference/mobiscroll-2.5.2/css/mobiscroll.custom-2.5.2.min.css">
    <link rel="stylesheet" href="../../css/android-ios.css">
    <link rel="stylesheet" href="../../css/loading.css" />
    <link rel="stylesheet" href="../../reference/mui/css/mui.css" />
    <link rel="stylesheet" href="css/colorGreen.css">

</head>
<STYLE TYPE="text/css">
    body {
        background: #F1F1F1;
    }
    
    hr {
        margin-top: 0px;
        margin-bottom: 0px;
    }
    
    h3 {
        margin-top: 10px;
        margin-bottom: 10px;
    }
    
    .round {
        border: 1px solid #2aabd2;
        -moz-box-shadow: 3px 3px 4px #2aabd2;
        -webkit-box-shadow: 3px 3px 4px #2aabd2;
        box-shadow: 3px 3px 4px #2aabd2;
        width: 70%;
        height: 175px;
        position: absolute;
        overflow: scroll;
        overflow-x: hidden;
        background-color: #FFFFFF;
        border-radius: 3px;
    }
    
    .btn-sb {
        position: fixed;
        bottom: 0;
        width: 100%;
        background: #2aabd2;
        text-align: center;
        height: 50px;
        line-height: 50px;
        color: #fff;
        font-size: 18px;
    }
    
    .navbar {
        margin-bottom: 0px;
    }
    
    .nav>li>a {
        padding: 5px 5px;
    }
    
    h1 {
        margin: 0 0 0rem;
    }
    
    .row {
        margin-right: 0px;
        margin-left: 0px;
    }
    
    input[type='text'] {
        padding: 0 0;
        height: 21px;
        margin-bottom: 0px;
    }
    /*录音*/
    
    .audio {
        display: flex;
        justify-content: center;
        margin-top: 10px;
        display: none;
    }
    
    .audio img {
        width: 50px;
        height: 50px;
        opacity: 0.5;
    }
</STYLE>

<body>
    <div>
        <nav class="navbar navbar-fixed-top navbar-inverse nav-height">
            <div id="back" class="glyphicon-btn-left">
                <span class="glyphicon glyphicon-triangle-left userBtn" style="margin-left:1rem;"></span>
            </div>
            <div>
                <h1 class="title-right">任务新增</h1>
            </div>

        </nav>
    </div>
    <div id="warn" class="warn" hidden>
        <small></small>
    </div>

    <div id="loading" class="spinner" style="position:fixed;z-index:9999;text-align:center;width:100%;">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
    </div>

    <div id="upload" class="transparent" hidden>
        <div id="waiting" class="loader loading-position">
            <div class="loader-inner line-spin-fade-loader">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
        <div style="color:#fff;position:relative;width:100%;text-align:center;top:40%;">正在提交，请稍候...</div>

        <div id="succeed" class="result-window" hidden>
            <span class="glyphicon glyphicon-ok-circle" style="font-size:40px;color:#25F706;"></span>
            <span style="color:#25F706;">提交成功</span>
        </div>
        <div id="failed" class="result-window" hidden>
            <span class="glyphicon glyphicon-remove-circle" style="font-size:40px;color:#FF7C7C;"></span>
            <span style="color:#FF7C7C;">提交失败了</span>
        </div>
    </div>

    <div id="content" class="top50">
        <div style="width:100%;background:#fff;border:1px solid #eee;margin-bottom:0px;">
            <div class="row" style="margin-top:10px; " id="updateShow">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    工单号
                </div>
                <div id="taskNo" class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align:right;">

                </div>
            </div>
            <hr style="margin-top:10px;">

            <div class="row" style="margin-top:10px;">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    报修人
                </div>
                <div id="name" class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align:right;">

                </div>
            </div>
            <hr style="margin-top:10px;">

            <div class="row" style="margin-top:10px;">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    报修电话
                </div>
                <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align:right;">
                    <input id="phoneNum" style="border:none;outline:none;text-align:right;" placeholder="请输入报修电话" maxlength="11" onkeyup="this.value=this.value.replace(/\D/g,'')">
                </div>
            </div>
            <hr style="margin-top:10px;">

            <div class="row" style="margin-top:10px;" hidden="true">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    报修来源
                </div>
                <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align:right;color:#3EC521;">
                    请选择报修来源
                    <p id="repairSource" hidden>01</p>
                </div>

            </div>
            <div id="yang" class="row" style="margin-top:10px;" hidden="true">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 center">
                    <button type='button' value="01" id="butOne" class='status btn btn-sm  btn-info' style='width:70px;text-align:center;text-shadow: none;width:100%;'>医务报修</button>
                </div>
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 center">
                    <button type='button' value="02" id="butTwo" class='status btn btn-sm btn-default' style='width:70px;text-align:center;text-shadow: none;width:100%;'>班组自查</button>
                </div>
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 center">
                    <button type='button' value="03" id="butThree" class='status btn btn-sm btn-default' style='width:70px;text-align:center;text-shadow: none;width:100%;'>领导巡查</button>
                </div>
            </div>
            <div class="wocaojINJI">
                <hr style="margin-top:10px;">

                <div class="row">
                    <div class="col-xs-5 col-sm-5 col-md-5 col-lg-5 font-grey" style="padding-top: 10px">
                        任务是否紧急
                    </div>
                    <div id="YorN" class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align:right;display: flex;height: 40px">
                        <div class="mui-input-row mui-radio">
                            <label style="font-weight: normal">是</label>
                            <input name="radio1" type="radio" id="Y" style="top: 2px">
                        </div>
                        <div class="mui-input-row mui-radio">
                            <label style="font-weight: normal">否</label>
                            <input name="radio1" type="radio" id="N" style="top: 2px">
                        </div>
                    </div>
                </div>
            </div>

            <div class="row" style="margin-top:10px;">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    报修科室
                </div>
                <div id="reqDeptName" class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align:right;">

                </div>
            </div>
            <hr style="margin-top:10px;">

            <div class="row" style="margin-top:10px;">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    楼
                </div>
                <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align:right;">
                    <input type="text" id="building" style="border:none;outline:none;text-align:right;font-size:12px;width:100%;" placeholder="选择楼" readonly>
                </div>
                <div id="addIcon1" class="col-xs-1 col-sm-1 col-md-1 col-lg-1" style="padding:0px;">
                    <span class="glyphicon glyphicon-map-marker" style="color:#EF8915;"></span>
                </div>
            </div>
            <hr style="margin-top:10px;">

            <div class="row" style="margin-top:10px;">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    层
                </div>
                <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align:right;">
                    <input type="text" id="floor" style="border:none;outline:none;text-align:right;font-size:12px;width:100%;" placeholder="选择层" readonly>
                </div>
                <div id="addIcon2" class="col-xs-1 col-sm-1 col-md-1 col-lg-1" style="padding:0px;">
                    <span class="glyphicon glyphicon-map-marker" style="color:#EF8915;"></span>
                </div>
            </div>
            <hr style="margin-top:10px;">

            <div class="row" style="margin-top:10px;">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    地点
                </div>
                <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align:right;">
                    <input type="text" id="reqSpotName" style="border:none;outline:none;text-align:right;font-size:12px;width:100%;" placeholder="选择或输入查询地点">
                </div>
                <div id="addIcon3" class="col-xs-1 col-sm-1 col-md-1 col-lg-1" style="padding:0px;">
                    <span class="glyphicon glyphicon-map-marker" style="color:#EF8915;"></span>
                </div>
            </div>
            <hr style="margin-top:10px;">

            <div class="row" style="margin-top:10px;position: relative;">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    维修事项
                </div>
                <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align:right;">
                    <input type="text" id="itemName" style="border:none;outline:none;text-align:right;font-size:12px;width:100%;" placeholder="选择或输入维修事项" oninput="getItemByName(this.value)">
                    <p id="itemCode" hidden></p>
                </div>
                <div id="itemIcon" class="col-xs-1 col-sm-1 col-md-1 col-lg-1" style="padding:0px;">
                    <span class="glyphicon glyphicon-tags" style="color:#EF8915;"></span>
                </div>
                <div id="closeSpanss" style="position:absolute;z-index:200;top:42px;right:3px;width:55px;height:25px;text-align: center;" hidden>
                    关闭
                </div>
            </div>
            <hr style="margin-top:10px;">

            <div class="row" id="departParent" style="margin-top:10px;position: relative;" hidden>
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    维修科室
                </div>
                <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" id="departIcon" style="text-align:right;">
                    <input type="text" id="departName" style="border:none;outline:none;text-align:right;font-size:12px;width:100%;" placeholder="点击选择维修科室" readonly>
                    <p id="departCode" hidden></p>
                </div>
            </div>
            <hr id="departHr" style="margin-top:10px;" hidden>

            <div class="row" style="margin-top:10px;" hidden="true">
                <div class="col-xs-5 col-sm-5 col-md-5 col-lg-5 font-grey">
                    预约维修时间
                </div>
                <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align:right;">
                    <input id="reOrderTime" type="text" style="border:none;outline:none;text-align:right;font-size:12px;width:100%;" placeholder="选择预约维修时间">
                </div>
            </div>
            <hr style="margin-top:10px;" hidden="true">

            <!--<div class="row" style="margin-top:10px;">
        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
          设备档案
        </div>
        <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align:right;">
          <input id="deviceSelect" type="text" style="border:none;outline:none;text-align:right;font-size:12px;width:100%;" data-toggle="modal" 
   				data-target="#myModalWaste" placeholder="选择设备档案">
        </div>
        <p id="itemTypeCode" hidden></p>
      </div>
      <hr style="margin-top:10px;">-->
            <div class="row" style="margin-top:10px;">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    事项分类
                </div>
                <div id="itemTypeName" class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align:right;font-size:12px;line-height:20px;">
                </div>
                <p id="itemTypeCode" hidden></p>
            </div>
            <hr style="margin-top:10px;">
            <div class="row" style="margin-top:10px;">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    备注
                </div>
                <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align:right;">
                    <input type="text" id="comments" style="border:none;outline:none;text-align:right;font-size:12px;" placeholder="">
                </div>
            </div>
            <hr style="margin-top:10px;">


            <div class="row" style="margin-top:10px;">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey">
                    图片上传
                </div>
                <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align:right;">
                    <button type="button" id="btnPicture" class="btn btn-info btn-sm">本地上传</button>
                    <button type="button" id="btnCamera" class="btn btn-info btn-sm">相机拍摄</button>
                </div>
            </div>
            <hr style="margin-top:10px;">
            <div class="row" style="margin-top:10px;">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 font-grey">
                    图片
                </div>
            </div>
            <hr style="margin-top:10px;">
            <div class="row" style="margin-top:10px;">
                <div id="picture" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 row">
                </div>
            </div>
            <!-- <hr style="margin-top:10px;">  -->
            <div class="row" style="padding-bottom: 10px;">
                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 font-grey" style="line-height: 30px;">
                    录音
                </div>
                <div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="text-align:right;">
                    <button type="button" id="audioClick" class="btn btn-info btn-sm">录音</button>
                    <!-- <button type="button" class="btn btn-info btn-sm" onclick="audioCapture()">录音</button> -->
                </div>
            </div>
            <!-- <hr style="margin-top:10px;" > -->
            <div class="row" style="min-height:0px;margin-bottom:60px;">
                <div class="audio">
                    <img src="img/play.png">
                </div>
            </div>
            <!-- <div class="row" style="margin-top:10px;margin-bottom:70px;">
					<div id="luyin" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 row">

					</div>
				</div> -->
        </div>

        <button id="submit" type="button" class="btn btn-info btn-block" style="height:40px;border-radius:2px;position: fixed;bottom: 0px;">
            提交
        </button>

    </div>

    <!-- <div id="submit" class="btn-sb">
    提交
  </div> -->

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">
                        图片预览
                    </h4>
                </div>
                <div style="text-align:center;">
                    <img id="bigPicture">
                </div>
                <div class="modal-footer">
                    <button id="delPic" type="button" class="btn btn-danger btn-block" data-dismiss="modal">删除图片
                    </button>
                    <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">关闭
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!--报废原因-->
    <div class="modal fade" id="myModalWaste" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top:15%;">
        <div class="modal-dialog">
            <div class="modal-content" style="margin-top:100px;padding-top:15px;height:350px;overflow-y:auto;">
                <div class="modal-header" style="position:fixed;z-index:2000;background:#FFFFFF;TOP:0;">
                    <div class="row">
                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align:center">
                            <input id="shebei" type="text" style="width:130%;border:1px solid #D0D6D6;outline:none;text-align:center;height:30px;" placeholder="输入设备名称" />
                        </div>
                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align:left;">
                            <input id="place" type="text" style="width:130%;border:1px solid #D0D6D6;outline:none;text-align:center;height:30px;" placeholder="输入安装地点" />
                        </div>
                        <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align:left;">
                            <button id="searchIn" type="button" class="btn btn-sm" style="height:30px;width:100%;background:#43B6D8;color:#FFFFFF;">搜索</button>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-top:50px;">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="text-align:center;overflow-y:auto;">
                        <ul id="ddUl" class="nav nav-pills nav-justified">

                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="getItemByName" class="round" hidden>
        <ul class="nav nav-pills nav-justified getItemByName" style="clear:both;position: relative;padding-top: 20px;">
        </ul>
    </div>

    <div id="getAddByName" class="round" hidden>
        <ul class="nav nav-pills nav-justified getAddByName" style="clear:both;position: relative;padding-top: 20px;">
        </ul>
    </div>

    <div class="modal fade" id="addIconModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top:15%;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">
                        地点选择
                    </h4>
                </div>
                <div class="row">
                    <div class="col-xs-5 col-sm-5 col-md-5 col-lg-5" style="text-align:right;height:300px;overflow-y:auto;">
                        <ul id="ks" class="nav nav-pills nav-justified">

                        </ul>
                    </div>
                    <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align:left;height:300px;overflow-y:auto;">
                        <ul id="dd" class="nav nav-pills nav-justified">

                        </ul>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">
                        关闭
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="itemIconModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top:15%;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">
                        事项选择
                    </h4>
                </div>
                <div class="row">
                    <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align:right;height:300px;overflow-y:auto;">
                        <ul id="sx1" class="nav nav-pills nav-justified">

                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align:left;height:300px;overflow-y:auto;">
                        <ul id="sx2" class="nav nav-pills nav-justified">

                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="text-align:left;height:300px;overflow-y:auto;">
                        <ul id="sx3" class="nav nav-pills nav-justified">

                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">
                        关闭
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="departIconModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top:15%;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">
                        科室选择
                    </h4>
                </div>
                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="text-align:right;height:300px;overflow-y:auto;">
                        <ul id="departX1" class="nav nav-pills nav-justified">

                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">
                        关闭
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top:15%;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="addressTitle">

                    </h4>
                </div>
                <div class="row">
                    <ul id="address" class="nav nav-pills nav-justified" style="max-height:300px;overflow-x:hidden;">

                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">关闭
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="itemIconModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top:15%;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="myModalLabel">
                        事项选择
                    </h4>
                </div>
                <div class="row">
                    <div class="col-xs-5 col-sm-5 col-md-5 col-lg-5" style="text-align:right;height:300px;overflow-y:auto;">
                        <ul id="sx1" class="nav nav-pills nav-justified">

                        </ul>
                    </div>
                    <div class="col-xs-7 col-sm-7 col-md-7 col-lg-7" style="text-align:left;height:300px;overflow-y:auto;">
                        <ul id="sx2" class="nav nav-pills nav-justified">

                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary btn-block" data-dismiss="modal">关闭
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="../../reference/bootstrap-3.3.5/js/jquery-2.1.4.js" type="text/javascript"></script>
<script src="../../reference/bootstrap-3.3.5/js/bootstrap.min.js" type="text/javascript"></script>
<script src="../../reference/mui/js/mui.js"></script>
<script src="../../reference/loading/loaders.css.js" type="text/javascript"></script>
<script src="../../reference/mobiscroll-2.5.2/js/mobiscroll.custom-2.5.2.min.js" type="text/javascript"></script>
<script src="../../reference/mobiscroll-2.5.2/dev/js/mobiscroll.core-2.5.2-zh.js" type="text/javascript"></script>
<script src="../../reference/mobiscroll-2.5.2/dev/js/mobiscroll.datetime-2.5.1-zh.js" type="text/javascript"></script>
<script type="text/javascript" src="../../cordova.js"></script>
<script type="text/javascript">
    // localStorage.setItem("url","http://gzfetest1.yyhq365.cn/");
    var baseUrl = localStorage.getItem("url");
    var workNo = localStorage.getItem("workNo"); //工号
    //console.log(workNo,baseUrl);
    var deptCode = localStorage.getItem("deptCode"); //科室代码
    var sendUrl = baseUrl + "maintain";
    var telphone2 = localStorage.getItem("telphone2");
    var itemcheck = localStorage.getItem('itemcheck');
    var addressplaceName = localStorage.getItem('addressplaceName');
    var addressfloor = localStorage.getItem('addressfloor');
    var addressbuilding = localStorage.getItem('addressbuilding');
    /*console.log(telphone2);*/
    var testNumber = 0;
    var deviceCode = '',
        wgroupCode = '',
        roless = '';
    var str = '';
    str += telphone2;
    var _this = "";
    var roles = localStorage.getItem('role');
    var role = localStorage.getItem("role");
    var dataGroupCode = localStorage.getItem("dataGroupCode");
    var arrays = new Array();
    arrays = roles.split(',');
    //维修地点   楼层
    var reqSpotNum = "",
        buildingName = "",
        floorName = "",
        buildingName = "";
    if (localStorage.getItem("jinJiFlag") == "Y")
        $(".wocaojINJI").show();
    else
        $(".wocaojINJI").hide();
    $(".chooseShixiang1 ul").css("max-height", $(window).height() - 160 + "px")

    //角色
    if (arrays.indexOf('stis_leader') >= 0) {
        roless = 'stis_leader';
    }
    if (arrays.indexOf('ADMIN') >= 0) {
        roless = 'ADMIN';
    }
    if (arrays.indexOf('MAINTAIN_WXY') >= 0) {
        roless = 'MAINTAIN_WXY';
    }
    if (arrays.indexOf('MAINTAIN_WXZZ') >= 0) {
        roless = 'MAINTAIN_WXZZ';
    }
    if (arrays.indexOf('MAINTAIN_DDZX') >= 0) {
        roless = 'MAINTAIN_DDZX';
        /*$('#departParent').show();
        $('#departHr').show();*/
    }

    document.addEventListener("deviceready", onDeviceReady, false);

    function onDeviceReady() {
        console.log(navigator.camera);
    }

    $(function() {
            // if(addressplaceName == null){
            // 	addressplaceName = "";
            // }
            // if(addressfloor == null){
            // 	addressfloor = "";
            // }
            // if(addressbuilding == null){
            // 	addressbuilding = "";
            // }
            //默认带出的地点（如果是第一次，则为空；如果是第二次及以后，则是上一次的值）
            // if (addressplaceName != "" || addressfloor != "" || addressbuilding != "") {

            // 	console.log(addressplaceName);
            // 	$('#reqSpotName').val(addressplaceName);
            // 	$('#floor').val(addressfloor);
            // 	$('#building').val(addressbuilding);
            // } else {
            // $('#reqSpotName').val('');
            // $('#floor').val('');
            // $('#building').val('');
            var url = location.search;
            if (url != "") {
                init()
            } else {
                newInit();
            }

            // newInit();
            // }
        })
        //获取选择的地点名称
    function getAddressInfo() {
        placeName = $('#reqSpotName').val();
        floor = $('#floor').val();
        building = $('#building').val();
        localStorage.setItem("addressplaceName", placeName);
        localStorage.setItem("addressfloor", floor);
        localStorage.setItem("addressbuilding", building);
    }

    //任务修改页面
    function init() {
        var url = location.search;
        if (url != "") {
            $("#updateShow").show();
            $("#updateShow").next().show();
            testNumber = 1;
            sendUrl = baseUrl + "app_maintainController.do?updateTask";
            $('h1').html('任务修改');
            var taskNo = url.substring(1, url.length);
            $.ajax({
                url: baseUrl + 'app_maintainController.do?getTaskInfo',
                type: 'post',
                data: {
                    taskNo: taskNo
                },
                timeout: 30000,
                success: function(data) {
                    var data = eval("(" + data + ")");
                    console.log("www");
                    console.log(data);
                    deviceCode = data.obj.devNum;
                    var addressCode = data.obj.reqSpotNum;
                    var itemCode = data.obj.itemNum;
                    //console.log(data);
                    var source = data.obj.repairSource; //报修来源的value值
                    /*alert(source);*/
                    //判断报修来源颜色按钮
                    if (source == "02") {
                        $("#butOne").removeClass("btn-info");
                        $("#butOne").addClass("btn-default");
                        $("#butTwo").addClass("btn-info");
                    } else if (source == "03") {
                        $("#butOne").removeClass("btn-info");
                        $("#butOne").addClass("btn-default");
                        $("#butThree").addClass("btn-info");
                    }
                    buildingName = data.obj.building;
                    floorName = data.obj.floor;
                    reqSpotNum = data.obj.reqSpotNum;
                    $('#reOrderTime').val(data.obj.appoinTime.substring(0, 16)); //预约维修时间
                    $('#deviceSelect').val(data.obj.devName);
                    $("#taskNo").html(data.obj.taskNo);
                    $("#name").html(data.obj.name);
                    $("#reqDeptName").html(data.obj.reqDeptName)
                    $("#phoneNum").val(data.obj.reqTelNum); //报修电话          
                    $("#reqSpotName").val(data.obj.reqSpotName); //维修地点           
                    $('#repairSource').html(data.obj.repairSource); //报修来源
                    $("#reqSpotCode").html(data.obj.reqSpotNum);
                    $("#addTypeName").html(data.obj.addTypeName);
                    $("#addTypeCode").html(data.obj.addTypeNum);
                    $("#supportor").html(data.obj.supportor);
                    $("#supportorMobile").html(data.obj.supportorMobile);
                    $("#itemTypeName").html(data.obj.itemTypeName);
                    $("#itemTypeCode").html(data.obj.itemTypeNum);
                    $("#itemName").val(data.obj.itemName);
                    $("#itemCode").html(data.obj.itemNum);
                    $("#comments").val(data.obj.comments);
                    $('#YorN input[id=' + data.obj.impFlag + ']').attr("checked", "checked");

                    //获取地点的信息
                    $("#building").val(buildingName);
                    $("#floor").val(floorName);
                    if (data.pics.pic1 != "") {
                        drawImage(data.pics.pic1);
                    }
                    if (data.pics.pic2 != "") {
                        drawImage(data.pics.pic2);
                    }
                    if (data.pics.pic3 != "") {
                        drawImage(data.pics.pic3);
                    }
                    $("#loading").hide();
                },
                complete: function(XMLHttpRequest, status) { //请求完成后最终执行参数
                    if (status == 'timeout') {
                        $("#loading").hide();
                        $('#warn small').html('加载失败！');
                        $("#warn").fadeIn(500);
                        setTimeout("$('#warn').fadeOut(500)", 3000);
                    } else if (status == 'error') {
                        $("#loading").hide();
                        $('#warn small').html('网络异常！');
                        $("#warn").fadeIn(500);
                        setTimeout("$('#warn').fadeOut(500)", 3000);
                    }
                }
            });
        } else {
            $("#updateShow").hide();
            $.ajax({
                url: baseUrl + 'app_maintainController.do?getUserSpot',
                type: 'post',
                data: {
                    userName: workNo
                },
                success: function(data) {
                    $("#loading").hide();
                    var data = eval("(" + data + ")");
                    console.log(data);
                    if (data.respCode == "200") {
                        buildingCode = data.obj.building_code;
                        buildingName = data.obj.building_name;
                        floorName = data.obj.floor_name;
                        reqSpotNum = data.obj.spot_num;
                        reqSpotName = data.obj.spot_name;
                        //$('#building').val(data.obj.building_name);
                        //$('#floor').val(data.obj.floor_name);
                        //$('#reqSpotName').val(data.obj.spot_name);
                    } else {
                        $("warn small").html(data.respMsg);
                        $("#warn").fadeIn(500);
                        setTimeout('$("warn").fadeOut(500)', 3000);
                    }
                }
            });
            var telNum = localStorage.getItem("telPhone");
            if (telNum == null || telNum == "null") telNum = "";
            $("#phoneNum").val(telNum);
            $("#loading").hide();
        }
    }
    //添加消息提示
    function showMsg(msg) {
        $("#warn small").html(msg);
        $("#warn").fadeIn(500);
        setTimeout('$("#warn").fadeOut(500)', 3000);
    }

    function drawImage(imageBase64) {
        var img = $('<img class="img-circle" style="width:100%;">');
        img.attr('src', "data:image/jpeg;base64," + imageBase64);
        var a = $('<a href="#" class="thumbnail"></a>');
        var div = $('<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4"></div>');
        img.appendTo(a);
        a.appendTo(div);
        div.appendTo('#picture');
        var width = $("a.thumbnail:parent").width();
        $("img.img-circle").css('height', width);

        $('a.thumbnail').click(function() {
            _this = $(this);
            $("#bigPicture").removeAttr("style");
            var image = new Image();
            image.src = $(this).find('img').attr('src');
            var width;
            var height;
            if (image.width >= image.height) {
                $("#bigPicture").css("width", screen.width - 40);
            } else {
                var i;
                height = screen.height - 200;
                i = image.height / height;
                width = image.width / i;
            }
            $("#bigPicture").css("width", width);
            $("#bigPicture").css("height", height);
            $("#bigPicture").attr("src", $(this).find('img').attr('src'));
            $('#myModal').modal('show');
            return false;
        });

    }

    function newInit() {
        $("#updateShow").hide();
        $("#updateShow").next().hide();
        $('#name').html(localStorage.getItem("name"));

        $('#reqDeptName').html(localStorage.getItem("deptName"));
        var telNum = localStorage.getItem("telPhone");
        if (telNum == null || telNum == "null") telNum = "";
        $('#phoneNum').val(telNum);
        // $.ajax({
        //     type: "post",
        //     url: baseUrl + "MobileAgentService",
        // 	headers:{
        // 	"methodName":"getUserDefaultMsg",
        // 	"serviceName":"AppMaintainRegister"
        // 	},
        //     data: {
        //         userName: workNo
        //     },
        //     success: function(data) {
        $("#loading").hide();
        //         //var data = JSON.parse(data);
        //         console.log(data);
        //         var list = data.map.obj;
        //         if (data.respCode != 200) {
        //             mui.toast(data.respMsg);
        //             return;
        //         } else {
        //             addressplaceName = list[0].spot_name
        //             addressfloor = list[0].floor_name
        //             addressbuilding = list[0].building_name
        //             $("#building").val(addressbuilding);
        //             $("#floor").val(addressfloor);
        //             $("#reqSpotName").val(addressplaceName); //维修地点         
        //             $("#phoneNum").val(list[0].tel); //报修电话        
        //         }
        //     }
        // })
    }
    //初始化
    // $(function() {
    // init();
    // 	$('#name').html(localStorage.getItem("name"));
    // 	$('#reqDeptName').html(localStorage.getItem("deptName"));
    // 	$('#phoneNum').html(localStorage.getItem("telPhone"));

    // });

    $("#back").click(function() {
        getAddressInfo();
        location.href = "taskList.html";

    });

    //提交按钮
    $("#submit").click(function() {
        //判断
        if ($('#reqSpotName').val().trim() == "") {
            console.log("第二个" + reqSpotNum);
            $("#upload").hide();
            $('#warn small').html("维修地点不能为空！");
            $("#warn").fadeIn(500);
            setTimeout("$('#warn').fadeOut(500)", 3000);
            return false;
        }

        // <!-- if (testNumber == 1) { -->
        //     <!-- // ajaxTest(); -->
        //     <!-- uploadAudio(); -->
        // <!-- } else { -->
        //     <!-- //判断是否重复提交 -->
        //     <!-- $.ajax({ -->
        //         <!-- url: baseUrl + 'maintain', -->
        //         <!-- type: 'post', -->
        // 		<!-- headers:{ -->
        // 	<!-- "methodName":"taskRepeatCheck", -->
        // 	<!-- "className":"AppMaintainRegister" -->
        // 	<!-- }, -->
        //         <!-- data: { -->
        //             <!-- userName:workNo -->
        //         <!-- }, -->
        //         <!-- success: function(data) { -->

        //             <!-- //alert(2); -->
        //             <!-- var data = eval('(' + data + ')'); -->
        //             <!-- //console.log(data); -->
        //             <!-- if (data.respCode == "N") { -->
        //                 <!-- $("#warn").fadeIn(500); -->
        //                 <!-- $("#warn small").html("请勿重复报修！"); -->
        //                 <!-- setTimeout('$("#warn").fadeOut(500)', 1500); -->
        //                 <!-- return; -->
        //             <!-- } else { -->

        //                 <!-- // ajaxTest(); -->
        //                 <!-- uploadAudio(); -->
        //             <!-- } -->
        //         <!-- } -->
        //     <!-- }); -->
        // <!-- } -->
        uploadAudio();
        // ajaxTest()
    });

    //点击楼
    $("#addIcon1").click(function() {
        var prame = {
            dataGroupCode,
            role,
        };
        prame = JSON.stringify(prame);
        $("#addressTitle").html("楼");

        $.ajax({
            url: baseUrl + 'MobileAgentService',

            type: 'post',
            headers: {
                "methodName": "selectSpotBuildingName",
                "serviceName": "MTRE01"
            },
            data: {
                prames: prame
            },
            success: function(data) {
                //var data = eval("(" + data + ")");
                //console.log(data);
                var html = '',
                    list = data.blocks.building.rows;
                for (var i = 0; i < list.length; i++) {
                    html += "<li onclick='buildingClick(\"" + list[i].building + "\",\"" + list[i].building + "\",\"building\")'><a href='#'>" + list[i].building + "</a></li>";
                }
                $("#address").html(html);
                $('#addressModal').modal("show");
            }
        });
    });

    //点击地点点的时候查看楼是否选择

    // $("#addIcon1").click(function() {
    //     $("#addressTitle").html("楼");
    //     $.ajax({
    //         url: baseUrl + 'maintain',
    //         type: 'post',
    //         headers:{
    // 		"methodName":"getBuilding",
    // 		"className":"AppMaintainRegister"
    // 		},
    //         success: function(data) {
    //             //var data = eval("(" + data + ")");
    //             //console.log(data);
    //             var html = '',
    //                 list = data.map.obj;
    // 				console.log(list);
    //             for (var i = 0; i < list.length; i++) {
    //                 html += "<li onclick='buildingClick(\"" + list[i] + "\",\"" + list[i] + "\",\"building\")'><a href='#'>" + list[i] + "</a></li>";
    //             }
    //             $("#address").html(html);
    //             $('#addressModal').modal("show");
    //         }
    //     });
    // });

    $("#addIcon2").click(function() {
        buildingCode = $('#building').val()
        if (buildingCode == "") {
            showMsg("请先选择楼");
            return;
        }
        var prame = {
            building: buildingCode,
            dataGroupCode,
            role,
        };
        prame = JSON.stringify(prame);
        $("#addressTitle").html("层");
        // lxy
        $.ajax({
            url: baseUrl + 'MobileAgentService',
            type: 'post',
            headers: {
                "methodName": "selectSpotFloorName",
                "serviceName": "MTRE01"
            },
            data: {
                prames: prame
            },
            success: function(data) {
                //var data = eval("(" + data + ")");
                //	console.log(data);
                var html = '',
                    list = data.blocks.floor.rows;
                console.log(list);
                for (var i = 0; i < list.length; i++) {
                    html += "<li onclick='buildingClick(\"" + list[i].floor + "\",\"" + list[i].floor + "\",\"floor\")'><a href='#'>" + list[i].floor + "</a></li>";
                }
                $("#address").html(html);
                $('#addressModal').modal("show");
            }
        });
    });
    $("#addIcon3").click(function() {
        if (buildingCode == "") {
            showMsg("请先选择楼");
            return;

        }
        if (floorName == "") {
            showMsg("请先选择层");
            return;
        }
        var prame = {
            building: buildingCode,
            floor: floorName,
            dataGroupCode,
            role,
        };
        prame = JSON.stringify(prame);
        $("#addressTitle").html("地点");
        $.ajax({
            url: baseUrl + 'MobileAgentService',
            type: 'post',
            headers: {
                "methodName": "selectSpotRoomName",
                "serviceName": "MTRE01"
            },
            data: {
                prames: prame
            },
            // data: {
            //     deptNum: deptCode,
            //     building: buildingCode,
            //     floor: floorName
            // },
            success: function(data) {
                //var data = eval("(" + data + ")");
                //console.log(data);
                var html = '',
                    list = data.blocks.room.rows;
                console.log("点击地点");
                console.log(list);

                for (var i = 0; i < list.length; i++) {
                    html += "<li onclick='buildingClick(\"" + list[i].spotNum + "\",\"" + list[i].spotName + "\",\"place\",\"" + list[i].deptNum + "\",\"" + list[i].deptName + "\")'><a href='#'>" + list[i].spotName;
                    if (list[i].remark != " " && list[i].remark != null && list[i].remark != "null") {
                        html += " <span style='color:#777;'> ( 备注:" + list[i].remark + ") </span>";
                    }

                    html += "</a></li>";
                    //console.log(list[i].remark);
                }
                $("#address").html(html);
                $('#addressModal').modal("show");
            }
        });
    });

    //  点击楼层后的选项

    function buildingClick(code, name, type, deptCodes, deptNames) {
        if (type == "building") {
            buildingCode = code;
            buildingName = name;
            $("#building").val(name);
            floorName = "";
            $("#floor").val("");
            reqSpotNum = "";
            reqSpotName = "";
            $("#reqSpotName").val("");
            $("#addressModal").modal("hide");
        } else if (type == "floor") {
            floorName = name;
            $("#floor").val(name);
            reqSpotNum = "";
            reqSpotName = "";
            $("#reqSpotName").val("");
            $("#addressModal").modal("hide");
        } else if (type == "place") {

            if (deptCodes != null && deptCodes != "null" && deptCodes != "" && deptNames != null && deptNames != "null" && deptNames != "" && deptNames != "undefined") {
                $('#reqDeptName').html(deptName);
                deptCode = deptCodes
                    //deptCode = deptNum;
                    //deptCode = deptCodes;
            }
            reqSpotNum = code;
            reqSpotName = name;

            $("#reqSpotName").val(reqSpotName);

            $("#addressModal").modal("hide");
        }
        // console.log(code);
        // console.log(name);
        // console.log(type);
        // console.log(deptCodes);
        // console.log(deptNames);
    }
    // 登记提交
    function ajaxTest(audioId) {
        $("#upload").hide();
        if (localStorage.getItem("jinJiFlag") == "Y") {
            if ($('#YorN input:checked').attr('id') == undefined) {
                $("#warn").fadeIn(500);
                $("#warn small").html("请判断任务是否紧急！");
                setTimeout('$("#warn").fadeOut(500)', 1500);
                return;
            }
        }
        // if(str.indexOf($("#phoneNum").val().length) == -1) {
        // 	$("#warn").fadeIn(500);
        // 	$("#warn small").html("报修电话有误");
        // 	setTimeout('$("#warn").fadeOut(500)', 1500);
        // 	return;
        // }
        if ($("#phoneNum").val().length == 1) {
            $("#warn").fadeIn(500);
            $("#warn small").html("报修电话有误");
            setTimeout('$("#warn").fadeOut(500)', 1500);
            return;
        }
        // if ($('#comments').val() == '') {
        //     $("#warn").fadeIn(500);
        //     $("#warn small").html("请填写维修描述！");
        //     setTimeout('$("#warn").fadeOut(500)', 1500);
        //     return;
        // }
        // if($('#itemName').val() == '' && $('#comments').val() == '') {
        // 	$("#warn").fadeIn(500);
        // 	$("#warn small").html("维修事项和备注至少选填一项！");
        // 	setTimeout('$("#warn").fadeOut(500)', 1500);
        // 	return;
        // }
        $("#upload").show();
        //显示出来数据
        var reqSpotName = $('#reqSpotName').val(); // 维修地点 
        var repairSource = $('#repairSource').text(); //报修来源
        var phoneNum = $('#phoneNum').val(); //报修电话文本框
        //var reqSpotNum = $('#reqSpotCode').text();
        var reqDeptName = $('#reqDeptName').html(); //报修科室
        var reqStaffName = $('#name').html(); //报修人员
        var itemNum = $('#itemCode').text();
        var itemTypeNum = $('#itemTypeCode').text();
        var comments = $('#comments').val();
        var itemName = $('#itemName').val();
        var taskNo = $('#taskNo').text();
        var appoinTime = $("#reOrderTime").val();
        var itemTypeName = $('#itemTypeName').html()

        //alert(itemNum);
        // 报修电话
        if (phoneNum == "" || phoneNum.length == 0) {
            $("#upload").hide();
            $('#warn small').html("报修电话不能为空！");
            $("#warn").fadeIn(500);
            setTimeout("$('#warn').fadeOut(500)", 3000);
            return false;
        } else {
            if (phoneNum.length == 11 && phoneNum.substring(1, 10)) {
                //修改接口和修改本地存储(修改电话号码)  
                // $.ajax({
                //     url: baseUrl + 'app_maintainController.do?modifyPhoneNo',
                //     type: 'post',
                //     data: {
                //         workNo: workNo,
                //         newNo: phoneNum
                //     },
                //     success: function(data) {
                //         var data = eval("(" + data + ")");
                //         if (data.respCode == "200") {
                //             localStorage.setItem("telPhone", phoneNum); //电话号码上传到服务器               
                //         } else {
                //             $("#upload").hide();
                //             $('#warn small').html(data.respMsg);
                //             $("#warn").fadeIn(500);
                //             setTimeout("$('#warn').fadeOut(500)", 3000);
                //             return;
                //         }
                //     }
                // });
            }
        }

        if (itemNum == "") {
            $("#upload").hide();
            $('#warn small').html("维修事项不能为空！");
            $("#warn").fadeIn(500);
            setTimeout("$('#warn').fadeOut(500)", 3000);
            return false;
        }
        /*if (itemTypeNum == "") {
          $("#upload").hide();
          $('#warn small').html("系统错误，请联系管理员");
          $("#warn").fadeIn(500);
          setTimeout("$('#warn').fadeOut(500)",3000);
          return false;
        }*/

        var dataGroupCode = localStorage.getItem("dataGroupCode");
        var name = localStorage.getItem("name");
        // var obj = new Array();
        // var pic1 = "";
        // var pic2 = "";
        // var pic3 = "";
        // $("#picture img").each(function(index, element) {
        //     if (index == 0) {
        //         pic1 = getBase64Image(element);
        //     } else if (index == 1) {
        //         pic2 = getBase64Image(element);
        //     } else {
        //         pic3 = getBase64Image(element);
        //     }
        // });
        var picList = [];
        $("#picture img").each(function(index, element) {
            var obj = {};
            obj.fileName = '1.jpg';
            obj.path = '';
            obj.base64 = getBase64Image(element);
            obj.type = 'RE';
            picList.push(obj)
        });
        //传到后台的数据 

        var jsonbak = {
            dataGroupCode,
            role,
            // lxy
            "reqStaffName": reqStaffName, //报修人员
            "workNo": workNo, //报修人员
            "statusCode": "01", //状态
            "reqTelNum": phoneNum, //报修电话
            "reqStaffId": workNo, //（报修人工号）当前登录人工号
            "reqDeptName": reqDeptName, //报修科室
            "reqDeptNum": deptCode, //报修科室编码
            "itemTypeName": itemTypeName, //事项分类名称,
            "itemTypeNum": itemTypeNum, //事项分类编码,
            "itemNum": itemNum, //事项编码,
            "itemName": itemName, //新增维修事项手写内容
            "reqSpotNum": reqSpotNum, //维修地点编码
            "reqSpotName": $("#building").val() + '-' + $("#floor").val() + '-' + reqSpotName, //维修地点 
            "impFlag": $('#YorN input:checked').attr('id'), //是否紧急
            "comments": comments, //备注
            // "reqDeptName": $('#reqDeptName').html(),
            "building": $("#building").val(),
            "floor": $("#floor").val(),
            // 'deviceCode': deviceCode,
            // "reqDeptNum": deptCode,
            // "repairSource": repairSource, //报修来源
            // // "itemName": $('#itemName').val(),  //新增维修事项手写内容
            // "wgroupCode": wgroupCode,
            // 'appoinTime': appoinTime,
            "audioId": audioId,
            "picList": picList
        };

        var prame = JSON.stringify(jsonbak);
        // var picsbak = {
        //     "pic1": pic1,
        //     "pic2": pic2,
        //     "pic3": pic3
        // };
        // var pics = JSON.stringify(picsbak);
        // return
        $.ajax({
            url: baseUrl + 'MobileAgentService',
            type: 'post',
            headers: {
                "methodName": "insert",
                "serviceName": "MTRE0101"
            },
            data: {
                prames: prame,
            },
            // data: {
            //     taskNo: taskNo,
            // 	groupCode:dataGroupCode,
            // 	name:name,
            //     json: json,
            //     pics: pics
            // },
            timeout: 30000,
            success: function(data) {

                $("#loading").hide();
                //var data = JSON.parse(data);
                if (data.status != '-1') {
                    $("#waiting").hide();
                    $("#succeed").fadeIn(1000);
                    setTimeout("location.href='taskList.html';", 2000);
                } else {
                    $("#upload").hide();
                    $('#warn small').html(data.respMsg);
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);
                    $("#loading").hide();
                }
            },
            complete: function(XMLHttpRequest, status) { //请求完成后最终执行参数
                if (status == 'timeout') {
                    $("#upload").hide();
                    $('#warn small').html('提交超时！请检查网络并重试！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);
                    $("#loading").hide();
                    setTimeout("$('#warn').fadeOut(500)", 3000);
                } else if (status == 'error') {
                    $("#upload").hide();
                    $('#warn small').html('网络异常！');
                    $("#warn").fadeIn(500);
                    setTimeout("$('#warn').fadeOut(500)", 3000);
                    $("#loading").hide();
                }
            }
        });

    }
    //获取图片base64
    function getBase64Image(img) {
        var canvas = document.createElement("canvas");
        var image = new Image();
        image.src = img.src;
        var width;
        var height;
        width = 768;
        height = image.height * 768 / image.width;
        canvas.width = width;
        canvas.height = height;
        var ctx = canvas.getContext("2d");
        ctx.drawImage(image, 0, 0, width, height);
        var dataURL = canvas.toDataURL("image/JPEG");
        //data:image/jpeg;base64,
        return dataURL.substring(23, dataURL.length)

        // return dataURL.replace("data:image/png;base64,", "");
    }

    //维修地点
    function getAddByName(value) {
        if (value == '') {
            $('#reqDeptName').html(localStorage.getItem("deptName"));
        }
        $.ajax({
            url: baseUrl + 'app_maintainController.do?getPlaceByName',
            //url:'http://module.yyhq365.cn/app_maintainController.do?getPlaceByName',
            type: 'post',
            data: {
                placeName: value
            },
            success: function(data) {
                var data = eval("(" + data + ")");
                if (data.respCode == "200") {
                    $("#getAddByName").css("right", 0);
                    $("#getAddByName").css("top", $("#reqSpotName").offset().top + 35);
                    $('#closeSpan').show();
                    var list = new Array();
                    list = data.obj;
                    var liList = "";
                    for (var i = 0; i < list.length; i++) {
                        liList += "<li id='" + list[i].addressCode + "' deptNum='" + list[i].deptNum + "' deptName='" + list[i].deptName + "'><a href='#'>" + list[i].addressName + "</a></li>"
                    }
                    $("ul.getAddByName").html(liList);
                    $("#getAddByName").show();

                    $("ul.getAddByName li").click(function() {
                        var deptName = $(this).attr('deptName');
                        var deptNum = $(this).attr('deptNum');
                        $('#reqSpotCode').html($(this).attr("id"));
                        $('#reqSpotName').val($(this).find("a").text());

                        if (deptName != null && deptNum != "null") {
                            $('#reqDeptName').html(deptName);
                            deptCode = deptNum;
                        }
                        $("#getAddByName").hide();
                        $('#closeSpan').hide();
                    });
                    $('#reqSpotName').focus(function() {
                        if ($(this).val() != '') {
                            $("#getAddByName").show();
                        }
                    })
                } else {
                    $("#addTypeName").html("");
                    $("#reqSpotTypeCode").html("");
                    $("#getAddByName").hide();
                    $('#closeSpan').hide();
                }
            },
            error: function(data) {}
        });
    }

    $('#closeSpan').click(function() {
        $('#getAddByName').hide();
        $('#reqSpotName').val('');
        $('#closeSpan').hide();
    })

    $('#closeSpanss').click(function() {
            $('#getItemByName').hide();
            $('#itemName').val('');
            $('#closeSpanss').hide();
        })
        //维修事项
    function getItemByName(value) {
        var itemName = value;
        var prame = {
            itemName,
        };
        prame = JSON.stringify(prame);
        console.log(prame)
        $.ajax({
            // url: baseUrl + 'app_maintainController.do?getItemByName',
            // //url:'http://module.yyhq365.cn/app_maintainController.do?getItemByName',
            // type: 'post',
            // data: {
            //     itemName: value
            // },
            url: baseUrl + 'MobileAgentService',
            headers: {
                "methodName": "selectItemNames",
                "serviceName": "MTSX02"
            },
            type: 'post',
            data: {
                prames: prame
            },
            success: function(data) {
                //alert(data);        
                // var data = eval("(" + data + ")");
                console.log(data);

                if (data.status >= 0) {
                    $("#getItemByName").css("right", 0);
                    $("#getItemByName").css("top", $("#itemName").offset().top + 35);
                    $('#closeSpanss').show();
                    var list = new Array();
                    list = data.blocks.itemName.rows;
                    var liList = "";
                    for (var i = 0; i < list.length; i++) {
                        liList += "<li id='" + list[i].itemTypeNum + "' value='" + list[i].itemTypeName + "'><a id='" + list[i].itemNum + "' href='#'>" + list[i].itemName + "</a></li>"
                    }
                    $("ul.getItemByName").html(liList);
                    $("#getItemByName").show();
                    $("ul.getItemByName li").click(function() {
                        /*alert('123');*/
                        $('#itemCode').html($(this).find("a").attr("id"));
                        $('#itemName').val($(this).find("a").text());
                        $('#itemTypeName').html($(this).attr("value"));
                        $('#itemTypeCode').html($(this).attr("id"));
                        $("#getItemByName").hide();
                        $('#closeSpanss').hide();

                    });
                    $('#itemName').focus(function() {
                            if ($(this).val() != '') {
                                $("#getItemByName").show();
                            }
                        })
                        /*alert('4567890');*/
                } else {
                    $("#itemTypeName").html("");
                    $("#itemTypeCode").html("");
                    $("#getItemByName").hide();
                    $('#closeSpanss').hide();
                }
            },
            error: function(data) {}
        });
    }

    //删除图片
    $("#delPic").click(function() {
        _this.parent().remove();
    });

    //地点模态框
    $("#addIcon").click(function() {
        $('#warn').fadeOut(500);
        $('#addIconModal').modal('show');
        //加载地点
        $.ajax({
            url: baseUrl + 'app_maintainController.do?getAddress',
            type: 'post',
            success: function(data) {
                    var firstLi = "";
                    var data = eval("(" + data + ")");
                    var list = new Array();
                    list = data.obj;
                    for (var i = 0; i < list.length; i++) {
                        firstLi += "<li value='" + list[i].addressCode + "'><a href='#'>" + list[i].addressName + "</a></li>"
                    }
                    $('#ks').html(firstLi);

                    //console.log(data);

                    $("#ks li").click(function() {
                        var addressCode = $(this).attr('value');
                        //alert(addressCode);
                        //获取子节点
                        $.ajax({
                            url: baseUrl + 'app_maintainController.do?getAddress',
                            type: 'post',
                            data: {
                                deptCode: addressCode
                            },
                            success: function(databak) {
                                    var secLi = "";
                                    var databak = eval("(" + databak + ")");
                                    var listbak = new Array();
                                    listbak = databak.obj;
                                    //console.log(listbak);

                                    for (var i = 0; i < listbak.length; i++) {
                                        secLi += "<li value='" + listbak[i].addressCode + "' deptName='" + listbak[i].deptName + "' deptNum='" + listbak[i].deptNum + "'><a href='#'>" + listbak[i].addressName + "</a></li>";
                                    }

                                    $('#dd').html(secLi);

                                    //子节点点击事件
                                    $("#dd li").click(function() {
                                        var addressCode = $(this).attr('value');
                                        var addressName = $(this).find('a').text();
                                        var deptName = $(this).attr('deptName');
                                        var deptNum = $(this).attr('deptNum');
                                        $('#reqSpotName').val(addressName);
                                        $('#reqSpotCode').html(addressCode);
                                        if (deptName != null && deptNum != null) {
                                            $('#reqDeptName').html(deptName);
                                            deptCode = deptNum;
                                        }
                                        $('#addIconModal').modal('hide');
                                    });

                                } //子节点success
                        }); //获取子节点
                    });
                } //加载地点success
        }); //加载地点

        //默认子节点
        $.ajax({
            url: baseUrl + 'app_maintainController.do?getAddress',
            type: 'post',
            data: {
                deptCode: deptCode
            },
            success: function(databak) {
                    var secLi = "";
                    var databak = eval("(" + databak + ")");
                    var listbak = new Array();
                    listbak = databak.obj;
                    for (var i = 0; i < listbak.length; i++) {
                        secLi += "<li value='" + listbak[i].addressCode + "'><a href='#'>" + listbak[i].addressName + "</a></li>"
                    }
                    $('#dd').html(secLi);

                    //子节点点击事件
                    $("#dd li").click(function() {
                        var addressCode = $(this).attr('value');
                        var addressName = $(this).find('a').text();
                        $('#reqSpotName').val(addressName);
                        $('#reqSpotCode').html(addressCode);
                        $('#addIconModal').modal('hide');
                    });
                } //子节点success
        }); //默认子节点

        return false;
    });

    //事项分类模态框
    $("#itemIcon").click(function() {
        $('#warn').fadeOut(500)
        $('#itemIconModal').modal('show');
        console.log("sds")
        var prame = {
            parentId: 'root',
            dataGroupCode,
            role,
        };
        prame = JSON.stringify(prame);
        $.ajax({
            url: baseUrl + 'MobileAgentService',
            headers: {
                "methodName": "selectItemTypeNames",
                "serviceName": "MTSX01"
            },
            type: 'post',
            data: {
                prames: prame
            },
            success: function(data) {
                    var firstLi = "";
                    //var data = JSON.parse(data);
                    var list = new Array();
                    console.log(data)
                    list = data.blocks.itemTypeName.rows;
                    console.log(list)
                    for (var i = 0; i < list.length; i++) {

                        firstLi += "<li value='" + list[i].id + "'><a value='" + list[i].itemTypeNum + "' href='#'>" + list[i].itemTypeName + "</a></li>"
                    }
                    $('#sx1').html(firstLi);


                    $("#sx1 li").click(function() {
                        $('#sx3').html('');
                        var itemNameP = $(this).find('a').text();
                        var itemCodeP = $(this).find('a').attr('value');
                        var itemTypeNum = $(this).attr('value');
                        // console.log(itemNameP, itemCodeP, itemTypeNum)
                        console.log(itemNameP == "科室常用分类")
                            // $('#sx3').hide();
                            // 科室常用分类子节点
                            // if (itemNameP == "科室常用分类") {
                        var prame = {
                            parentId: itemTypeNum,
                            dataGroupCode,
                            role,
                        };
                        prame = JSON.stringify(prame);
                        $.ajax({
                                url: baseUrl + 'MobileAgentService',
                                // data: {
                                //     deptNum: deptCode
                                // },
                                data: {
                                    prames: prame
                                },
                                headers: {
                                    // "methodName": "selectItemNames",
                                    "methodName": "selectItemTypeNames",
                                    "serviceName": "MTSX01"
                                },
                                type: 'post',
                                success: function(data) {
                                    // var data = JSON.parse(data);
                                    // console.log(data);
                                    var list = data.blocks.itemTypeName.rows;
                                    var html = ""
                                    console.log(list)
                                    if (list.length > 0) {
                                        for (var i = 0; i < list.length; i++) {
                                            // html += "<li ><a value='" + list[i].itemNum + "' href='#'>" + list[i].itemName + "</a></li>"
                                            html += "<li value='" + list[i].id + "'><a value='" + list[i].itemTypeNum + "' href='#'>" + list[i].itemTypeName + "</a></li>"
                                        }
                                        $('#sx2').html(html);
                                        $("#sx2 li").click(function() {

                                            // itemCode = $(this).find('a').attr('value');
                                            // itemTypeNum = itemCode;
                                            // itemName = $(this).find('a').text();
                                            // $('#itemCode').html(itemCode);
                                            // $('#itemName').val(itemName);
                                            // $('#itemTypeName').html(itemNameP);
                                            // $('#itemTypeCode').html(itemCodeP);
                                            // $('#itemIconModal').modal('hide');
                                            var itemNameP = $(this).find('a').text();
                                            var itemCodeP = $(this).find('a').attr('value');
                                            var itemTypeNum = $(this).attr('value');
                                            console.log('uu', itemNameP, itemCodeP, itemTypeNum)
                                            var prame = {
                                                itemTypeNum: itemCodeP,
                                                dataGroupCode,
                                                role,
                                            };
                                            prame = JSON.stringify(prame);
                                            $.ajax({
                                                url: baseUrl + 'MobileAgentService',
                                                // data: {
                                                //     deptNum: deptCode
                                                // },
                                                data: {
                                                    prames: prame
                                                },
                                                headers: {
                                                    "methodName": "selectItemNames",
                                                    "serviceName": "MTSX02"
                                                },
                                                type: 'post',
                                                success: function(data) {
                                                    // var data = JSON.parse(data);
                                                    // console.log(data);
                                                    $('#sx3').html('');
                                                    var list = data.blocks.itemName.rows;
                                                    var html = ""
                                                    console.log(list)
                                                    if (list.length > 0) {
                                                        for (var i = 0; i < list.length; i++) {
                                                            html += "<li ><a value='" + list[i].itemNum + "' href='#'>" + list[i].itemName + "</a></li>"
                                                        }
                                                        $('#sx3').html(html);
                                                        $("#sx3 li").click(function() {

                                                            itemCode = $(this).find('a').attr('value');
                                                            itemTypeNum = itemCode;
                                                            itemName = $(this).find('a').text();
                                                            $('#itemCode').html(itemCode);
                                                            $('#itemName').val(itemName);
                                                            $('#itemTypeName').html(itemNameP);
                                                            $('#itemTypeCode').html(itemCodeP);
                                                            $('#itemIconModal').modal('hide');
                                                        })
                                                    } else {
                                                        $('#itemCode').html(itemCodeP);
                                                        $('#itemName').val(itemNameP);
                                                        $('#itemTypeName').html(itemNameP);
                                                        $('#itemTypeCode').html(itemCodeP);
                                                        $('#itemIconModal').modal('hide');
                                                    }

                                                }
                                            })
                                        })
                                    } else {

                                        $('#itemCode').html(itemCodeP);
                                        $('#itemName').val(itemNameP);
                                        $('#itemTypeName').html(itemNameP);
                                        $('#itemTypeCode').html(itemCodeP);
                                        $('#itemIconModal').modal('hide');
                                    }

                                }
                            })
                            //             } else {
                            //                 //获取子节点
                            //                 $.ajax({
                            //                    headers:{
                            // "methodName":"getSecondRootItem",
                            // "className":"AppMaintainRegister"
                            // },
                            // url: baseUrl + 'maintain',
                            //                     type: 'post',
                            //                     data: {
                            //                         itemTypeNum: itemTypeNum
                            //                     },
                            //                     success: function(databak) {
                            //                             var secLi = "";
                            //                             //var databak = JSON.parse(databak);
                            //                             var listbak = new Array();
                            //                             listbak = databak.map.obj;
                            //                             for (var i = 0; i < listbak.length; i++) {
                            //                                 secLi += "<li value='" + listbak[i].id + "'><a value='" + listbak[i].itemCode + "' href='#'>" + listbak[i].itemName + "</a></li>"
                            //                             }
                            //                             $('#sx2').html(secLi);
                            //                             // $('#sx3').hide();
                            //                             //子节点点击事件
                            //                             // $("#sx2 li").click(function () {
                            //                             // 	itemCode = $(this).attr('value');
                            //                             // 	itemName = $(this).find('a').text();
                            //                             // 	$('#itemCode').html(itemCode);
                            //                             // 	$('#itemName').val(itemName);
                            //                             // 	$('#itemTypeName').html(itemNameP);
                            //                             // 	$('#itemTypeCode').html(itemCodeP);
                            //                             // 	$('#itemIconModal').modal('hide');
                            //                             // });
                            //                             if (listbak.length > 0) {
                            //                                 $("#sx2 li").click(function() {
                            //                                     itemCode = $(this).find('a').attr('value');
                            //                                     itemTypeNum = itemCode;
                            //                                     itemName = $(this).find('a').text();
                            //                                     var itemID = $(this).attr("value");
                            //                                     $('#sx3').show();
                            //                                     //获取子节点
                            //                                     $.ajax({
                            //                                         headers:{
                            // "methodName":"getLastRootItem",
                            // "className":"AppMaintainRegister"
                            // },
                            // url: baseUrl + 'maintain',
                            //                                         type: 'post',
                            //                                         data: {
                            //                                             itemTypeNum: itemID
                            //                                         },
                            //                                         success: function(data) {
                            //                                                 var secLi2 = "";
                            //                                                 //var data = JSON.parse(data);
                            //                                                 var listbak2 = new Array();

                        //                                                 listbak2 = data.map.obj;
                        // 												console.log(listbak2);
                        //                                                 for (var i = 0; i < listbak2.length; i++) {
                        //                                                     secLi2 += "<li value='" + listbak2[i].itemCode + "'><a href='#'>" + listbak2[i].itemName + "</a></li>"
                        //                                                 }
                        //                                                 $('#sx3').html(secLi2);

                        //                                                 //子节点点击事件
                        //                                                 if (listbak2.length > 0) {
                        //                                                     $("#sx3 li").click(function() {
                        //                                                         itemCode2 = $(this).attr('value');
                        //                                                         itemName2 = $(this).find('a').text();
                        //                                                         $('#itemCode').html(itemCode2);
                        //                                                         $('#itemName').val(itemName2);
                        //                                                         $('#itemTypeName').html(itemName);
                        //                                                         $('#itemTypeCode').html(itemCode);
                        //                                                         $('#itemIconModal').modal('hide');
                        //                                                     });
                        //                                                 } else {
                        //                                                     $('#itemCode').html(itemCode);
                        //                                                     $('#itemName').val(itemName);
                        //                                                     $('#itemTypeName').html(itemNameP);
                        //                                                     $('#itemTypeCode').html(itemCodeP);
                        //                                                     $('#itemIconModal').modal('hide');

                        //                                                 }

                        //                                             } //子节点success
                        //                                     }); //获取子节点
                        //                                 });
                        //                             } else {

                        //                                 $('#itemCode').html(itemCodeP);
                        //                                 $('#itemName').val(itemNameP);
                        //                                 $('#itemTypeName').html(itemNameP);
                        //                                 $('#itemTypeCode').html(itemCodeP);
                        //                                 $('#itemIconModal').modal('hide');

                        //                             }

                        //                         } //子节点success
                        //                 }); //获取子节点
                        //             }


                    });

                } //加载类别success
        }); //加载类别

        return false;
    });

    //事项分类模态框
    $("#departIcon").click(function() {
        $('#warn').fadeOut(500);
        $('#departIconModal').modal('show');
        $.ajax({
            url: baseUrl + 'app_maintainController.do?getWgroupCode',
            type: 'GET',
            success: function(data) {
                var departHtml = '';
                var data = eval('(' + data + ')');
                var listDepart = new Array();
                listDepart = data.obj;
                //console.log(listDepart);

                for (var i = 0; i < listDepart.length; i++) {
                    departHtml += "<li value='" + listDepart[i].dept_num + "'><a href='#'>" + listDepart[i].dept_name + "</a></li>"
                }
                $('#departX1').html(departHtml);
                $('#departX1').on('click', 'li', function(e) {
                    wgroupCode = $(this).attr('value');
                    var depatName = $(this).find('a').text();
                    //$('#departName').val(depatName);
                    $('#departIconModal').modal('hide');
                })
            }
        });
    });

    //拍摄照片
    $("#btnCamera").click(function() {
        if ($("#picture").find("img").length == 3) {
            $("#warn small").html("最多只能上传三张图片");
            $("#warn").fadeIn(500);
            setTimeout("$('#warn').fadeOut(500)", 3000);
            return;
        };
        //$('#myModal').modal('hide');
        navigator.camera.getPicture(onSuccess, onFail, {
            quality: 50,
            destinationType: Camera.DestinationType.FILE_URI,
            sourceType: Camera.PictureSourceType.CAMERA,
            allowEdit: false,
            encodingType: Camera.EncodingType.JPEG,
            popoverOptions: CameraPopoverOptions,
            saveToPhotoAlbum: false
        });
    });

    function onSuccess(imageData) {
        var img = $('<img class="img-circle" style="width:100%;">');
        img.attr('src', imageData);
        var a = $('<a href="#" class="thumbnail"></a>');
        var div = $('<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4"></div>');
        img.appendTo(a);
        a.appendTo(div);
        div.appendTo('#picture');

        //$("a.thumbnail:parent").width();
        var width = $("a.thumbnail:parent").width();
        //$("a.thumbnail:parent").css('height',width);
        $("img.img-circle").css('height', width);
        $('a.thumbnail').click(function() {
            _this = $(this);
            $("#bigPicture").removeAttr("style");
            var image = new Image();
            image.src = $(this).find('img').attr('src');
            var width;
            var height;
            if (image.width >= image.height) {
                $("#bigPicture").css("width", screen.width - 40);
            } else {
                var i;
                height = screen.height - 200;
                i = image.height / height;
                width = image.width / i;
            }
            $("#bigPicture").css("width", width);
            $("#bigPicture").css("height", height);
            $("#bigPicture").attr("src", $(this).find('img').attr('src'));
            $('#myModal').modal('show');
            return false;
        });
    }

    function onFail(message) {
        //alert('Failed because: ' + message);
    }

    //本地上传
    $('#btnPicture').bind('touchstart', function() {
        if ($("#picture").find("img").length == 3) {
            $("#warn small").html("最多只能上传三张图片");
            $("#warn").fadeIn(500);
            setTimeout("$('#warn').fadeOut(500)", 3000);
            return;
        };
        navigator.camera.getPicture(function(data) {
            var img = $('<img class="img-circle" style="width:100%;">');
            img.attr('src', data);
            var a = $('<a class="thumbnail"></a>');
            a.attr('href', data);
            var div = $('<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4"></div>');
            img.appendTo(a);
            a.appendTo(div);
            div.appendTo('#picture');

            //alert($("a.thumbnail:parent").width());
            var width = $("a.thumbnail:parent").width();
            //$("a.thumbnail:parent").css('height',width);
            $("img.img-circle").css('height', width);

            $('a.thumbnail').click(function() {
                _this = $(this);
                $("#bigPicture").removeAttr("style");
                var image = new Image();
                image.src = $(this).find('img').attr('src');
                var width;
                var height;
                if (image.width >= image.height) {
                    $("#bigPicture").css("width", screen.width - 40);
                } else {
                    var i;
                    height = screen.height - 200;
                    i = image.height / height;
                    width = image.width / i;
                }
                $("#bigPicture").css("width", width);
                $("#bigPicture").css("height", height);
                $("#bigPicture").attr("src", $(this).find('img').attr('src'));
                $('#myModal').modal('show');
                return false;
            });

        }, function(error) {
            //console.log('Error');
        }, {
            destinationType: Camera.DestinationType.FILE_URI,
            sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
            allowEdit: false,
            mediaType: Camera.MediaType.PICTURE
        });
    });

    //报修来源(点击选中报修来源触发事件)
    $('button.status').click(function() {
        $(this).parent().parent().find('button').removeClass("btn-info").addClass("btn-default");
        $("#repairSource").html($(this).attr("value"));
        $(this).removeClass("btn-default").addClass("btn-info");
    });

    //预约维修时间
    var currYear = (new Date()).getFullYear();
    var now = new Date();
    var opt = {};
    var currDate = (new Date()).getDate();
    opt.date = {
        preset: 'date'
    };
    //opt.datetime = { preset : 'datetime', minDate: new Date(2012,3,10,9,22), maxDate: new Date(2014,7,30,15,44), stepMinute: 5  };
    opt.datetime = {
        preset: 'datetime'
    };
    opt.time = {
        preset: 'time'
    };
    opt.default = {
        theme: 'android-ics ics', //皮肤样式
        display: 'modal', //显示方式 
        mode: 'scroller', //日期选择模式
        lang: 'zh',
        startYear: currYear, //开始年份
        endYear: currYear + 10 //结束年份
    };
    var optDateTime = $.extend(opt['datetime'], opt['default']);
    $("#reOrderTime").mobiscroll(optDateTime).datetime(optDateTime);

    //最小时间
    opt.defaultDate = {
        //minDate: new Date(now.getFullYear(), now.getMonth(), now.getDate()+1)//最小日期
        minDate: new Date(now.getFullYear(), now.getMonth(), now.getDate(), now.getHours(), now.getMinutes(), now.getSeconds()), //最小时间
    };
    var optDefaultDateTime = $.extend(opt['datetime'], opt['default'], opt['defaultDate']);
    $("#reOrderTime").mobiscroll(optDefaultDateTime).datetime(optDefaultDateTime);

    /*$("#itemName").floc(function(){
            if(itemcheck == 'N'){
                $("#getItemByName").hide();
            };
    })*/

    //录音
    // function audioCapture() {
    // 	navigator.device.capture.captureAudio(onSuccess, onError, { duration: 15 });
    // 	//录制成功
    // 	function onSuccess(mediaFiles) {
    // 		var i, path, len;
    // 		for(i = 0; i < mediaFiles.length; i++) {
    // 			path = mediaFiles[i].fullPath;
    // 			alert("文件名：" + mediaFiles[i].name + "\n" +
    // 				"localURL：" + mediaFiles[i].localURL + "\n\n" +
    // 				"fullPath：" + path
    // 			);
    // 		}
    // 	}
    // 	//录制失败
    // 	function onError(error) {
    // 		alert('录制失败！错误码：' + error.code);
    // 	}
    // }
    //设备档案
    $('#searchIn').bind('click', function() {
            $.ajax({
                url: baseUrl + 'app_maintainController.do?getTaskDevice',
                type: 'post',
                data: {
                    deviceName: $('#shebei').val(),
                    fixedPlace: $('#place').val()
                },
                success: function(data) {
                        var data = eval("(" + data + ")");
                        var list = data.obj;
                        var html = '';
                        console.log(list);
                        if (data.respCode == '200') {
                            for (var i = 0; i < list.length; i++) {
                                var deviceCode = list[i].deviceCode;
                                var deviceName = list[i].deviceName;
                                var fixedPlace = list[i].fixedPlace;
                                html += deviceHtml(deviceCode, deviceName, fixedPlace);
                            }
                            $('#ddUl').html(html);
                        }
                    } //子节点succes
            });
        })
        //HTML
    function deviceHtml(deviceCode, deviceName, fixedPlace) {
        //alert('12')
        var html = '';
        html += '<li class="' + deviceCode + '" onclick="hideDevice(this)"><a href="#">' + deviceName + '</a></li>';
        return html;
    }
    //hide
    function hideDevice(src) {
        deviceCode = $(src).attr('class');
        $('#deviceSelect').val($(src).find('a').text());
        $('#myModalWaste').modal('toggle');
    }

    /**
     * 语音报修
     * @param  {[type]} ){                   } [description]
     * @return {[type]}     [description]
     */
    var filePath = "";
    $("#audioClick").click(function() {
        //开始录音（最长录制时间：15秒）
        navigator.device.capture.captureAudio(onSuccess, onError, {
            duration: 15
        });

        //录制成功
        function onSuccess(mediaFiles) {
            var i, path, len;
            //遍历获取录制的文件（iOS只支持一次录制一个视频或音频）
            // for (i = 0, len = mediaFiles.length; i < len; i += 1) {
            console.log(mediaFiles);
            path = mediaFiles[0].fullPath;
            filePath = path;
            $(".audio").show();
            $('.audio').css({
                    'display': 'flex',
                    'justify-content': 'center'
                })
                // alert("录制成功！\n\n"
                //      + "文件名：" + mediaFiles[i].name + "\n"
                //      + "大小：" + mediaFiles[i].size + "\n\n"
                //      + "localURL地址：" + mediaFiles[i].localURL + "\n\n"
                //      + "fullPath地址：" + path);
                // }
        }

        //录制失败
        function onError(error) {
            // alert('录制失败！错误码：' + error.code);
        }
    });

    /**
     * 播放语音
     * @return {[type]} [description]
     */
    $(".audio img").click(function() {
        $(this).attr("src", "img/stop.png");
        playAudio();
    });

    function playAudio() {
        var my_media = new Media(filePath,
            function() {
                $(".audio img").attr("src", "img/play.png");
            },
            function(err) {
                showMsg("播放语音失败");
                // showMsg("playAudio():Audio Error: " + err);
            }
        );
        my_media.play();
    }

    /**
     * 上传语音
     * @return {[type]} [description]
     */
    function uploadAudio() {
        '`'
        // debugger
        $("#upload").show();
        if (filePath == "") {
            ajaxTest("");
            return;
        }
        var uri = encodeURI(baseUrl + "mtUploadAudio");
        var options = new FileUploadOptions();
        options.fileKey = "file";
        options.fileName = filePath.substr(filePath.lastIndexOf('/') + 1);
        options.mimeType = "text/plain";

        var headers = {
            'headerParam': 'headerValue'
        };

        options.headers = headers;

        var ft = new FileTransfer();
        // ft.onprogress = function(progressEvent) {
        //   if (progressEvent.lengthComputable) {
        //     $("#progress").html(progressEvent.loaded / progressEvent.total * 100);
        //     loadingStatus.setPercentage(progressEvent.loaded / progressEvent.total);
        //   } else {
        //     loadingStatus.increment();
        //   }
        // };
        ft.upload(filePath, uri, win, fail, options);
    }

    function win(r) {
        // alert("Code = " + r.responseCode);
        // alert("Response = " + r.response);
        // alert("Sent = " + r.bytesSent);
        var jsonData = JSON.stringify(r)
            // alert(jsonData)
        var result = $.parseJSON(jsonData)
            // var data = eval("(" + r.response + ")");
            // alert(result.response)
        if (result.responseCode != "200") {
            $("#upload").hide();
            showMsg("语音保存失败!");
        } else {
            ajaxTest(result.response);
        }
    }

    function fail(error) {
        $("#upload").hide();
        showMsg("语音上传失败，请联系系统相关人员");
        // alert("An error has occurred: Code = " + error.code);
        // alert("upload error source " + error.source);
        // alert("upload error target " + error.target);
    }
</script>

</html>